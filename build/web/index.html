<!DOCTYPE html>
<html>
<head>
	<title>Onslaught! &bull; an HTML5 medieval fantasy shoot-em-up</title>
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<meta name="description" content="Onslaught! is an HTML5 game made by Lost Decade Games. Fight off the horde with medieval weapons and powerups!">
	<meta name="keywords" content="onslaught, html5, indie, browser-based, lost decade games, javascript, chiptunes, arcade, retro, oldschool, geoff blair, matt hackett, joshua morse">
	<link rel="stylesheet" href="css/horde.css">
</head>
<body>

	<h1>Onslaught! by Lost Decade Games</h1>
	<p>
		<strong>Onslaught!</strong>
		is an HTML5 game made by <a href="http://lostdecadegames.com/">Lost Decade Games</a>.
	</p>
	
	<a id="site_link" target="_blank" href="http://lostdecadegames.com" title="Lost Decade Games website">&#xA9; Lost Decade Games</a>
	
	<script src="lib/sm2/soundmanager2.js"></script>
	<script>
		soundManager.url = "lib/sm2/";
	</script>
	
	<script>horde={};horde.canvasFallbackContent='<div class="fallback"><p>Your browser does not appear to support <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>.</p><p>Please try one of the following, more standards compliant browsers: <a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.apple.com/safari/">Safari</a>, <a href="http://www.mozilla.com/firefox/">Firefox</a> or <a href="http://www.opera.com/">Opera</a>.</p></div>';
horde.setInterval=function(e,a,b){return window.setInterval(function(){a.call(b)},e)};horde.setTimeout=function(e,a,b){return window.setTimeout(function(){a.call(b)},e)};horde.on=function(e,a,b,d){b.addEventListener(e,function(f){a.call(d,f)},false)};horde.stopEvent=function(e){e.cancelBubble=true;e.stopPropagation();e.preventDefault()};horde.now=function(){return Date.now()};
horde.makeCanvas=function(e,a,b,d){var f=document.createElement("canvas");f.id=e;f.width=Number(a)||0;f.height=Number(b)||0;if(d!==true){f.innerHTML=horde.canvasFallbackContent;document.body.appendChild(f)}return f};horde.randomRange=function(e,a){return Math.round(Math.random()*(a-e))+e};horde.randomDirection=function(){var e=new horde.Vector2(horde.randomRange(-10,10),horde.randomRange(-10,10));e.normalize();return e};
horde.makeObject=function(e,a){var b=new horde.Object;b.type=e;for(var d in horde.objectTypes[e])b[d]=horde.objectTypes[e][d];a!==true&&b.init();return b};
horde.directions={UP:0,UP_RIGHT:1,RIGHT:2,DOWN_RIGHT:3,DOWN:4,DOWN_LEFT:5,LEFT:6,UP_LEFT:7,toVector:function(e){if(e<0)e+=8;if(e>7)e-=8;switch(e){case horde.directions.UP:return new horde.Vector2(0,-1);case horde.directions.UP_RIGHT:return new horde.Vector2(1,-1);case horde.directions.RIGHT:return new horde.Vector2(1,0);case horde.directions.DOWN_RIGHT:return new horde.Vector2(1,1);case horde.directions.DOWN:return new horde.Vector2(0,1);case horde.directions.DOWN_LEFT:return new horde.Vector2(-1,
1);case horde.directions.LEFT:return new horde.Vector2(-1,0);case horde.directions.UP_LEFT:return new horde.Vector2(-1,-1)}},fromVector:function(e){if(e.x>-0.25&&e.x<0.25&&e.y<0)return horde.directions.UP;if(e.x>-0.25&&e.x<0.25&&e.y>0)return horde.directions.DOWN;if(e.x>0&&e.y>-0.25&&e.y<0.25)return horde.directions.RIGHT;if(e.x<0&&e.y>-0.25&&e.y<0.25)return horde.directions.LEFT;if(e.x>0&&e.y<0)return horde.directions.UP_RIGHT;if(e.x>0&&e.y>0)return horde.directions.DOWN_RIGHT;if(e.x<0&&e.y>0)return horde.directions.DOWN_LEFT;
if(e.x<0&&e.y<0)return horde.directions.UP_LEFT}};(function(){horde.Timer=function(){this.ttl=this.elapsed_ms=0};var e=horde.Timer,a=e.prototype;e.now=function(){return Date.now()};a.start=function(b){if(b)this.ttl=Number(b);this.elapsed_ms=0};a.update=function(b){this.elapsed_ms+=b};a.reset=function(){this.start()};a.elapsed=function(){return this.elapsed_ms};a.expired=function(){if(this.ttl>0)return this.elapsed_ms>this.ttl;return false}})();(function(){horde.sound={};var e="sm2",a=".mp3",b=false,d={};horde.sound.init=function(f){if(typeof Titanium=="undefined"){var g=document.createElement("audio");if(g.canPlayType)g.canPlayType("audio/mpeg;")||(a=".ogg")}else e="Titanium";switch(e){case "sm2":soundManager.useFastPolling=true;soundManager.useHighPerformance=true;soundManager.autoLoad=true;soundManager.multiShot=true;soundManager.volume=100;soundManager.onload=f;soundManager.useHTML5Audio=false;break;case "html5":case "Titanium":f();
break}};horde.sound.create=function(f,g,i,h){i=!!i;g+=a;if(h===undefined)h=100;switch(e){case "sm2":f={id:f,url:g,volume:h};if(i)f.onfinish=function(){this.play()};soundManager.createSound(f);break;case "html5":var j=new Audio;j.preload="auto";j.src=g;i?j.addEventListener("ended",function(){this.currentTime=0;this.play()},false):j.addEventListener("ended",function(){this.pause();this.currentTime=0},false);j.load();j.volume=h/100;d[f]=j;break;case "Titanium":d[f]=Titanium.Media.createSound("app://"+
g);if(i)d[f].oncomplete=function(){this.play()};d[f].setVolume(0);d[f].play();d[f].stop();d[f].setVolume(h/100);break}};horde.sound.isPlaying=function(f){switch(e){case "sm2":if(f=soundManager.getSoundById(f))return f.playState===1;return false;case "html5":return d[f].currentTime>0}};horde.sound.play=function(f){if(b)return false;switch(e){case "sm2":soundManager.play(f);break;case "html5":try{d[f].pause();d[f].currentTime=0;d[f].play()}catch(g){}break;case "Titanium":d[f].isPlaying()&&d[f].stop();
d[f].play();break}};horde.sound.stop=function(f){switch(e){case "sm2":soundManager.stop(f);break;case "html5":d[f].pause();d[f].currentTime=0;break;case "Titanium":d[f].stop();break}};horde.sound.stopAll=function(){switch(e){case "sm2":soundManager.stopAll();break;case "html5":try{for(var f in d){d[f].pause();d[f].currentTime=0}}catch(g){console.log("[ERROR horde.sound.stopAll]",g)}break;case "Titanium":for(f in d)d[f].stop();break}};horde.sound.pauseAll=function(){switch(e){case "sm2":soundManager.pauseAll();
break;case "html5":for(var f in d)d[f].currentTime>0&&d[f].pause();break;case "Titanium":for(f in d)d[f].isPlaying()&&d[f].pause();break}};horde.sound.resumeAll=function(){switch(e){case "sm2":soundManager.resumeAll();break;case "html5":for(var f in d)d[f].currentTime>0&&d[f].play();break;case "Titanium":for(f in d)d[f].isPaused()&&d[f].play();break}};horde.sound.toggleMuted=function(){horde.sound.setMuted(!horde.sound.isMuted())};horde.sound.isMuted=function(){return b};horde.sound.setMuted=function(f){if(b!==
f)(b=f)?horde.sound.pauseAll():horde.sound.resumeAll()}})();(function(){horde.Size=function(e,a){this.width=Number(e)||0;this.height=Number(a)||0}})();(function(){horde.Vector2=function(b,d){this.x=Number(b)||0;this.y=Number(d)||0};var e=horde.Vector2,a=e.prototype;e.fromSize=function(b){return new horde.Vector2(b.width,b.height)};e.fromHeading=function(b,d){d=Number(d)||1;return new horde.Vector2(Math.sin(b)*d,-Math.cos(b)*d)};a.clone=function(){return new horde.Vector2(this.x,this.y)};a.scale=function(b){this.x*=b;this.y*=b;return this};a.add=function(b){this.x+=b.x;this.y+=b.y;return this};a.subtract=function(b){this.x-=b.x;this.y-=b.y;return this};
a.zero=function(){this.y=this.x=0;return this};a.invert=function(){this.x*=-1;this.y*=-1;return this};a.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.normalize=function(){var b=this.magnitude();return b===0?this:this.scale(1/b)};a.toString=function(){return this.x+", "+this.y};a.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};a.abs=function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y);return this};a.angle=function(){return this.heading()*
(180/Math.PI)};a.heading=function(){return Math.atan2(this.x,-this.y)}})();(function(){horde.Rect=function(b,d,f,g){this.left=Number(b)||0;this.top=Number(d)||0;this.width=Number(f)||0;this.height=Number(g)||0};var e=horde.Rect,a=e.prototype;e.intersects=function(b,d){return b.left<=d.left+d.width&&d.left<=b.left+b.width&&b.top<=d.top+d.height&&d.top<=b.top+b.height};a.center=function(){var b=new horde.Vector2(this.width,this.height);return(new horde.Vector2(this.left,this.top)).add(b.scale(0.5))};a.intersects=function(b){return e.intersects(this,b)};a.reduce=function(b){this.left+=
b;this.top+=b;this.width-=b*2;this.height-=b*2;return this}})();(function(){horde.Keyboard=function(){this.history=[];this.keyStates={};this.lastKeyStates={};horde.on("keydown",this.handleKeyDown,window,this);horde.on("keyup",this.handleKeyUp,window,this)};var e=horde.Keyboard,a=e.prototype,b={ESCAPE:27,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,D:68,M:77,P:80,S:83,W:87,X:88,Z:90};e.Keys=b;e.konamiCode=[b.UP,b.UP,b.DOWN,b.DOWN,b.LEFT,b.RIGHT,b.LEFT,b.RIGHT,b.B,b.A];e.debugCode=[76,68,68,69,66,85,71];a.supressKeys=function(d){switch(d.keyCode){case b.ENTER:case b.LEFT:case b.UP:case b.RIGHT:case b.DOWN:case b.B:case b.A:case b.M:case b.Z:case b.X:case b.P:case b.SPACE:case b.W:case b.S:case b.D:horde.stopEvent(d);
break}};a.handleKeyDown=function(d){this.history.push(d.keyCode);this.keyStates[d.keyCode]=true;this.supressKeys(d)};a.handleKeyUp=function(d){this.keyStates[d.keyCode]=false;this.supressKeys(d)};a.isKeyDown=function(d){return this.keyStates[d]===true};a.isKeyPressed=function(d){return this.isKeyDown(d)&&this.lastKeyStates[d]!==true};a.isAnyKeyPressed=function(d){for(d in this.keyStates)if(this.isKeyDown(d)&&this.lastKeyStates[d]!==true)return true;return false};a.clearKey=function(d){this.keyStates[d]=
false};a.clearKeys=function(){this.keyStates={}};a.clearHistory=function(){this.history=[]};a.historyMatch=function(d){var f=d.length,g=this.history.slice(-f);if(g.length!==f)return false;for(var i=0;i<f;i++)if(d[i]!==g[i])return false;return true};a.storeKeyStates=function(){for(var d in this.keyStates)this.lastKeyStates[d]=this.keyStates[d]}})();(function(){horde.Mouse=function(b){this.buttonStates={};this.mouseY=this.mouseX=0;this.canvas=b;horde.on("mousemove",this.handleMouseMove,window,this);horde.on("mousedown",this.handleMouseDown,window,this);horde.on("mouseup",this.handleMouseUp,window,this)};var e=horde.Mouse,a=e.prototype;e.Buttons={LEFT:0,RIGHT:2};a.handleMouseMove=function(b){this.mouseX=(b.clientX-this.canvas.offsetLeft)*640/this.canvas.offsetWidth;this.mouseY=(b.clientY-this.canvas.offsetTop)*480/this.canvas.offsetHeight};a.handleMouseDown=
function(b){this.buttonStates[b.button]=true;horde.stopEvent(b)};a.handleMouseUp=function(b){this.buttonStates[b.button]=false};a.isButtonDown=function(b){return this.buttonStates[b]}})();(function(){horde.Engine=function(){this.lastUpdate=0;this.canvases={};this.map=null;this.spawnPoints=[];this.objects={};this.objectIdSeed=0;this.playerObjectId=null;this.keyboard=new horde.Keyboard;this.view=new horde.Size(640,480);this.images=null;this.konamiEntered=this.debug=false;this.gateDirection="";this.gateState="down";this.pointerOptionsStart=this.numPointerOptions=this.pointerYStart=this.pointerY=this.gatesY=this.gatesX=0;this.targetReticle={angle:0,rotateSpeed:1,position:new horde.Vector2};
this.enableClouds=false;this.cloudTimer=null;this.woundsTo=0;this.woundsToSpeed=10;this.introTimer=new horde.Timer;this.introPhase=0;this.introPhaseInit=false};var e=horde.Engine.prototype;e.resize=function(){var a=window.innerHeight;a-=40;if(a<480)a=480;if(a>768)a=768;var b=Math.round(a*1.333),d=this.canvases.display;d.style.width=b+"px";d.style.height=a+"px";d.style.marginLeft=-(b/2)+"px";d.style.marginTop=-(a/2)+"px"};e.run=function(){this.init();this.lastUpdate=horde.now();this.interval=horde.setInterval(0,
this.update,this)};e.stop=function(){clearInterval(this.interval)};e.togglePause=function(){var a=false;return function(){if(this.paused){this.paused=false;horde.sound.setMuted(a);horde.sound.play("unpause")}else{this.paused=true;this.initOptions();a=horde.sound.isMuted();horde.sound.play("pause");horde.sound.setMuted(true)}}}();e.addObject=function(a){this.objectIdSeed++;var b="o"+this.objectIdSeed;a.id=b;this.objects[b]=a;return b};e.getBarColor=function(a,b){var d=b/a*100;return d>50?"rgb(98, 187, 70)":
d>25?"rgb(246, 139, 31)":"rgb(238, 28, 36)"};e.spawnObject=function(a,b,d){d=d||a.facing;b=horde.makeObject(b,true);for(var f=a;f.ownerId!==null;)f=this.objects[f.ownerId];b.ownerId=f.id;b.team=a.team;b.centerOn(a.boundingBox().center());b.setDirection(d);b.init();return this.addObject(b)};e.getPlayerObject=function(){return this.objects[this.playerObjectId]};e.getObjectCountByType=function(a){var b=0;for(var d in this.objects)this.objects[d].type===a&&b++;return b};e.preloadComplete=function(){this.state=
"intro";this.logoAlpha=0;this.logoFade="in";this.logoFadeSpeed=0.5};e.init=function(){this.state="intro";this.canvases.display=horde.makeCanvas("display",this.view.width,this.view.height);this.canvases.buffer=horde.makeCanvas("buffer",this.view.width,this.view.height,true);this.resize();horde.on("resize",this.resize,window,this);this.mouse=new horde.Mouse(this.canvases.display);horde.on("contextmenu",function(a){horde.stopEvent(a)},document.body,this);horde.on("blur",function(){if(this.state=="running"){this.keyboard.keyStates=
{};this.paused||this.togglePause()}},window,this);this.preloader=new horde.ImageLoader;this.preloader.load({ui:"img/sheet_ui.png"},this.preloadComplete,this);this.images=new horde.ImageLoader;this.images.load({arena:"img/sheet_arena.png",characters:"img/sheet_characters.png",objects:"img/sheet_objects.png",beholder:"img/sheet_beholder.png"},this.handleImagesLoaded,this);this.getData("high_score")===null&&this.putData("high_score",0);this.initSound()};e.initSound=function(){horde.sound.init(function(){var a=
horde.sound;a.create("move_pointer","sound/effects/chest_damage");a.create("gate_opens","sound/effects/gate_opens");a.create("gate_closes","sound/effects/gate_closes");a.create("chest_weapon","sound/effects/chest_weapon");a.create("normal_battle_music","sound/music/normal_battle",true,20);a.create("hero_attacks","sound/effects/char_attacks");a.create("hero_damage","sound/effects/char_damage_3");a.create("eat_food","sound/effects/chest_food",false,20);a.create("coins","sound/effects/chest_gold",false,
10);a.create("chest_opens","sound/effects/chest_opens");a.create("pause","sound/effects/pause");a.create("unpause","sound/effects/unpause");a.create("hero_dies","sound/effects/char_dies");a.create("fire_attack","sound/effects/char_attacks_fire");a.create("bat_damage","sound/effects/bat_damage");a.create("bat_dies","sound/effects/bat_dies");a.create("goblin_attacks","sound/effects/goblin_attacks");a.create("goblin_damage","sound/effects/goblin_damage");a.create("goblin_dies","sound/effects/goblin_dies");
a.create("imp_attacks","sound/effects/imp_attacks");a.create("imp_damage","sound/effects/imp_damage");a.create("imp_dies","sound/effects/imp_dies");a.create("spike_attack","sound/effects/spike_attacks");a.create("cyclops_attacks","sound/effects/cyclops_attacks");a.create("cyclops_damage","sound/effects/cyclops_damage");a.create("cyclops_dies","sound/effects/cyclops_dies");a.create("dragon_attacks","sound/effects/dragon_attacks");a.create("dragon_damage","sound/effects/dragon_damage");a.create("dragon_dies",
"sound/effects/dragon_dies");a.create("cube_attacks","sound/effects/cube_attacks");a.create("cube_damage","sound/effects/cube_damage");a.create("cube_dies","sound/effects/cube_death");a.create("final_battle_music","sound/music/final_battle",true,20)})};e.initGame=function(){this.konamiEntered=false;this.closeGates();this.objects={};this.state="title";this.initOptions();this.initMap();this.initSpawnPoints();this.initWaves();this.initPlayer();this.gameOverBg=null;this.monstersAlive=0};e.initMap=function(){this.tileSize=
new horde.Size(32,32);this.map=[[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]};e.initSpawnPoints=function(){this.spawnPoints=[];this.spawnPoints.push(new horde.SpawnPoint(3*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2));this.spawnPoints.push(new horde.SpawnPoint(9*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2));this.spawnPoints.push(new horde.SpawnPoint(15*
this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2))};e.initSpawnWave=function(a){var b=0;for(var d in a.points){var f=a.points[d],g=this.spawnPoints[f.spawnPointId];g.delay=f.delay;g.lastSpawnElapsed=g.delay;for(var i in f.objects){var h=f.objects[i];g.queueSpawn(h.type,h.count)}f=(g.queue.length-1)*g.delay;if(f>b)b=f}this.waveTimer.start(b+a.nextWaveTime);this.openGates()};e.initWaves=function(){this.waves=[];this.waveTimer=new horde.Timer;this.waveTimer.start(1);
this.currentWaveId=-1;this.waveText={string:"<WAVE TEXT HERE>",size:20,state:"off",alpha:0};var a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"bat",1);a.addObjects(1,"bat",1);a.addObjects(2,"bat",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"goblin",2);a.addObjects(1,"goblin",2);a.addObjects(2,"goblin",2);a.nextWaveTime=3E4;this.waves.push(a);
a=new horde.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"cyclops",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"demoblin",2);a.addObjects(1,"demoblin",3);a.addObjects(2,"demoblin",2);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,750);a.addSpawnPoint(2,500);a.addObjects(0,"bat",5);a.addObjects(0,"goblin",2);a.addObjects(1,"goblin",2);a.addObjects(1,
"cyclops",1);a.addObjects(1,"goblin",3);a.addObjects(2,"bat",5);a.addObjects(2,"goblin",2);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,200);a.addSpawnPoint(1,200);a.addSpawnPoint(2,200);a.addObjects(0,"bat",20);a.addObjects(1,"bat",20);a.addObjects(2,"bat",20);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"demoblin",5);a.addObjects(1,"cyclops",1);a.addObjects(1,"goblin",
10);a.addObjects(2,"demoblin",5);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,750);a.addSpawnPoint(1,750);a.addSpawnPoint(2,750);a.addObjects(0,"cyclops",1);a.addObjects(2,"cyclops",1);a.addObjects(0,"bat",15);a.addObjects(1,"bat",15);a.addObjects(2,"bat",15);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,5E3);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,5E3);a.addObjects(0,"imp",5);a.addObjects(1,"imp",5);a.addObjects(2,"imp",5);a.nextWaveTime=
45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"superclops",1);a.nextWaveTime=6E4;a.bossWave=true;a.bossName="Superclops";this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,8E3);a.addSpawnPoint(2,15E3);a.addObjects(0,"sandworm",2);a.addObjects(1,"sandworm",1);a.addObjects(1,"cyclops",1);a.addObjects(2,"sandworm",2);a.nextWaveTime=6E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,
1E3);a.addObjects(0,"goblin",5);a.addObjects(1,"goblin",5);a.addObjects(2,"goblin",5);a.addObjects(0,"wizard",2);a.addObjects(1,"wizard",1);a.addObjects(2,"wizard",2);a.addObjects(0,"goblin",5);a.addObjects(1,"goblin",5);a.addObjects(2,"goblin",5);a.nextWaveTime=6E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,7500);a.addSpawnPoint(1,7500);a.addSpawnPoint(2,7500);a.addObjects(0,"flaming_skull",3);a.addObjects(1,"flaming_skull",3);a.addObjects(2,"flaming_skull",3);a.nextWaveTime=45E3;
this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"demoblin",5);a.addObjects(1,"hunter_goblin",5);a.addObjects(2,"demoblin",5);a.addObjects(0,"wizard",2);a.addObjects(1,"wizard",3);a.addObjects(2,"wizard",2);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,15E3);a.addObjects(0,"owlbear",2);a.addObjects(1,"imp",15);a.addObjects(2,"owlbear",2);a.nextWaveTime=
45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,4E3);a.addSpawnPoint(2,500);a.addObjects(0,"dire_bat",10);a.addObjects(0,"hunter_goblin",5);a.addObjects(0,"dire_bat",10);a.addObjects(0,"hunter_goblin",5);a.addObjects(1,"sandworm",3);a.addObjects(2,"dire_bat",10);a.addObjects(2,"hunter_goblin",5);a.addObjects(2,"dire_bat",10);a.addObjects(2,"hunter_goblin",5);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,3E3);a.addSpawnPoint(1,
1500);a.addSpawnPoint(2,3E3);a.addObjects(0,"flaming_skull",3);a.addObjects(1,"imp",5);a.addObjects(1,"wizard",5);a.addObjects(2,"flaming_skull",3);a.nextWaveTime=45E3;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1500);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,1500);a.addObjects(0,"cyclops",1);a.addObjects(0,"goblin",10);a.addObjects(1,"demoblin",5);a.addObjects(1,"cyclops",1);a.addObjects(1,"demoblin",10);a.addObjects(2,"goblin",10);a.addObjects(2,"cyclops",1);a.nextWaveTime=45E3;this.waves.push(a);
a=new horde.SpawnWave;a.addSpawnPoint(0,3500);a.addSpawnPoint(1,4E3);a.addSpawnPoint(2,5E3);a.addObjects(0,"wizard",7);a.addObjects(1,"imp",10);a.addObjects(1,"owlbear",1);a.addObjects(2,"sandworm",4);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"dragon",1);a.nextWaveTime=12E4;a.bossWave=true;a.bossName="Green Dragon";this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",
1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);
a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,
1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"cube",1);a.nextWaveTime=6E4;a.bossWave=true;a.bossName="Gelatinous Cube";this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,
1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=
3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;
a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"demoblin",1);a.nextWaveTime=Infinity;a.bossWave=true;a.bossName="Beholder";this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,
1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"cyclops",1);a.addObjects(1,"superclops",1);a.addObjects(2,"cyclops",1);a.nextWaveTime=18E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"dragon",1);a.addObjects(2,"superclops",1);a.nextWaveTime=18E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;
a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,
1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(1,"goblin",1);a.nextWaveTime=3E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"nega_xam",1);a.nextWaveTime=Infinity;
a.bossWave=true;a.bossName="Nega Xam";this.waves.push(a)};e.initPlayer=function(){var a=horde.makeObject("hero");a.weapons=[{type:"h_sword",count:null}];a.centerOn(horde.Vector2.fromSize(this.view).scale(0.5));this.playerObjectId=this.addObject(a)};horde.Engine.prototype.handleImagesLoaded=function(){this.imagesLoaded=true};e.logoFadeOut=function(){this.logoFade="out"};e.updateLogo=function(a){var b=this.keyboard;if(this.keyboard.isAnyKeyPressed()){b.clearKeys();this.initGame()}if(this.logoFade===
"in"){this.logoAlpha+=this.logoFadeSpeed/1E3*a;if(this.logoAlpha>=1){this.logoAlpha=1;this.logoFade="none";horde.setTimeout(1E3,this.logoFadeOut,this)}}else if(this.logoFade==="out"){this.logoAlpha-=this.logoFadeSpeed/1E3*a;if(this.logoAlpha<=0){this.logoAlpha=0;this.logoFade="none";this.initGame()}}};e.updateIntroCinematic=function(a){this.introTimer.update(a);switch(this.introPhase){case 0:if(!this.introPhaseInit){this.introFadeAlpha=0;this.introPhaseInit=true}this.introFadeAlpha+=0.0010*a;if(this.introFadeAlpha>=
1){this.introFadeAlpha=1;this.introPhase++;this.introPhaseInit=false}break;case 1:if(!this.introPhaseInit){this.introFadeAlpha=1;this.introPhaseInit=true}this.introFadeAlpha-=5.0E-4*a;if(this.introFadeAlpha<=0){this.introFadeAlpha=0;this.introPhase++;this.introPhaseInit=false}break;case 2:if(!this.introPhaseInit){this.introTimer.start(1E3);this.introPhaseInit=true}if(this.introTimer.expired()){this.introPhase++;this.introPhaseInit=false}break;case 3:if(!this.introPhaseInit){this.openGates();this.introPhaseInit=
true}if(this.gateState==="up"){this.introPhase++;this.introPhaseInit=false}break;case 4:if(!this.introPhaseInit){var b=horde.makeObject("hero");b.position.x=304;b.position.y=-64;b.collidable=false;b.setDirection(new horde.Vector2(0,1));this.introHero=b;this.introPhaseInit=true}this.introHero.update(a);this.moveObject(this.introHero,a);if(this.introHero.position.y>=222){this.introHero.centerOn(horde.Vector2.fromSize(this.view).scale(0.5));this.introHero.stopMoving();this.introPhase++;this.introPhaseInit=
false}break;case 5:case 6:case 8:if(!this.introPhaseInit){this.introTimer.start(500);this.introPhaseInit=true}if(this.introTimer.expired()){this.introPhase++;this.introPhaseInit=false}break;case 7:if(!this.introPhaseInit){this.closeGates();this.introPhaseInit=true}if(this.gateState==="down"){this.introPhase++;this.introPhaseInit=false}break;case 9:if(!this.introPhaseInit){this.introTimer.start(1E3);this.introPhaseInit=true}this.introHero.update(a);if(this.introTimer.expired()){horde.sound.play("normal_battle_music");
this.state="running"}break}};e.update=function(){var a=horde.now(),b=a-this.lastUpdate;this.lastUpdate=a;this.lastElapsed=b;if(this.imagesLoaded===true)switch(this.state){case "loading":this.render();break;case "intro":this.updateLogo(b);this.render();break;case "title":this.handleInput();this.updateFauxGates(b);this.render();break;case "how_to_play":this.handleInput();this.render();break;case "credits":this.handleInput();this.render();break;case "intro_cinematic":this.handleInput();this.updateIntroCinematic(b);
this.updateFauxGates(b);this.render();break;case "running":this.handleInput();if(!this.paused){this.updateWaves(b);this.updateSpawnPoints(b);this.updateClouds(b);this.updateObjects(b);this.updateFauxGates(b)}this.render();break;case "game_over":this.updateGameOver(b);this.render();break}};e.updateClouds=function(a){if(this.enableClouds===true){if(this.cloudTimer===null){this.cloudTimer=new horde.Timer;this.cloudTimer.start(2E3)}this.cloudTimer.update(a);a=0;for(var b in this.objects){var d=this.objects[b];
if(d.type==="cloud"){a++;d.position.x<-d.size.width&&d.die()}}if(a<10&&this.cloudTimer.expired()){if(horde.randomRange(1,10)>=1){b=horde.randomRange(1,3);for(a=0;a<b;a++){d=horde.makeObject("cloud");d.position.x=640+horde.randomRange(1,32);d.position.y=horde.randomRange(-(d.size.height/2),480+d.size.height/2);d.setDirection(new horde.Vector2(-1,0));this.addObject(d)}}this.cloudTimer.reset()}}};e.updateSpawnPoints=function(a){if(this.gateState==="up"){var b=true;for(var d in this.spawnPoints){if(this.spawnPoints[d].queue.length>=
1)b=false;var f=this.spawnPoints[d].update(a);f!==false&&this.addObject(f)}b&&!this.monstersAboveGates&&this.closeGates()}};e.spawnWaveExtras=function(a){switch(a){case 1:var b=this.getPlayerObject();a=horde.makeObject("item_weapon_knife");a.position=b.position.clone();a.position.x-=128;this.addObject(a);a=horde.makeObject("item_weapon_spear");a.position=b.position.clone();a.position.x+=128;this.addObject(a);break;case 21:b=[{x:32,y:64},{x:32,y:352},{x:576,y:64},{x:576,y:352}];a=b.length;for(var d=
0;d<a;d++){var f=b[d],g=horde.makeObject("spike_sentry");g.position=new horde.Vector2(f.x,f.y);this.addObject(g)}break;case 50:for(b in this.objects){a=this.objects[b];a.role==="trap"&&a.die()}break}};e.updateWaves=function(a){this.waveTimer.update(a);var b=true;for(var d in this.spawnPoints)if(this.spawnPoints[d].queue.length>0)b=false;if(this.waveTimer.expired()||b===true&&this.monstersAlive===0){this.currentWaveId++;b=this.currentWaveId+1;this.spawnWaveExtras(b);d="Wave: "+b;if(b>1&&b%10===1){this.putData("checkpoint_wave",
this.currentWaveId);this.putData("checkpoint_hero",JSON.stringify(this.getPlayerObject()));this.continuing||(d="Game Saved!")}if(this.currentWaveId>=this.waves.length)this.currentWaveId=0;if(this.waves[this.currentWaveId].bossWave){d="Boss: "+this.waves[this.currentWaveId].bossName;if(!horde.sound.isPlaying("final_battle_music")){horde.sound.stop("normal_battle_music");horde.sound.play("final_battle_music")}}else if(!horde.sound.isPlaying("normal_battle_music")){horde.sound.stop("final_battle_music");
horde.sound.play("normal_battle_music")}this.initSpawnWave(this.waves[this.currentWaveId]);this.waveText.string=d;this.waveText.alpha=0;this.waveText.size=30;this.waveText.state="show"}switch(this.waveText.state){case "show":this.waveText.alpha+=0.0020*a;if(this.waveText.alpha>=1){this.waveText.alpha=1;this.waveText.timer=new horde.Timer;this.waveText.timer.start(250);this.waveText.state="display"}break;case "display":this.waveText.timer.update(a);if(this.waveText.timer.expired())this.waveText.state=
"hide";break;case "hide":this.waveText.alpha-=0.0015*a;this.waveText.size+=0.2*a;if(this.waveText.alpha<=0){this.waveText.alpha=0;this.waveText.state="off"}break}};e.updateGameOver=function(a){if(!this.gameOverAlpha){this.gameOverReady=false;this.gameOverAlpha=0}this.gameOverAlpha+=Number(2.0E-4*a)||0;if(this.gameOverAlpha>=0.75){this.gameOverReady=true;this.gameOverAlpha=0.75}};e.openGates=function(){if(this.gateState!=="up"){this.gateDirection="up";horde.sound.play("gate_opens")}};e.closeGates=
function(){if(this.gateState!=="down"){this.gateDirection="down";horde.sound.play("gate_closes")}};e.updateFauxGates=function(a){if(this.gateDirection==="down"){this.gatesX=0;this.gatesY+=0.2*a;if(this.gatesY>=0){this.gatesY=this.gatesX=0;this.gateDirection="";this.gateState="down"}}if(this.gateDirection==="up"){this.gatesX=horde.randomRange(-1,1);this.gatesY-=0.05*a;if(this.gatesY<=-54){this.gatesX=0;this.gatesY=-54;this.gateDirection="";this.gateState="up"}}};e.getTilesByRect=function(a){var b=
[],d=new horde.Vector2(a.left,a.top),f=new horde.Vector2(a.width,a.height);a=d.clone().scale(1/this.tileSize.width).floor();d=d.clone().add(f).scale(1/this.tileSize.width).floor();for(f=a.x;f<=d.x;f++)for(var g=a.y;g<=d.y;g++)b.push({x:f,y:g});return b};e.checkTileCollision=function(a){a=this.getTilesByRect(a.boundingBox());for(var b=0,d=a.length;b<d;b++){var f=a[b];if(this.map[f.y]&&this.map[f.y][f.x]===0)return f}return false};e.moveObject=function(a,b){if(!a.badass&&a.hasState(horde.Object.states.HURTING))return false;
var d=a.speed;if(a.hasState(horde.Object.states.SLOWED))d*=0.15;var f=d/1E3*b;d=[];if(a.direction.x!==0){a.position.x+=a.direction.x*f;if(a.collidable){var g=this.checkTileCollision(a);if(g!==false){d.push("x");a.position.x=a.direction.x>0?g.x*this.tileSize.width-a.size.width:g.x*this.tileSize.width+this.tileSize.width}}}if(a.direction.y!==0){a.position.y+=a.direction.y*f;if(a.collidable){g=this.checkTileCollision(a);if(g!==false){d.push("y");a.position.y=a.direction.y>0?g.y*this.tileSize.height-
a.size.height:g.y*this.tileSize.height+this.tileSize.height}}}if(a.collidable){f=0;if(this.gateState==="down"||a.role==="monster"||a.role==="hero")f=64;if(a.direction.y<0&&a.position.y<f){a.position.y=f;d.push("y")}d.length>0&&a.wallCollide(d)}};e.dropObject=function(a,b){var d=horde.makeObject(b);d.position=a.position.clone();d.position.y-=1;this.addObject(d)};e.spawnLoot=function(a){for(var b=a.lootTable,d=b.length,f=[],g=0;g<d;g++)for(var i=b[g],h=0;h<i.weight;h++)f.push(i.type);b=horde.randomRange(0,
f.length-1);f=f[b];if(f!==null){b=this.getPlayerObject();if(f==="item_food"&&b.wounds===0)f="item_chest";this.dropObject(a,f)}};horde.Engine.prototype.updateObjects=function(a){var b=this.targetReticle;b.angle+=b.rotateSpeed/1E3*a;if(b.angle>360)b.angle=0;var d=b=0;for(var f in this.objects){var g=this.objects[f];if(g.isDead()){if(g.role==="hero"){this.endGame();return}g.execute("onDelete",[this]);delete this.objects[g.id]}else{if(g.role==="monster"){b++;g.position.y<=64&&d++}switch(g.update(a,this)){case "shoot":this.objectAttack(g);
break}g.isMoving()&&!g.hasState(horde.Object.states.STUNNED)&&this.moveObject(g,a);if(!(g.role==="fluff"||g.role==="powerup_food"||g.hasState(horde.Object.states.DYING)||g.hasState(horde.Object.states.INVISIBLE)))for(var i in this.objects){var h=this.objects[i];if(!(h.isDead()||h.team===g.team||h.role==="fluff"||h.hasState(horde.Object.states.DYING)||h.hasState(horde.Object.states.INVISIBLE)))if(g.boundingBox().reduce(5).intersects(h.boundingBox().reduce(5))){if(g.role=="hero")if(h.role=="powerup_food"){h.die();
g.wounds-=h.healAmount;if(g.wounds<0)g.wounds=0;g.meatEaten++;horde.sound.play("eat_food");for(var j=0;j<5;++j){var k=horde.makeObject("mini_heart");k.position.x=g.position.x+j*(g.size.width/5);k.position.y=g.position.y+g.size.height-horde.randomRange(0,g.size.height);this.addObject(k)}}else if(h.role=="powerup_coin"){h.die();g.gold+=h.coinAmount;horde.sound.play("coins");for(j=0;j<5;++j){k=horde.makeObject("mini_sparkle");k.position.x=g.position.x+j*(g.size.width/5);k.position.y=g.position.y+g.size.height-
horde.randomRange(0,g.size.height);this.addObject(k)}}else if(h.role=="powerup_weapon"){h.die();g.addWeapon(h.wepType,h.wepCount);horde.sound.play("chest_weapon");for(j=0;j<5;++j){k=horde.makeObject("mini_sword");k.position.x=g.position.x+j*(g.size.width/5);k.position.y=g.position.y+g.size.height-horde.randomRange(0,g.size.height);this.addObject(k)}}if(g.team!==null&&h.team!==null&&g.team!==h.team)if(!(g.role==="projectile"&&h.role==="trap")&&!(g.role==="trap"&&h.role==="projectile")){this.dealDamage(h,
g);this.dealDamage(g,h)}}}}}this.monstersAlive=b;this.monstersAboveGates=d>0;f=this.getPlayerObject();if(this.woundsTo<f.wounds)this.woundsTo+=this.woundsToSpeed/1E3*a;else if(this.woundsTo>f.wounds)this.woundsTo-=this.woundsToSpeed/1E3*a;else this.woundsTo=f.wounds;if(Math.abs(f.wounds-this.woundsTo)<=1)this.woundsTo=f.wounds};horde.Engine.prototype.dealDamage=function(a,b){if(a.role==="monster"&&b.role==="projectile")return false;a.execute("onObjectCollide",[b,this]);var d=b.execute("onThreat",
[a,this]);if(b.hasState(horde.Object.states.INVINCIBLE)||b.hitPoints===Infinity||d===true){if(a.role==="projectile"&&a.hitPoints!==Infinity)if(b.damageType==="physical"&&a.damageType==="physical"){a.reverseDirection();a.deflect()}else a.die();return false}if(a.hitPoints!==Infinity&&a.role==="projectile"&&b.role==="projectile"&&a.damageType==="physical"&&b.damageType==="physical"){a.reverseDirection();a.deflect();b.reverseDirection();b.deflect();return false}a.execute("onDamage",[b,this]);d=a;if(d.ownerId!==
null){var f=this.objects[d.ownerId];if(f)d=f}a.role==="projectile"&&d.shotsLanded++;if(b.wound(a.damage)){d.gold+=b.worth;d.kills++;b.execute("onKilled",[a,this]);b.lootTable.length>0&&this.spawnLoot(b);a.role==="projectile"&&a.piercing===false&&a.hitPoints!==Infinity&&a.die()}else{a.damage>0&&b.role==="hero"&&b.addState(horde.Object.states.INVINCIBLE,2500);a.role==="projectile"&&a.hitPoints!==Infinity&&a.die()}};e.updateTargetReticle=function(){var a=new horde.Vector2(this.mouse.mouseX,this.mouse.mouseY),
b=new horde.Rect(32,64,576,320),d=this.targetReticle.position;d.x=a.x<b.left?b.left:a.x>b.left+b.width?b.left+b.width:a.x;d.y=a.y<b.top?b.top:a.y>b.top+b.height?b.top+b.height:a.y};e.handleInput=function(){var a=this.keyboard,b=horde.Keyboard.Keys,d=horde.Mouse.Buttons,f=false,g=new horde.Vector2(this.mouse.mouseX,this.mouse.mouseY);if(this.state=="running"){if(this.keyboard.isKeyPressed(b.P)||this.keyboard.isKeyPressed(b.ESCAPE)){this.togglePause();this.keyboard.clearKeys();return}if(this.paused)f=
true;this.keyboard.isKeyPressed(77)&&horde.sound.toggleMuted();if(this.keyboard.historyMatch(horde.Keyboard.debugCode)){this.keyboard.clearHistory();this.debug=!this.debug}if(this.paused&&(a.isKeyPressed(b.ENTER)||a.isKeyPressed(b.SPACE))){a.clearKey(b.ENTER);a.clearKey(b.SPACE);switch(this.pointerY){case 0:this.togglePause();break;case 1:if(this.verifyQuit){this.verifyQuit=false;this.togglePause();var i=this.getPlayerObject();i.wound(100)}else{this.pointerY=0;this.verifyQuit=true}break}}}if(this.state===
"title"){f=true;if(!this.konamiEntered&&this.keyboard.historyMatch(horde.Keyboard.konamiCode)){horde.sound.play("chest_opens");this.konamiEntered=true;i=this.getPlayerObject();i.addWeapon("h_axe",null)}i=this.pointerYStart-22;var h;if(this.canContinue())if(g.x>=230&&g.x<=400&&g.y>=i&&g.y<i+20){if(this.pointerY!==0)h=0;if(this.mouse.isButtonDown(d.LEFT))this.keyboard.keyStates[b.SPACE]=true}i+=24;if(g.x>=230&&g.x<=400&&g.y>=i&&g.y<i+20){if(this.pointerY!==1)h=1;if(this.mouse.isButtonDown(d.LEFT))this.keyboard.keyStates[b.SPACE]=
true}i+=24;if(g.x>=230&&g.x<=400&&g.y>=i&&g.y<i+20){if(this.pointerY!==2)h=2;if(this.mouse.isButtonDown(d.LEFT))this.keyboard.keyStates[b.SPACE]=true}i+=24;if(g.x>=230&&g.x<=400&&g.y>=i&&g.y<i+20){if(this.pointerY!==3)h=3;if(this.mouse.isButtonDown(d.LEFT))this.keyboard.keyStates[b.SPACE]=true}if(h!==undefined){horde.sound.play("move_pointer");this.pointerY=h}if(a.isKeyPressed(b.ENTER)||a.isKeyPressed(b.SPACE)){a.clearKey(b.ENTER);a.clearKey(b.SPACE);switch(this.pointerY){case 0:g=this.getData("checkpoint_wave");
if(g!==null){this.currentWaveId=g-1;h=this.getData("checkpoint_hero");if(h!==null){g=this.getPlayerObject();g.load(h)}this.continuing=true;this.state="intro_cinematic"}else horde.sound.play("imp_damage");break;case 1:this.continuing=false;this.state="intro_cinematic";break;case 2:this.state="how_to_play";break;case 3:this.state="credits";break}}}if(this.state==="credits"||this.state==="how_to_play"){g=false;if(this.mouse.isButtonDown(d.LEFT)){if(this.beenDown){g=true;this.beenDown=false}}else this.beenDown=
true;if(this.keyboard.isAnyKeyPressed()||g){a.clearKeys();this.state="title"}}if(this.state==="intro_cinematic")if(this.keyboard.isAnyKeyPressed()){a.clearKeys();this.state="running";g=this.getPlayerObject();this.woundsTo=g.wounds;horde.sound.play("normal_battle_music")}if(f){if(this.keyboard.isKeyPressed(b.W)||this.keyboard.isKeyPressed(b.UP)){this.keyboard.keyStates[b.W]=false;this.keyboard.keyStates[b.UP]=false;this.pointerY--;if(this.pointerY<this.pointerOptionsStart)this.pointerY=this.numPointerOptions;
horde.sound.play("move_pointer")}if(this.keyboard.isKeyPressed(b.S)||this.keyboard.isKeyPressed(b.DOWN)){this.keyboard.keyStates[b.S]=false;this.keyboard.keyStates[b.DOWN]=false;this.pointerY++;if(this.pointerY>this.numPointerOptions)this.pointerY=this.pointerOptionsStart;horde.sound.play("move_pointer")}this.keyboard.storeKeyStates()}if(this.state==="running"){g=this.getPlayerObject();if(!(this.paused||g.hasState(horde.Object.states.DYING))){this.updateTargetReticle();a=new horde.Vector2;if(this.keyboard.isKeyDown(b.W)||
this.keyboard.isKeyDown(b.UP))a.y=-1;if(this.keyboard.isKeyDown(b.A)||this.keyboard.isKeyDown(b.LEFT))a.x=-1;if(this.keyboard.isKeyDown(b.S)||this.keyboard.isKeyDown(b.DOWN))a.y=1;if(this.keyboard.isKeyDown(b.D)||this.keyboard.isKeyDown(b.RIGHT))a.x=1;g.stopMoving();if(a.x!==0||a.y!==0)g.setDirection(a);if(this.mouse.isButtonDown(d.LEFT)){d=this.targetReticle.position.clone().subtract(g.position).normalize();this.objectAttack(g,d)}this.keyboard.isKeyDown(b.SPACE)&&this.objectAttack(g);this.keyboard.isKeyPressed(90)&&
g.cycleWeapon();this.keyboard.isKeyPressed(88)&&g.cycleWeapon(true)}this.keyboard.storeKeyStates()}};e.objectAttack=function(a,b){if(!b)b=a.facing;var d=a.fireWeapon();if(d!==false){var f=horde.objectTypes[d];switch(d){case "e_energy_ball":for(var g=b.heading(),i=-0.5;i<=0.5;i+=0.5)this.spawnObject(a,d,horde.Vector2.fromHeading(g+i));a.shotsFired+=3;break;case "h_knife":g=b.heading();this.spawnObject(a,d,horde.Vector2.fromHeading(g-0.1));this.spawnObject(a,d,horde.Vector2.fromHeading(g+0.1));a.shotsFired+=
2;break;case "h_fireball":case "e_fireball_2":for(i=-0.25;i<=0.25;i+=0.25){g=b.heading();g+=i+horde.randomRange(-1,1)/10;this.spawnObject(a,d,horde.Vector2.fromHeading(g))}a.shotsFired+=3;break;case "e_ring_fire":i=Math.PI*2;var h=i/12;for(g=0;g<i;g+=h)this.spawnObject(a,d,horde.Vector2.fromHeading(g));break;case "e_ring_fire_blue":i=Math.PI*2;h=i/12;var j=h/2;for(g=j;g<i+j;g+=h)this.spawnObject(a,d,horde.Vector2.fromHeading(g));break;case "e_bouncing_boulder":i=Math.PI*2;h=i/8;for(g=0;g<i;g+=h)this.spawnObject(a,
d,horde.Vector2.fromHeading(g));break;default:this.spawnObject(a,d,b);a.shotsFired++;break}a.shotsPerWeapon[d]||(a.shotsPerWeapon[d]=0);a.shotsPerWeapon[d]++;d=null;if(f.soundAttacks)d=f.soundAttacks;else if(a.soundAttacks)d=a.soundAttacks;d!==null&&horde.sound.play(d)}};e.render=function(){var a=this.canvases.display.getContext("2d");switch(this.state){case "loading":a.save();a.fillStyle="rgb(255, 0, 0)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();break;case "intro":this.drawLogo(a);
break;case "title":this.drawTitle(a);this.drawPointer(a);this.drawTitlePointerOptions(a);break;case "how_to_play":this.drawTitle(a);this.drawHowToPlay(a);break;case "credits":this.drawTitle(a);this.drawCredits(a);break;case "intro_cinematic":this.drawIntroCinematic(a);break;case "running":this.drawFloor(a);this.drawTargetReticle(a);this.drawObjects(a);this.drawFauxGates(a);this.drawWalls(a);this.drawWaveText(a);this.drawUI(a);if(this.paused){this.drawPaused(a);this.drawPointer(a);this.drawPausedPointerOptions(a)}break;
case "game_over":this.drawGameOver(a);break}this.debug===true&&this.drawDebugInfo(a)};e.drawWaveText=function(a){if(this.waveText.state=="show"||this.waveText.state=="hide"||this.waveText.state=="display"){var b=this.waveText.string,d=parseInt(this.waveText.size),f=this.canvases.buffer.getContext("2d");f.save();f.clearRect(0,0,320,240);f.font="Bold "+d+"px Cracked";f.textBaseline="top";f.lineWidth=3;f.strokeStyle="rgb(0, 0, 0)";f.fillStyle="rgb(230, 103, 8)";var g=160-f.measureText(b).width/2;d=120-
d/2-20;f.strokeText(b,g,d);f.fillText(b,g,d);f.restore();a.save();a.globalAlpha=this.waveText.alpha;a.drawImage(this.canvases.buffer,0,0,320,240,0,0,640,480);a.restore()}};e.drawGameOver=function(a){if(this.goAlphaStep){this.goAlpha+=this.goAlphaStep;if(this.goAlpha<=0){this.goAlpha=0;this.goAlphaStep=0.025}if(this.goAlpha>=1){this.goAlpha=1;this.goAlphaStep=-0.025}}else{this.goAlphaStep=-0.025;this.goAlpha=1}if(!this.gameOverBg){this.drawUI(a);this.gameOverBg=a.getImageData(0,0,this.view.width,this.view.height)}a.save();
a.putImageData(this.gameOverBg,0,0);a.restore();a.save();a.globalAlpha=this.gameOverAlpha;a.fillStyle="rgb(215, 25, 32)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();if(this.gameOverReady===true)if(this.keyboard.isAnyKeyPressed()){this.keyboard.clearKeys();this.initGame()}else{a.drawImage(this.preloader.getImage("ui"),0,2322,564,404,38,38,564,404);a.drawImage(this.preloader.getImage("ui"),564,2324,218,50,211,70,218,50);this.drawObjectStats(this.getPlayerObject(),a);a.drawImage(this.preloader.getImage("ui"),
564,2424,334,20,153,404,334,20)}};e.drawObjectStats=function(a,b){b.save();b.font="Bold 35px Monospace";var d=this.currentWaveId+1,f=this.getTotalScore(d,a.gold,a.totalDamageTaken);b.fillStyle="rgb(199, 234, 251)";b.fillText(d,350,180);b.fillStyle="rgb(255, 245, 121)";b.fillText(a.gold,350,235);b.fillStyle="rgb(237, 28, 36)";b.fillText(a.totalDamageTaken,350,290);b.fillStyle="rgb(250, 116, 26)";b.fillText(f,350,345);b.restore()};e.getTotalScore=function(a,b,d){var f=0;f+=a*1E3;f+=b;f-=d*10;return f};
e.drawLogo=function(a){a.save();a.fillStyle="rgb(0, 0, 0)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();if(this.logoAlpha>0){a.save();a.globalAlpha=this.logoAlpha;a.drawImage(this.preloader.getImage("ui"),0,0,370,430,160,0,370,430);a.restore()}};e.drawFloor=function(a){a.drawImage(this.images.getImage("arena"),32,480,576,386,32,0,576,386)};e.drawWalls=function(a){a.drawImage(this.images.getImage("arena"),0,0,640,480,0,0,this.view.width,this.view.height)};e.drawArena=function(a){this.drawFloor(a);
this.drawWalls(a)};e.drawPaused=function(a){a.save();a.globalAlpha=0.5;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),0,1718,564,404,38,38,564,404);a.restore()};e.getObjectDrawOrder=function(){var a=[];for(var b in this.objects){var d=this.objects[b];a.push({id:d.id,drawIndex:d.drawIndex,y:d.position.y+d.size.height})}a.sort(function(f,g){return f.drawIndex===g.drawIndex?f.y-g.y:f.drawIndex-g.drawIndex});return a};e.drawObject=function(a,
b){var d=b.getSpriteXY();if(!(b.alpha<=0||b.hasState(horde.Object.states.INVISIBLE))){a.save();a.translate(b.position.x+b.size.width/2,b.position.y+b.size.height/2);b.angle!==0&&a.rotate(b.angle*Math.PI/180);if(b.alpha!==1)a.globalAlpha=b.alpha;if(b.role==="powerup_weapon"){a.fillStyle="rgb(255, 0, 255)";a.drawImage(this.images.getImage("objects"),128,192,48,48,-22,-20,48,48)}a.drawImage(this.images.getImage(b.spriteSheet),d.x,d.y+1,b.size.width-1,b.size.height-1,-(b.size.width/2),-(b.size.height/
2),b.size.width,b.size.height);b.role==="monster"&&b.badass&&b.hasState(horde.Object.states.HURTING)&&this.drawImagePain(a,this.images.getImage(b.spriteSheet),d.x,d.y+1,b.size.width-1,b.size.height-1,-(b.size.width/2),-(b.size.height/2),b.size.width,b.size.height,"rgba(186, 51, 35, 0.6)");if(this.debug&&b.role==="monster"||b.badass&&!b.hasState(horde.Object.states.DYING)){d=b.size.width-2;d=d-Math.round(d*b.wounds/b.hitPoints);a.fillStyle="rgb(255, 255, 255)";a.fillRect(-(b.size.width/2),b.size.height/
2,b.size.width,8);a.fillStyle="rgb(0, 0, 0)";a.fillRect(-(b.size.width/2)+1,b.size.height/2+1,b.size.width-2,6);a.fillStyle=this.getBarColor(b.hitPoints,b.hitPoints-b.wounds);a.fillRect(-(b.size.width/2)+1,b.size.height/2+1,d,6)}a.restore()}};horde.Engine.prototype.drawObjects=function(a){var b=this.getObjectDrawOrder();for(var d in b)this.drawObject(a,this.objects[b[d].id])};e.drawTargetReticle=function(a){a.save();a.globalAlpha=0.5;a.translate(this.targetReticle.position.x,this.targetReticle.position.y);
a.rotate(this.targetReticle.angle);a.drawImage(this.images.getImage("objects"),256,192,64,64,-32,-32,64,64);a.restore()};e.drawImagePain=function(a,b,d,f,g,i,h,j,k,m,n){var l=this.canvases.buffer.getContext("2d");l.save();l.clearRect(0,0,640,480);l.drawImage(b,d,f,g,i,0,0,k,m);l.globalCompositeOperation="source-in";l.fillStyle=n;l.fillRect(0,0,k,m);l.restore();a.drawImage(this.canvases.buffer,0,0,k,m,h,j,k,m)};e.drawUI=function(a){var b={width:320,height:24,x:50,y:432},d=this.getPlayerObject(),f=
d.getWeaponInfo(),g=horde.objectTypes[f.type];f=f.count===null?"\u221e":f.count;var i=b.width-Math.round(b.width*d.wounds/d.hitPoints),h=b.width-Math.round(b.width*this.woundsTo/d.hitPoints);if(this.woundsTo<d.wounds){var j=i;i=h}else{j=h;i=i}a.save();a.fillStyle="rgb(255, 255, 255)";a.fillRect(b.x-2,b.y-2,b.width+2,b.height+4);a.fillRect(b.x+b.width,b.y,2,b.height);a.fillStyle="rgb(0, 0, 0)";a.fillRect(b.x,b.y,b.width,b.height);a.fillStyle=this.getBarColor(d.hitPoints,d.hitPoints-d.wounds);a.globalAlpha=
0.4;a.fillRect(b.x,b.y,i,b.height);a.fillRect(b.x,b.y,j,b.height);a.fillRect(b.x,b.y+5,j,b.height-10);a.fillRect(b.x,b.y+10,j,b.height-20);a.restore();b=(d.hitPoints-d.wounds)/d.hitPoints*100;j=352;if(b>50)j=224;else if(b>25)j=288;a.drawImage(this.images.getImage("objects"),j,64,42,42,18,424,42,42);a.drawImage(this.images.getImage("objects"),64,32,32,32,603,443,32,32);a.drawImage(this.images.getImage("objects"),g.spriteX,g.spriteY,32,32,603,412,32,32);a.save();a.textAlign="right";a.fillStyle="rgb(255, 255, 255)";
a.font="Bold 32px Monospace";a.fillText(d.gold,603,469);a.fillText(f,603,439);a.restore()};e.drawText=function(a,b,d,f,g){var i=this.canvases.buffer.getContext("2d");i.save();i.clearRect(0,0,640,480);for(var h in g)i[h]=g[h];i.fillText(b,0,20);a.drawImage(this.canvases.buffer,0,0,640,480,d,f-20,1280,960);i.restore()};e.drawTitle=function(a){a.drawImage(this.preloader.getImage("ui"),0,430,640,480,0,0,640,480);var b="High Score: "+this.getData("high_score");this.drawText(a,b,218,424,{fillStyle:"rgb(0, 0, 0)",
font:"Bold 10px Monospace"});this.drawText(a,b,220,426,{fillStyle:"rgb(255, 255, 255)",font:"Bold 10px Monospace"});a.save();a.fillStyle="rgb(150, 150, 150)";a.font="Bold 14px Monospace";a.textAlign="right";a.fillText("v0.4.29",637,477);a.restore();this.drawText(a,"\u00a9 Lost Decade Games",200,448,{fillStyle:"rgb(0, 0, 0)",font:"Bold 10px Monospace"});this.drawText(a,"\u00a9 Lost Decade Games",202,450,{fillStyle:"rgb(255, 255, 255)",font:"Bold 10px Monospace"})};e.drawPointer=function(a){var b=
this.pointerYStart+this.pointerY*24-24;a.save();a.drawImage(this.images.getImage("objects"),320,192,36,26,228,b,36,26);a.restore()};e.canContinue=function(){return this.getData("checkpoint_wave")!==null};e.drawTitlePointerOptions=function(a){var b=this.pointerYStart-22,d;d=this.canContinue()?this.pointerY==0?630:430:530;a.drawImage(this.preloader.getImage("ui"),640,d,116,20,270,b,116,20);d=this.pointerY==1?655:456;a.drawImage(this.preloader.getImage("ui"),640,d,132,26,270,b+24,132,26);d=this.pointerY==
2?681:482;a.drawImage(this.preloader.getImage("ui"),640,d,106,22,270,b+48,106,22);d=this.pointerY==3?708:508;a.drawImage(this.preloader.getImage("ui"),640,d,90,22,270,b+72,90,22)};e.drawPausedPointerOptions=function(a){var b=this.pointerYStart-22,d;if(this.verifyQuit){d=this.pointerY==0?1932:1860;a.drawImage(this.preloader.getImage("ui"),564,d,158,26,270,b,158,26)}else{d=this.pointerY==0?1788:1718;a.drawImage(this.preloader.getImage("ui"),564,d,106,26,270,b,106,26)}if(this.verifyQuit){d=this.pointerY==
1?1966:1894;a.drawImage(this.preloader.getImage("ui"),564,d,192,32,270,b+24,196,32)}else{d=this.pointerY==1?1822:1752;a.drawImage(this.preloader.getImage("ui"),564,d,70,36,270,b+24,70,36)}};e.initOptions=function(){switch(this.state){case "title":this.pointerYStart=300;if(this.canContinue()){this.pointerY=0;this.numPointerOptions=3;this.pointerOptionsStart=0}else{this.pointerY=1;this.numPointerOptions=3;this.pointerOptionsStart=1}break;case "running":this.pointerYStart=378;this.pointerY=0;this.numPointerOptions=
1;this.pointerOptionsStart=0;this.verifyQuit=false;break}};e.drawHowToPlay=function(a){a.save();a.globalAlpha=0.5;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),0,910,564,404,38,38,564,404);a.restore()};e.drawCredits=function(a){a.save();a.globalAlpha=0.5;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),0,1314,564,404,38,38,564,404);a.restore()};e.drawIntroCinematic=function(a){switch(this.introPhase){case 0:if(!this.introFadeOutBg){this.introFadeOutBg=
a.getImageData(0,0,this.view.width,this.view.height);this.introFadeAlpha=0}a.fillStyle="rgb(0,0,0)";a.fillRect(0,0,640,480);a.save();a.fillStyle="rgb(0, 0, 255)";a.fillRect(0,0,this.view.width,this.view.height);a.putImageData(this.introFadeOutBg,0,0);a.restore();if(this.introFadeAlpha>0){a.save();a.globalAlpha=this.introFadeAlpha;a.fillStyle="rgb(0,0,0)";a.fillRect(0,0,640,480);a.restore()}break;case 1:this.drawArena(a);this.drawFauxGates(a);if(this.introFadeAlpha>0){a.save();a.globalAlpha=this.introFadeAlpha;
a.fillStyle="rgb(0,0,0)";a.fillRect(0,0,640,480);a.restore()}break;case 2:case 3:this.drawArena(a);this.drawFauxGates(a);break;case 4:case 5:case 9:this.drawArena(a);this.introHero&&this.drawObject(a,this.introHero);this.drawFauxGates(a);break;case 6:case 7:case 8:this.drawArena(a);a.drawImage(this.images.getImage("characters"),640,0,32,32,304,224,32,32);this.drawFauxGates(a);break}};e.drawFauxGates=function(a){for(var b=0;b<3;b++)a.drawImage(this.images.getImage("objects"),0,192,64,64,this.gatesX+
96+b*192,this.gatesY,64,64)};e.drawDebugInfo=function(a){a.save();a.fillStyle="rgba(0, 0, 0, 0.3)";a.fillRect(0,0,this.view.width,30);a.restore();a.save();a.fillStyle="rgb(255, 255, 255)";a.font="bold 20px Monospace";a.fillText("Elapsed: "+this.lastElapsed,10,20);a.textAlign="right";a.fillText(Math.round(1E3/this.lastElapsed)+" FPS",630,20);a.restore()};e.getData=function(a){if(typeof localStorage=="object")return localStorage.getItem(a)};e.putData=function(a,b){typeof localStorage=="object"&&localStorage.setItem(a,
b)};e.endGame=function(){this.gameOverReady=false;this.gameOverAlpha=0;this.updateGameOver();this.state="game_over"}})();(function(){horde.Object=function(){this.id="";this.ownerId=null;this.position=new horde.Vector2;this.size=new horde.Size(32,32);this.direction=new horde.Vector2;this.facing=new horde.Vector2(0,1);this.speed=100;this.team=null;this.damage=this.hitPoints=1;this.spriteSheet="";this.spriteY=this.spriteX=0;this.animated=this.spriteAlign=false;this.animFrameIndex=0;this.animNumFrames=2;this.animDelay=200;this.angle=this.spawnFrameIndex=this.animElapsed=0;this.rotateSpeed=400;this.rotate=false;this.ttlElapsed=
this.ttl=this.worth=0;this.alphaMod=this.alpha=1;this.gibletSize="small";this.cooldown=false;this.cooldownElapsed=0;this.autoFire=false;this.soundDies=this.soundDamage=this.soundAttacks=null;this.alive=true;this.states=[];this.addState(horde.Object.states.IDLE);this.currentWeaponIndex=0;this.bounce=this.collidable=true;this.piercing=false;this.soundDies=this.soundDamage=null;this.damageType="physical";this.drawIndex=1;this.moveChangeElapsed=0;this.moveChangeDelay=500;this.wounds=0;this.weapons=[];
this.shotsLanded=this.shotsFired=this.totalDamageTaken=this.timesWounded=this.kills=this.gold=0;this.shotsPerWeapon={};this.phase=this.meatEaten=0;this.phaseInit=false;this.lootTable=[]};horde.Object.states={IDLE:0,MOVING:1,ATTACKING:2,HURTING:3,DYING:4,INVINCIBLE:5,INVISIBLE:6,SPAWNING:7,DESPAWNING:8,STUNNED:9};var e=horde.Object.prototype;e.load=function(a){a=JSON.parse(a);this.wounds=a.wounds;this.weapons=a.weapons;this.currentWeaponIndex=a.currentWeaponIndex;this.gold=a.gold;this.kills=a.kills;
this.timesWounded=a.timesWounded;this.totalDamageTaken=a.totalDamageTaken;this.shotsFired=a.shotsFired;this.shotsLanded=a.shotsLanded;this.shotsPerWeapon=a.shotsPerWeapon;this.meatEaten=a.meatEaten};e.setPhase=function(a){this.phase=a;this.phaseInit=false};e.nextPhase=function(){this.setPhase(this.phase+1)};e.updateStates=function(a){for(var b in this.states){var d=this.states[b];d.timer.update(a);d.timer.expired()&&this.removeStateById(b)}};e.hasState=function(a){for(var b in this.states)if(this.states[b].type===
a)return true;return false};e.addState=function(a,b){if(this.hasState(a))return false;var d=new horde.Timer;d.start(b);this.states.push({type:a,timer:d});switch(a){case horde.Object.states.SLOWED:this.oldAnimDelay=this.animDelay;this.animDelay*=2;break}};e.removeStateById=function(a){switch(this.states[a].type){case horde.Object.states.INVINCIBLE:this.alpha=1;this.alphaMod=-1;break;case horde.Object.states.SLOWED:this.animDelay=this.oldAnimDelay;break}delete this.states[a]};e.removeState=function(a){for(var b in this.states)this.states[b].type===
a&&this.removeStateById(b)};e.init=function(){this.execute("onInit");if(this.rotate)this.angle=horde.randomRange(0,359);if(this.animated)this.animElapsed=horde.randomRange(0,this.animDelay)};e.die=function(){this.alive=false};e.isDead=function(){return!this.alive};e.update=function(a){this.updateStates(a);this.deathTimer&&this.deathTimer.update(a);if(this.hasState(horde.Object.states.DYING))if(this.deathTimer.expired()){this.deathFrameIndex++;this.deathTimer.reset();if(this.deathFrameIndex>2){this.deathFrameIndex=
2;this.ttl=750}}if(this.hasState(horde.Object.states.INVINCIBLE)){this.alpha+=0.01*a*this.alphaMod;if(this.alpha>=1){this.alpha=1;this.alphaMod=-1}if(this.alpha<=0){this.alpha=0;this.alphaMod=1}}if(!this.hasState(horde.Object.states.STUNNED)){if(this.animated){this.animElapsed+=a;if(this.animElapsed>=this.animDelay){this.animElapsed=0;this.animFrameIndex++;if(this.animFrameIndex>this.animNumFrames-1)this.animFrameIndex=0;if(this.hasState(horde.Object.states.SPAWNING)){this.spawnFrameIndex++;this.spawnFrameIndex>
2&&this.removeState(horde.Object.states.SPAWNING)}if(this.hasState(horde.Object.states.DESPAWNING)){this.spawnFrameIndex--;this.spawnFrameIndex<0&&this.removeState(horde.Object.states.DESPAWNING)}}}if(this.spriteAlign)this.angle=this.facing.angle();if(this.rotate)this.angle+=this.rotateSpeed/1E3*a;if(this.ttl>0){this.ttlElapsed+=a;if(this.ttl-this.ttlElapsed<=1E3)this.alpha-=0.0010*a;this.ttlElapsed>=this.ttl&&this.die()}if(this.cooldown===true){this.cooldownElapsed+=a;var b=this.getWeaponInfo();
if(this.cooldownElapsed>=horde.objectTypes[b.type].cooldown){this.cooldown=false;this.cooldownElapsed=0}}this.phaseTimer&&this.phaseTimer.update(a);if(!this.hasState(horde.Object.states.DYING))return this.execute("onUpdate",arguments)}};e.getSpriteXY=function(){if(this.animated)switch(this.role){case "hero":case "monster":if(this.hasState(horde.Object.states.DYING))return new horde.Vector2((17+this.deathFrameIndex)*this.size.width,this.spriteY);if(this.hasState(horde.Object.states.SPAWNING)||this.hasState(horde.Object.states.DESPAWNING))return new horde.Vector2((17+
this.spawnFrameIndex)*this.size.width,this.spriteY-this.size.height);if(this.hasState(horde.Object.states.HURTING)&&this.size.width<=32)return new horde.Vector2(16*this.size.width,this.spriteY);var a=horde.directions.fromVector(this.facing.clone());return new horde.Vector2((a*2+this.animFrameIndex)*this.size.width,this.spriteY);default:return new horde.Vector2(this.spriteX+this.animFrameIndex*this.size.width,this.spriteY)}else return new horde.Vector2(this.spriteX,this.spriteY)};e.boundingBox=function(){var a=
new horde.Rect(this.position.x,this.position.y,this.size.width-1,this.size.height-1);this.role==="projectile"&&a.reduce(1);if(this.type==="e_spit_pool"){a.y+=this.size.height/4;a.x+=5;a.height-=this.size.height/2;a.width-=10}return a};e.centerOn=function(a){this.position=a.subtract(horde.Vector2.fromSize(this.size).scale(0.5))};e.wound=function(a){if(a<1)return false;this.removeState(horde.Object.states.STUNNED);this.wounds+=a;this.totalDamageTaken+=a;this.timesWounded++;if(this.role==="monster"||
this.role==="hero")this.addState(horde.Object.states.HURTING,300);if(this.wounds>=this.hitPoints){this.wounds=this.hitPoints;if(this.role==="monster"||this.role==="hero"){this.addState(horde.Object.states.DYING);this.deathFrameIndex=0;this.deathTimer=new horde.Timer;this.deathTimer.start(200)}else this.die();this.role==="hero"&&horde.sound.stopAll();this.soundDies&&horde.sound.play(this.soundDies);return true}this.soundDamage&&horde.sound.play(this.soundDamage);return false};e.wallCollide=function(a){if(this.role!==
"hero"){if(this.bounce){var b=this.direction.clone();for(var d in a)b[a[d]]*=-1;this.setDirection(b)}else this.damageType==="physical"?this.deflect():this.die();this.execute("onWallCollide",[a])}};e.deflect=function(){this.role="fluff";this.rotateSpeed=this.speed*5;this.speed*=0.5;this.spriteAlign=false;this.rotate=true;this.ttl=100;this.alpha=0.5;this.bounce=true};e.setDirection=function(a){if(a.x===0&&a.y===0)this.stopMoving();else{this.direction=a;this.facing=this.direction.clone()}};e.reverseDirection=
function(){var a=this.direction.clone();a.scale(-1);this.setDirection(a)};e.chase=function(a){this.moveToward(a.position.clone())};e.moveToward=function(a){this.setDirection(a.clone().subtract(this.position).normalize())};e.isMoving=function(){if(this.hasState(horde.Object.states.DYING))return false;return this.direction.x!==0||this.direction.y!==0};e.stopMoving=function(){this.direction.zero()};e.execute=function(a,b){if(this[a])return this[a].apply(this,b)};e.getWeaponInfo=function(){var a=this.weapons.length;
if(a>=1){if(this.currentWeaponIndex<0)this.currentWeaponIndex=0;if(this.currentWeaponIndex>a-1)this.currentWeaponIndex=a-1;return this.weapons[this.currentWeaponIndex]}return false};e.addWeapon=function(a,b){for(var d in this.weapons){var f=this.weapons[d];if(typeof f!=="undefined"&&f.type===a){if(f.count!==null)f.count+=b;return true}}d=horde.objectTypes[a];f=horde.objectTypes[this.getWeaponInfo().type];var g=this.weapons.push({type:a,count:b});if(d.priority>f.priority)this.currentWeaponIndex=g-
1};e.cycleWeapon=function(a){var b=this.weapons.length;if(a===true){this.currentWeaponIndex--;if(this.currentWeaponIndex<0)this.currentWeaponIndex=b-1}else{this.currentWeaponIndex++;if(this.currentWeaponIndex>b-1)this.currentWeaponIndex=0}};e.fireWeapon=function(){var a=this.weapons.length;if(this.cooldown===true||a<1)return false;a=this.getWeaponInfo();if(a.count!==null){a.count-=1;a.count<1&&this.weapons.splice(this.currentWeaponIndex,1)}this.cooldown=true;return a.type};e.hasWeapon=function(a){for(var b=
this.weapons.length,d=0;d<b;++d)if(this.weapons[d].type===a)return true;return false}})();(function(){horde.objectTypes={};var e=horde.objectTypes;e.hero={role:"hero",team:0,speed:150,hitPoints:100,damage:0,damageType:null,spriteSheet:"characters",spriteY:0,animated:true,soundAttacks:"hero_attacks",soundDamage:"hero_damage",soundDies:"hero_dies",weapons:[{type:"h_sword",count:null}]};e.h_sword={name:"Sword",role:"projectile",cooldown:300,speed:250,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:64,spriteY:0,spriteAlign:true,priority:0,bounce:false};e.h_knife={name:"Knife",role:"projectile",
size:new horde.Size(32,30),cooldown:200,speed:350,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:32,spriteY:0,spriteAlign:true,priority:1,bounce:false};e.h_spear={name:"Spear",role:"projectile",cooldown:350,speed:500,hitPoints:1,damage:15,spriteSheet:"objects",spriteX:96,spriteY:0,spriteAlign:true,priority:2,bounce:false,piercing:true};e.h_fireball={name:"Fireball",role:"projectile",cooldown:75,speed:400,hitPoints:1,damage:2,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:true,soundAttacks:"fire_attack",
ttl:350,priority:3,bounce:false,damageType:"magic"};e.h_bomb={name:"Bomb",role:"projectile",cooldown:750,speed:200,hitPoints:1,damage:0,spriteSheet:"objects",spriteX:128,spriteY:0,rotate:true,rotateSpeed:150,priority:4,bounce:true,onDelete:function(b){b.spawnObject(this,"bomb_smoke")}};e.bomb_smoke={role:"trap",size:new horde.Size(64,64),cooldown:0,speed:0,hitPoints:9999,damage:0,spriteSheet:"objects",spriteX:0,spriteY:544,bounce:false,ttl:3E3,onDamage:function(b){b.team!==this.team&&b.role==="monster"&&
b.addState(horde.Object.states.STUNNED,5E3)}};e.h_axe={name:"Battle Axe",role:"projectile",cooldown:450,speed:350,hitPoints:1,damage:30,spriteSheet:"objects",spriteX:192,spriteY:32,rotate:true,priority:5,ttl:1E4};e.h_fire_sword={name:"Flame Sword",role:"projectile",cooldown:450,speed:350,hitPoints:1,damage:40,spriteSheet:"objects",spriteX:384,spriteY:0,priority:6,bounce:false,spriteAlign:true,onInit:function(){this.spawnTimer=new horde.Timer;this.spawnTimer.start(50)},onUpdate:function(b,d){this.spawnTimer.update(b);
if(this.spawnTimer.expired()){d.spawnObject(this,"fire_sword_trail");this.spawnTimer.reset()}}};e.fire_sword_trail={role:"projectile",speed:0,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:true,soundAttacks:"fire_attack",ttl:500,bounce:false,drawIndex:0,damageType:"magic"};var a={chase:function(b,d){if(this.moveChangeDelay>0){this.moveChangeElapsed+=b;if(this.moveChangeElapsed<this.moveChangeDelay)return;this.moveChangeElapsed=0}this.chase(d.getPlayerObject());return"shoot"},
getNear:function(b,d){this.speed=this.defaultSpeed;var f=d.getPlayerObject(),g=f.position.clone().subtract(this.position).magnitude();if(g<100){this.chase(f);this.setDirection(this.direction.invert())}else if(g>150)this.chase(f);else if(this.cooldown)a.wander.apply(this,arguments);else{this.chase(f);this.speed=0;return"shoot"}},wander:function(b){this.moveChangeElapsed+=b;if(this.moveChangeElapsed>=this.moveChangeDelay){this.moveChangeElapsed=0;b=horde.randomDirection();b.x===0&&b.y===0||this.setDirection(b)}},
wanderShoot:function(b,d){var f=d.getPlayerObject(),g=f.position.clone().subtract(this.position).abs();if(!this.cooldown&&(g.x<f.size.width/2||g.y<f.size.height/2)){this.chase(f);return"shoot"}else a.wander.apply(this,arguments)},wanderThenChase:function(b,d){var f=d.getPlayerObject();f={x:f.position.x,y:f.position.y};var g=this.position.x,i=this.position.y;if(this.seenHero)a.chase.apply(this,arguments);else{a.wander.apply(this,arguments);g=Math.abs(g-f.x);f=Math.abs(i-f.y);if(g<64&&f<64){horde.sound.play(this.soundAttacks);
this.seenHero=true;return"shoot"}}}};e.bat={role:"monster",team:1,speed:100,hitPoints:5,damage:2,worth:0,spriteSheet:"characters",spriteY:96,animated:true,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",lootTable:[{type:null,weight:9},{type:"item_coin",weight:1}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wander}};e.dire_bat={role:"monster",team:1,speed:150,hitPoints:10,
damage:5,worth:0,spriteSheet:"characters",spriteY:128,animated:true,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",lootTable:[{type:null,weight:7},{type:"item_coin",weight:3}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wander}};e.goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:0,spriteSheet:"characters",spriteY:160,animated:true,gibletSize:"medium",
moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:5},{type:"item_coin",weight:2},{type:"item_weapon_knife",weight:2},{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wanderShoot}};e.hunter_goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:0,
spriteSheet:"characters",spriteY:160,animated:true,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:2},{type:"item_coin",weight:4},{type:"item_weapon_knife",weight:2},{type:"item_food",weight:2}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(b,d){if(this.position.y>=50){if(!this.cooldown){this.chase(d.getPlayerObject());
return"shoot"}a.wander.apply(this,arguments)}}};e.demoblin={role:"monster",team:1,speed:100,defaultSpeed:100,hitPoints:30,damage:15,worth:0,spriteSheet:"characters",spriteY:192,animated:true,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_trident",count:null}],lootTable:[{type:null,weight:6},{type:"item_weapon_spear",weight:2},{type:"item_chest",weight:1},{type:"item_food",weight:1}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",onInit:function(){this.moveChangeDelay=
horde.randomRange(500,1E3);this.cooldown=true;this.cooldownElapsed=horde.randomRange(0,5E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.getNear}};e.flaming_skull={role:"monster",team:1,speed:200,hitPoints:50,damage:15,worth:0,spriteSheet:"characters",spriteY:32,animated:true,setDir:false,weapons:[{type:"e_static_blue_fire",count:null}],lootTable:[{type:null,weight:6},{type:"item_weapon_fireball",weight:2},{type:"item_chest",weight:2}],onInit:function(){switch(horde.randomRange(1,3)){case 1:this.speed*=
0.5;this.animDelay*=0.5;break;case 2:this.speed*=0.75;this.animDelay*=0.75;break;case 3:break}},onUpdate:function(){if(!this.setDir&&this.position.y>=50){var b=this.direction.clone();b.x=Math.random();if(Math.random()>=0.5)b.x*=-1;this.setDirection(b);this.setDir=true}return"shoot"}};e.spike_wall={role:"trap",team:1,speed:150,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:32,spriteY:256,rotate:true,rotateSpeed:0,onInit:function(){this.phaseTimer=new horde.Timer;this.spinUpTime=7500;this.wallDirection=
new horde.Vector2(0,1)},onDamage:function(){this.spriteX=128},onUpdate:function(b){switch(this.phase){case 0:if(!this.phaseInit){this.phaseTimer.start(this.spinUpTime);this.phaseInit=true}this.rotateSpeed+=this.spinUpTime/200/1E3*b;this.phaseTimer.expired()&&this.nextPhase();break;case 1:if(!this.phaseInit){this.setDirection(this.wallDirection);this.phaseInit=true}break}},onWallCollide:function(){this.stopMoving();this.ttl=1500}};e.spike_sentry={role:"trap",team:1,speed:100,hitPoints:Infinity,damage:25,
worth:0,spriteSheet:"objects",spriteX:64,spriteY:256,rotate:true,rotateSpeed:100,phase:0,phaseInit:false,onDamage:function(b){if(b.role==="hero")this.spriteX=160},onUpdate:function(b,d){switch(this.phase){case 0:if(!this.phaseInit){this.stopMoving();this.phaseInit=true}var f=d.getPlayerObject().position.clone().subtract(this.position);if(Math.abs(f.y)<32){this.originalPos=this.position.clone();var g=new horde.Vector2;g.x=f.x<0?-1:1;this.setDirection(g);this.phase++;this.phaseInit=false;horde.sound.play("spike_attack")}else if(Math.abs(f.x)<
32){this.originalPos=this.position.clone();g=new horde.Vector2;g.y=f.y<0?-1:1;this.setDirection(g);this.phase++;this.phaseInit=false;horde.sound.play("spike_attack")}break;case 1:if(!this.phaseInit){this.rotateSpeed=this.speed=300;this.phaseInit=true}f=this.position.clone().subtract(this.originalPos).abs();if(f.x>256){g=this.direction.clone();g.x*=-1;this.setDirection(g);this.phase++;this.phaseInit=false}else if(f.y>128){g=this.direction.clone();g.y*=-1;this.setDirection(g);this.phase++;this.phaseInit=
false}break;case 2:if(!this.phaseInit){this.rotateSpeed=this.speed=100;this.phaseInit=true}f=this.position.clone().subtract(this.originalPos).abs();if(f.x<5&&f.y<5){this.stopMoving();this.position=this.originalPos.clone();this.phase=0;this.phaseInit=false}break}}};e.spikes={role:"trap",team:1,speed:0,hitPoints:Infinity,damage:15,worth:0,spriteSheet:"objects",spriteX:0,spriteY:256,gibletSize:"medium",onDamage:function(b){if(b.role==="hero")this.spriteX=96}};e.owlbear={role:"monster",team:1,badass:true,
animated:true,size:new horde.Size(64,64),spriteSheet:"characters",spriteY:800,damage:15,hitPoints:500,speed:75,lootTable:[{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3);this.phaseTimer=new horde.Timer},onUpdate:function(b,d){switch(this.phase){case 0:if(!this.phaseInit){this.animDelay=this.speed=150;this.phaseInit=true}this.position.y>=60&&this.nextPhase();break;case 1:if(!this.phaseInit){this.speed=75;this.animDelay=300;this.phaseInit=true}a.wander.apply(this,
arguments);var f=d.getPlayerObject(),g=f.position.clone().subtract(this.position).abs();if(g.x<this.size.width/2||g.y<this.size.height/2){this.chase(f);this.nextPhase()}break;case 2:if(!this.phaseInit){this.speed=0;this.animDelay=150;this.phaseTimer.start(500);this.phaseInit=true}this.position.x+=horde.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();break;case 3:if(!this.phaseInit){this.speed=400;this.animDelay=75;this.phaseTimer.start(2E3);this.phaseInit=true}this.phaseTimer.expired()&&
this.nextPhase();break;case 4:if(!this.phaseInit){this.stopMoving();this.animDelay=400;this.phaseTimer.start(1250);this.phaseInit=true}this.phaseTimer.expired()&&this.setPhase(1);break}}};e.cyclops={role:"monster",team:1,badass:true,animated:true,gibletSize:"large",size:new horde.Size(64,64),spriteSheet:"characters",spriteY:224,moveChangeElapsed:0,moveChangeDelay:1E3,damage:20,hitPoints:200,speed:100,animDelay:100,worth:0,soundAttacks:"cyclops_attacks",soundDamage:"cyclops_damage",soundDies:"cyclops_dies",
weapons:[{type:"e_boulder",count:null}],lootTable:[{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN))},onUpdate:function(){if(this.position.y>=50){this.speed=25;this.animDelay=200;this.onUpdate=a.chase}}};e.eyelet={role:"monster",team:1,animated:true,spriteSheet:"characters",spriteY:512,damage:10,hitPoints:100,speed:100,worth:0,onInit:function(){if(horde.randomRange(1,10)>5)this.spriteY+=
32},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wander}};e.cube={role:"monster",team:1,badass:true,animated:true,animDelay:400,gibletSize:"large",size:new horde.Size(64,64),spriteSheet:"characters",spriteY:576,moveChangeElapsed:0,moveChangeDelay:1E3,damage:35,hitPoints:500,speed:15,worth:0,soundAttacks:"cube_attacks",soundDamage:"cube_damage",soundDies:"cube_dies",lootTable:[{type:"item_chest",weight:1},{type:"item_weapon_knife",weight:3},{type:"item_weapon_spear",weight:3},{type:"item_food",
weight:3}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN));this.phaseTimer=new horde.Timer;this.gelTimer=new horde.Timer},onThreat:function(b){if(b.type!=="h_fireball")return true},onUpdate:function(b,d){this.gelTimer.update(b);switch(this.phase){case 0:if(!this.phaseInit){this.speed=100;this.animDelay=200;this.phaseInit=true}this.position.y>=150&&this.nextPhase();break;case 1:if(!this.phaseInit){this.stopMoving();
this.speed=15;this.animDelay=400;this.phaseTimer.start(4E3);this.gelTimer.start(200);this.phaseInit=true}if(this.phaseTimer.expired()){this.nextPhase();break}this.position.x+=horde.randomRange(-1,1);if(this.gelTimer.expired()){d.spawnObject(this,"gel");horde.sound.play(this.soundAttacks);this.gelTimer.reset()}break;case 2:if(!this.phaseInit){this.phaseTimer.start(5E3);this.phaseInit=true}if(this.phaseTimer.expired()){this.setPhase(1);break}a.chase.apply(this,arguments);break}}};e.gel={role:"monster",
team:1,animated:true,animDelay:400,spriteSheet:"characters",spriteY:640,moveChangeElapsed:0,moveChangeDelay:1E3,damage:5,hitPoints:10,speed:200,worth:0,soundAttacks:"cube_attacks",soundDamage:"cube_damage",soundDies:"cube_dies",onInit:function(){this.setDirection(horde.randomDirection());this.moveChangeDelay=horde.randomRange(500,1E3);switch(horde.randomRange(1,4)){case 1:this.spriteY=640;break;case 2:this.spriteY=672;break;case 3:this.spriteY=704;break;case 4:this.spriteY=736;break}},onUpdate:function(){a.wander.apply(this,
arguments)},onKilled:function(b,d){!d.getPlayerObject().hasWeapon("h_fireball")&&d.getObjectCountByType("item_weapon_fireball")===0&&d.dropObject(this,"item_weapon_fireball")}};e.superclops={role:"monster",team:1,badass:true,animated:true,gibletSize:"large",size:new horde.Size(64,64),spriteSheet:"characters",spriteY:288,moveChangeElapsed:0,moveChangeDelay:1E3,damage:35,hitPoints:600,speed:25,worth:0,soundAttacks:"cyclops_attacks",soundDamage:"cyclops_damage",soundDies:"cyclops_dies",weapons:[{type:"e_energy_ball",
count:null}],lootTable:[{type:"item_gold_chest",weight:1}],onInit:function(){this.phaseTimer=new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN))},onUpdate:function(b,d){switch(this.phase){case 0:if(!this.phaseInit){this.speed=200;this.animDelay=100;this.phaseInit=true}this.position.y>=160&&this.nextPhase();break;case 1:if(!this.phaseInit){this.stopMoving();this.animDelay=300;this.phaseTimer.start(1500);this.phaseInit=
true}if(this.phaseTimer.expired()){this.nextPhase();break}this.position.x+=horde.randomRange(-1,1);break;case 2:if(!this.phaseInit){this.cooldown=false;this.weapons=[{type:"e_bouncing_boulder",count:null}];this.phaseInit=true}d.objectAttack(this);this.position.x+=horde.randomRange(-1,1);this.nextPhase();break;case 3:if(!this.phaseInit){this.speed=50;this.weapons=[{type:"e_energy_ball",count:null}];this.cooldown=true;this.phaseTimer.start(6E3);this.phaseInit=true}this.phaseTimer.expired()&&this.setPhase(1);
d.objectAttack(this);a.chase.apply(this,arguments);break}}};e.imp={role:"monster",team:1,speed:100,hitPoints:20,damage:15,worth:0,spriteSheet:"characters",spriteY:64,animated:true,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,soundAttacks:"imp_attacks",soundDamage:"imp_damage",soundDies:"imp_death",phase:0,phaseInit:false,onInit:function(){this.phaseTimer=new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3)},onKilled:function(b,d){b.role==="projectile"&&b.die();for(var f=
0;f<2;f++)d.spawnObject(this,"dire_bat",horde.randomDirection())},onUpdate:function(){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=true;if(this.position.y>=50){this.phase++;this.phaseInit=false}break;case 1:if(!this.phaseInit){this.speed=50;this.animDelay=400;this.phaseTimer.start(2500,7500);this.phaseInit=true}a.wander.apply(this,arguments);if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 2:if(!this.phaseInit){this.animDelay=this.speed=150;this.phaseTimer.start(2500,
7500);this.phaseInit=true}a.wander.apply(this.arguments);if(this.phaseTimer.expired()){this.phase=1;this.phaseInit=false}break}}};e.wizard={role:"monster",team:1,speed:100,hitPoints:20,damage:10,worth:0,spriteSheet:"characters",spriteY:416,animated:true,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_shock_wave",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:6},{type:"item_chest",weight:2},{type:"item_gold_chest",
weight:1},{type:"item_weapon_fireball",weight:1}],phase:0,phaseInit:false,onInit:function(){this.phaseTimer=new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3);this.moveToY=horde.randomRange(50,75)},onUpdate:function(b,d){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=true;if(this.position.y>=this.moveToY){this.phase++;this.phaseInit=false}break;case 1:if(!this.phaseInit){this.animated=false;this.stopMoving();this.addState(horde.Object.states.INVINCIBLE);this.phaseTimer.start(1E3);
this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 2:if(!this.phaseInit){this.speed=500;this.addState(horde.Object.states.INVISIBLE);this.phaseTimer.start(horde.randomRange(1E3,2E3));this.phaseInit=true}a.wander.apply(this,arguments);if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 3:if(!this.phaseInit){this.stopMoving();this.removeState(horde.Object.states.INVISIBLE);this.phaseTimer.start(1E3);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;
this.phaseInit=false}break;case 4:if(!this.phaseInit){this.speed=0;this.animated=true;this.removeState(horde.Object.states.INVINCIBLE);this.phaseTimer.start(horde.randomRange(2E3,3E3));this.phaseInit=true;this.shotOnce=false}this.chase(d.getPlayerObject());if(this.phaseTimer.expired()){this.phase=1;this.phaseInit=false}if(!this.shotOnce){this.shotOnce=true;return"shoot"}break}}};e.sandworm={role:"monster",team:1,animated:true,animDelay:200,spriteSheet:"characters",spriteY:480,damage:25,hitPoints:50,
speed:50,worth:0,phase:0,phaseInit:false,moveChangeElapsed:0,moveChangeDelay:2E3,lootTable:[{type:null,weight:4},{type:"item_chest",weight:2},{type:"item_food",weight:4}],onInit:function(){this.phaseTimer=new horde.Timer;this.dirtTimer=new horde.Timer;this.attackTimer=new horde.Timer},onUpdate:function(b,d){switch(this.phase){case 0:if(!this.phaseInit){this.speed=50;this.addState(horde.Object.states.INVISIBLE);this.phaseTimer.start(horde.randomRange(5E3,1E4));this.dirtTimer.start(150);this.phaseInit=
true}this.dirtTimer.update(b);this.position.y<=50?this.setDirection(horde.directions.toVector(horde.directions.DOWN)):a.wander.apply(this,arguments);if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}if(this.dirtTimer.expired()){d.spawnObject(this,"e_dirt_pile");this.dirtTimer.reset()}break;case 1:if(!this.phaseInit){this.stopMoving();this.speed=0;this.removeState(horde.Object.states.INVISIBLE);this.addState(horde.Object.states.SPAWNING);this.spawnFrameIndex=0;this.phaseInit=true}if(!this.hasState(horde.Object.states.SPAWNING)){this.phase++;
this.phaseInit=false}break;case 2:if(!this.phaseInit){this.phaseAttacks=0;this.phaseInit=true;this.attackTimer.start(200)}this.attackTimer.update(b);if(this.phaseAttacks<1&&this.attackTimer.expired()){this.phaseAttacks++;this.chase(d.getPlayerObject());d.spawnObject(this,"e_worm_spit");this.attackTimer.reset();this.phaseAttacks===1&&this.phaseTimer.start(2E3)}if(this.phaseAttacks>=1&&this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 3:if(!this.phaseInit){this.addState(horde.Object.states.DESPAWNING);
this.spawnFrameIndex=2;this.phaseInit=true}if(!this.hasState(horde.Object.states.DESPAWNING)){this.addState(horde.Object.states.INVISIBLE);this.phase=0;this.phaseInit=false}break}}};e.nega_xam={role:"monster",team:1,badass:true,animated:true,spriteSheet:"characters",spriteY:768,damage:35,hitPoints:2500,speed:200,onInit:function(){this.phaseTimer=new horde.Timer},onUpdate:function(b,d){switch(this.phase){case 0:if(!this.phaseInit){this.speed=300;this.animDelay=100;this.phaseInit=true}this.position.y>
60&&this.nextPhase();break;case 1:if(!this.phaseInit){this.animDelay=this.speed=200;this.phaseInit=true;this.targetPos=new horde.Vector2(304,224)}this.moveToward(this.targetPos);var f=this.targetPos.clone().subtract(this.position).abs();f.x<16&&f.y<16&&this.nextPhase();break;case 2:if(!this.phaseInit){this.numDashes=0;this.setDirection(new horde.Vector2(0,1));this.stopMoving();this.phaseTimer.start(500);this.phaseInit=true}this.position.x+=horde.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();
break;case 3:if(!this.phaseInit){this.numDashes++;this.speed=400;this.animDelay=100;this.setDirection(horde.randomDirection());this.phaseTimer.start(1500);this.phaseInit=true;this.spikeTimer=new horde.Timer;this.spikeTimer.start(200)}this.spikeTimer.update(b);if(this.spikeTimer.expired()){f=d.spawnObject(this,"spikes");if(f=d.objects[f])f.ttl=1E4;this.spikeTimer.reset()}if(this.phaseTimer.expired())this.numDashes>=4?this.nextPhase():this.setPhase(3);break;case 4:if(!this.phaseInit){this.speed=100;
this.animDelay=200;this.phaseTimer.start(15E3);this.phaseInit=true}this.chase(d.getPlayerObject());this.phaseTimer.expired()&&this.nextPhase();break;case 5:if(!this.phaseInit){this.animDelay=this.speed=200;this.phaseInit=true;this.targetPos=new horde.Vector2(32,66)}this.moveToward(this.targetPos);f=this.targetPos.clone().subtract(this.position).abs();if(f.x<2&&f.y<2){this.position.x=32;this.position.y=66;this.nextPhase()}break;case 6:if(!this.phaseInit){this.setDirection(new horde.Vector2(0,1));this.stopMoving();
this.phaseInit=true;this.makeSpikeWalls(d);this.weapons=[{type:"e_nega_spear",count:null}]}this.phaseTimer.expired()&&this.nextPhase();this.chase(d.getPlayerObject());this.stopMoving();return"shoot";case 7:if(!this.phaseInit){this.stopMoving();this.phaseTimer.start(4E3);this.phaseInit=true}if(this.phaseTimer.expired()){f=horde.makeObject("item_food");f.position.x=32;f.position.y=64;f.healAmount*=2;d.addObject(f);this.nextPhase()}break;case 8:if(!this.phaseInit){this.animDelay=this.speed=200;this.phaseInit=
true;this.phaseTimer.start(15E3);this.weapons=[{type:"e_nega_axe",count:null}];this.cooldown=false;this.setDirection(horde.randomDirection())}this.phaseTimer.expired()&&this.nextPhase();a.wander.apply(this,arguments);return"shoot";case 9:if(!this.phaseInit){this.animDelay=this.speed=200;this.phaseInit=true;this.targetPos=new horde.Vector2(304,224)}this.moveToward(this.targetPos);f=this.targetPos.clone().subtract(this.position).abs();f.x<5&&f.y<5&&this.nextPhase();break;case 10:if(!this.phaseInit){this.setDirection(new horde.Vector2(0,
1));this.stopMoving();this.phaseInit=true;for(var g=0;g<60;++g){f=d.spawnObject(this,"dire_bat");d.objects[f].setDirection(horde.randomDirection())}this.phaseTimer.start(1E4)}this.phaseTimer.expired()&&this.setPhase(1);break}},makeSpikeWalls:function(b){var d=3,f=1E4,g=1;if(this.wounds>this.hitPoints*0.66){d=1;f=5E3;g=2}else if(this.wounds>this.hitPoints*0.33){d=2;f=7500;g=1.5}this.phaseTimer.start(f-1500);for(var i=[],h=0;h<18;++h)i.push(true);for(h=0;h<d;++h){c=0;for(var j=false;j===false;){c=horde.randomRange(1,
i.length-1);j=i[c]===true}i[c]=false}for(h=0;h<i.length;++h)if(i[h]===true){j=horde.makeObject("spike_wall");j.position=new horde.Vector2(32+h*32,64);j.spinUpTime=f;j.speed*=g;b.addObject(j)}i=[];for(h=0;h<10;++h)i.push(true);for(h=0;h<d;++h){c=0;for(j=false;j===false;){c=horde.randomRange(1,i.length-1);j=i[c]===true}i[c]=false}for(h=0;h<i.length;++h)if(i[h]===true){j=horde.makeObject("spike_wall");j.position=new horde.Vector2(32,64+h*32);j.wallDirection=new horde.Vector2(1,0);j.spinUpTime=f;j.speed=
275;j.speed*=g;b.addObject(j)}}};e.e_nega_axe={name:"Nega Axe",role:"projectile",cooldown:2500,speed:250,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:128,spriteY:544,rotate:true,priority:5,ttl:1E4};e.e_nega_spear={name:"Nega Spear",role:"projectile",cooldown:750,speed:350,hitPoints:Infinity,damage:5,spriteSheet:"objects",spriteX:96,spriteY:544,spriteAlign:true,priority:2,bounce:false,piercing:true};e.dragon={role:"monster",team:1,badass:true,animated:true,gibletSize:"large",size:new horde.Size(64,
64),spriteSheet:"characters",spriteY:352,moveChangeElapsed:0,moveChangeDelay:0,damage:35,hitPoints:1E3,speed:20,worth:0,soundAttacks:"dragon_attacks",soundDamage:"dragon_damage",soundDies:"dragon_dies",weapons:[{type:"e_fireball",count:null}],lootTable:[{type:"item_gold_chest",weight:1}],phase:0,phaseInit:false,onInit:function(){this.phaseTimer=new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN));this.altTimer=new horde.Timer},
onUpdate:function(b,d){this.altTimer.update(b);switch(this.phase){case 0:if(!this.phaseInit){this.speed=200;this.animDelay=50;this.phaseInit=true}if(this.position.y>=200){this.phase++;this.phaseInit=false}break;case 1:if(!this.phaseInit){this.cooldown=false;this.stopMoving();this.weapons=[{type:"e_ring_fire",count:null}];this.phaseInit=false}d.objectAttack(this);this.nextPhase();break;case 2:if(!this.phaseInit){this.speed=0;this.animDelay=100;this.phaseTimer.start(2E3);this.phaseInit=true;this.altTimer.start(350);
this.followUpShot=false}if(!this.followUpShot&&this.altTimer.expired())if(this.wounds>this.hitPoints/2){this.cooldown=false;this.weapons=[{type:"e_ring_fire_blue",count:null}];d.objectAttack(this);this.followUpShot=true}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}this.position.x+=horde.randomRange(-1,1);break;case 3:if(!this.phaseInit){this.speed=350;this.animDelay=100;this.phaseTimer.start(500);this.phaseInit=true;var f=d.getPlayerObject();this.chase(f)}if(this.phaseTimer.expired()){this.phase++;
this.phaseInit=false}break;case 4:if(!this.phaseInit){this.speed=0;this.animDelay=400;this.weapons=[{type:"e_fireball_2",count:null}];this.cooldown=false;this.cooldownElapsed=0;this.phaseTimer.start(2500);this.phaseInit=true;this.altTimer.start(750)}if(this.phaseTimer.expired()){this.phase=1;this.phaseInit=false}f=d.getPlayerObject();this.chase(f);if(this.altTimer.expired()&&this.wounds>this.hitPoints/2){d.spawnObject(this,"e_fireball");this.altTimer.reset()}return"shoot"}}};e.e_arrow={role:"projectile",
cooldown:3E3,speed:200,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:256,spriteY:0,spriteAlign:true,bounce:false};e.e_trident={role:"projectile",cooldown:5E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:160,spriteY:0,spriteAlign:true,bounce:false};e.e_boulder={role:"projectile",cooldown:1500,speed:150,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:224,spriteY:0,rotate:true,bounce:false};e.e_bouncing_boulder={role:"projectile",cooldown:1500,speed:150,hitPoints:Infinity,
damage:15,spriteSheet:"objects",spriteX:224,spriteY:0,rotate:true,bounce:true,ttl:5E3};e.e_energy_ball={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:320,spriteY:0,rotate:true,bounce:false,damageType:"magic"};e.e_ring_fire={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:true,bounce:false,damageType:"magic"};e.e_ring_fire_blue={role:"projectile",cooldown:2E3,speed:150,hitPoints:Infinity,
damage:25,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:true,bounce:false,damageType:"magic"};e.e_fireball={role:"projectile",cooldown:2E3,speed:350,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:true,bounce:false,damageType:"magic"};e.e_fireball_2={role:"projectile",cooldown:75,speed:350,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:true,ttl:400,bounce:false,damageType:"magic"};e.e_static_blue_fire={role:"projectile",cooldown:100,
speed:0,hitPoints:Infinity,damage:5,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:true,rotateSpeed:100,ttl:1E3,bounce:false,drawIndex:0,damageType:"magic"};e.e_dirt_pile={role:"trap",cooldown:100,speed:0,hitPoints:Infinity,damage:0,spriteSheet:"characters",spriteX:0,spriteY:448,ttl:3E3,bounce:false,drawIndex:-2,onInit:function(){if(horde.randomRange(1,10)>5)this.spriteX+=32},onObjectCollide:function(b){b.team!==this.team&&b.role!=="projectile"&&b.addState(horde.Object.states.SLOWED,750)}};e.e_spit_pool=
{role:"trap",cooldown:100,speed:0,hitPoints:9999,damage:5,size:new horde.Size(64,64),spriteSheet:"characters",spriteX:896,spriteY:416,animated:true,ttl:7500,bounce:false,drawIndex:-1,collidable:false,onObjectCollide:function(b){b.team!==this.team&&b.role!=="projectile"&&b.addState(horde.Object.states.SLOWED,750)}};e.e_shock_wave={role:"projectile",cooldown:1E3,speed:200,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:224,spriteY:32,spriteAlign:true,bounce:false,animated:true,damageType:"magic"};
e.e_worm_spit={role:"projectile",cooldown:1E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:128,spriteY:64,spriteAlign:true,bounce:false,animated:true,damageType:"magic",onInit:function(){this.dieTimer=new horde.Timer;this.dieTimer.start(1E3)},onUpdate:function(b){this.dieTimer.update(b);this.dieTimer.expired()&&this.die()},onDelete:function(b){b.spawnObject(this,"e_spit_pool")}};e.mini_heart={role:"fluff",spriteSheet:"objects",spriteX:288,spriteY:128,size:new horde.Size(10,10),ttl:600,
speed:75,collidable:false,drawIndex:5,onInit:function(){this.setDirection(new horde.Vector2(0,-1));this.speed=horde.randomRange(55,85)}};e.mini_sparkle={role:"fluff",spriteSheet:"objects",spriteX:224,spriteY:128,size:new horde.Size(14,18),ttl:600,speed:75,collidable:false,drawIndex:5,onInit:function(){this.setDirection(new horde.Vector2(0,-1));this.speed=horde.randomRange(55,85)}};e.mini_sword={role:"fluff",spriteSheet:"objects",spriteX:256,spriteY:128,size:new horde.Size(10,16),ttl:600,speed:75,
collidable:false,drawIndex:5,onInit:function(){this.setDirection(new horde.Vector2(0,-1));this.speed=horde.randomRange(55,85)}};e.cloud={role:"fluff",spriteSheet:"objects",collidable:false,drawIndex:10,onInit:function(){this.alpha=0.25;this.speed=horde.randomRange(5,25);this.size=new horde.Size(192,128);switch(horde.randomRange(1,4)){case 1:this.spriteX=0;this.spriteY=288;break;case 2:this.spriteX=192;this.spriteY=288;break;case 3:this.spriteX=0;this.spriteY=416;break;case 4:this.spriteX=192;this.spriteY=
416;break}}};e.gate={role:"fluff",speed:25,spriteSheet:"objects",spriteX:0,spriteY:192,size:new horde.Size(64,64)};e.item_food={role:"powerup_food",healAmount:10,speed:0,spriteSheet:"objects",spriteX:96,spriteY:32,ttl:8E3};e.item_coin={role:"powerup_coin",coinAmount:10,speed:0,spriteSheet:"objects",spriteX:64,spriteY:32,ttl:5E3};e.item_chest={role:"powerup_coin",coinAmount:100,speed:0,spriteSheet:"objects",spriteX:32,spriteY:32,ttl:5E3};e.item_gold_chest={role:"powerup_coin",coinAmount:500,speed:0,
spriteSheet:"objects",spriteX:0,spriteY:32,ttl:5E3};e.item_weapon_knife={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:32,spriteY:0,ttl:5E3,wepType:"h_knife",wepCount:150};e.item_weapon_spear={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:96,spriteY:0,ttl:5E3,wepType:"h_spear",wepCount:75};e.item_weapon_fireball={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:192,spriteY:0,ttl:5E3,wepType:"h_fireball",wepCount:100};e.item_weapon_bomb={role:"powerup_weapon",
speed:0,spriteSheet:"objects",spriteX:128,spriteY:0,ttl:5E3,wepType:"h_bomb",wepCount:10};e.item_weapon_axe={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:192,spriteY:32,ttl:5E3,wepType:"h_axe",wepCount:150};e.item_weapon_fire_sword={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:384,spriteY:0,ttl:5E3,wepType:"h_fire_sword",wepCount:25}})();(function(){horde.ImageLoader=function(){this.images={};this.numImages=this.numLoaded=0};var e=horde.ImageLoader.prototype;e.load=function(a,b,d){this.callback=function(){b.call(d)};for(var f in a){this.numImages++;this.images[f]=new Image;horde.on("load",this.handleImageLoad,this.images[f],this);horde.on("error",this.handleImageError,this.images[f],this);this.images[f].src=a[f]}};e.increment=function(){this.numLoaded++;this.numLoaded>=this.numImages&&this.callback()};e.handleImageLoad=function(){this.increment()};
e.handleImageError=function(){this.increment()};e.getImage=function(a){if(this.images[a])return this.images[a];return false}})();(function(){horde.SpawnPoint=function(a,b,d,f){this.delay=500;this.lastSpawnElapsed=0;this.location=new horde.Rect(a,b,d,f);this.queue=[]};var e=horde.SpawnPoint.prototype;e.update=function(a){this.lastSpawnElapsed+=a;if(this.lastSpawnElapsed>=this.delay){this.lastSpawnElapsed=0;if(this.queue.length<1)return false;var b=this.queue.shift();a=this.location;b=horde.makeObject(b);b.position.x=horde.randomRange(a.left,a.left+a.width-b.size.width);b.position.y=horde.randomRange(a.top,a.top+a.height-b.size.height);
a=b.direction.clone();a.y=1;b.setDirection(a);return b}return false};e.queueSpawn=function(a,b){b=Number(b)||1;for(var d=0;d<b;d++)this.queue.push(a)}})();(function(){horde.SpawnWave=function(){this.points=[];this.nextWaveTime=2E4;this.bossWave=false};var e=horde.SpawnWave.prototype;e.addSpawnPoint=function(a,b){this.points.push({spawnPointId:a,delay:b,objects:[]})};e.addObjects=function(a,b,d){var f=null;for(var g in this.points)if(this.points[g].spawnPointId===a)f=this.points[g];if(f===null)return false;f.objects.push({type:b,count:Math.floor(d)})}})();(function(){(new horde.Engine).run()})();
</script>
	
</body>
</html>
