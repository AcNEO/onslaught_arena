<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="description" content="Onslaught! Arena is an HTML5 game made by Lost Decade Games. Fight off the horde with medieval weapons and powerups!">
	<meta name="keywords" content="onslaught arena, html5, chrome webstore, indie, browser-based, lost decade games, javascript, chiptunes, arcade, retro, oldschool, geoff blair, matt hackett, joshua morse">
	<link rel="icon" href="img/favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="css/horde.css?v=1.2.27">
	<title>Onslaught! Arena</title>
</head>
<body class="full">

	<div class="hidden">
		<h1>Onslaught! Arena</h1>
		<p>
			<strong>Onslaught! Arena</strong>
			is an HTML5 game made by <a href="http://www.lostdecadegames.com/">Lost Decade Games</a>.
		</p>
	</div>

	<div class="nav">
		<ul>
			<li><a href="http://goo.gl/Yurpd" target="_blank">Blog</a></li>
			<li><a href="http://goo.gl/As1FV" target="_blank">Support</a></li>
			<li><a href="http://goo.gl/WbQQ3" target="_blank">Twitter</a></li>
			<li><a href="http://goo.gl/CNHBo" target="_blank">Facebook</a></li>
		</ul>
	</div>

	<div class="ad leaderboard">
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-1209743261472499";
	/* onslaugh_arena_demo_1 */
	google_ad_slot = "1042513023";
	google_ad_width = 728;
	google_ad_height = 90;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>


	<div id="stage">
		<div id="tip">
			<div id="tip_message">
				<span>Enjoy the demo!</span>
				Buy the full version on the
				<a href="http://goo.gl/COiGK" target="_blank">Chrome Web Store</a>
				or
				<a href="http://itunes.apple.com/us/app/onslaught-arena/id418268106" target="_blank">Mac App Store</a>
				!
			</div>
		</div>
	</div>

	<script>
	/*
	This content (c) copyright 2010 Lost Decade Games, LLC.
	Guys, we worked hard on this. Please don't do anything shady with it.
	Thanks!
	*/
	(function () {
		(function(){var b={canvasFallbackContent:'<div class="fallback"><p>Your browser does not appear to support <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>.</p><p>Please try one of the following, more standards compliant browsers: <a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.apple.com/safari/">Safari</a>, <a href="http://www.mozilla.com/firefox/">Firefox</a> or <a href="http://www.opera.com/">Opera</a>.</p></div>',setInterval:function(b,a,d){return window.setInterval(function(){a.call(d)},
b)},setTimeout:function(b,a,d){return window.setTimeout(function(){a.call(d)},b)},on:function(b,a,d,i){d.addEventListener(b,function(d){a.call(i,d)},!1)},stopEvent:function(b){b.cancelBubble=!0;b.stopPropagation();b.preventDefault()},now:function(){return Date.now()}};b.makeCanvas=function(c,a,d,i){var e=document.createElement("canvas");e.id=c;e.width=Number(a)||0;e.height=Number(d)||0;if(i!==!0)e.innerHTML=b.canvasFallbackContent,document.getElementById("stage").appendChild(e);return e};b.getOffset=
function(b){for(var a={x:b.offsetLeft,y:b.offsetTop};;){b=b.parentNode;if(b===document.body)break;a.x+=b.offsetLeft;a.y+=b.offsetTop}return a};b.randomRange=function(b,a){return Math.round(Math.random()*(a-b))+b};b.clamp=function(b,a,d){return Math.min(Math.max(b,a),d)};b.randomDirection=function(){var c=new b.Vector2(b.randomRange(-10,10),b.randomRange(-10,10));c.normalize();return c};b.makeObject=function(c,a){var d=new b.Object;d.type=c;for(var i in b.objectTypes[c])d[i]=b.objectTypes[c][i];a!==
!0&&d.init();return d};b.directions={UP:0,UP_RIGHT:1,RIGHT:2,DOWN_RIGHT:3,DOWN:4,DOWN_LEFT:5,LEFT:6,UP_LEFT:7,toVector:function(c){c<0&&(c+=8);c>7&&(c-=8);switch(c){case b.directions.UP:return new b.Vector2(0,-1);case b.directions.UP_RIGHT:return new b.Vector2(1,-1);case b.directions.RIGHT:return new b.Vector2(1,0);case b.directions.DOWN_RIGHT:return new b.Vector2(1,1);case b.directions.DOWN:return new b.Vector2(0,1);case b.directions.DOWN_LEFT:return new b.Vector2(-1,1);case b.directions.LEFT:return new b.Vector2(-1,
0);case b.directions.UP_LEFT:return new b.Vector2(-1,-1)}},fromVector:function(c){if(c.x>-0.25&&c.x<0.25&&c.y<0)return b.directions.UP;if(c.x>-0.25&&c.x<0.25&&c.y>0)return b.directions.DOWN;if(c.x>0&&c.y>-0.25&&c.y<0.25)return b.directions.RIGHT;if(c.x<0&&c.y>-0.25&&c.y<0.25)return b.directions.LEFT;if(c.x>0&&c.y<0)return b.directions.UP_RIGHT;if(c.x>0&&c.y>0)return b.directions.DOWN_RIGHT;if(c.x<0&&c.y>0)return b.directions.DOWN_LEFT;if(c.x<0&&c.y<0)return b.directions.UP_LEFT}};b.x=function(b,a){for(var d=
0,i="",e=0;e<a.length;++e)d+=a.charCodeAt(e);for(e=0;e<b.length;++e)i+=String.fromCharCode(d^b.charCodeAt(e));return i};(function(){var c=[];b.log=function(a){c.push(a);console.log(a)}})();(function(){b.Timer=function(){this.ttl=this.elapsed_ms=0};var c=b.Timer,a=c.prototype;c.now=function(){return Date.now()};a.start=function(a){if(a)this.ttl=Number(a);this.elapsed_ms=0};a.update=function(a){this.elapsed_ms+=a};a.reset=function(){this.start()};a.elapsed=function(){return this.elapsed_ms};a.expired=
function(){return this.ttl>0?this.elapsed_ms>this.ttl:!1}})();(function(){b.sound={};var c="html5",a=!1,d={},i=!1;b.sound.init=function(a){if(typeof Audio=="undefined")i=!0;else switch(i=!1,c){case "ios":a();break;case "sm2":soundManager.useFastPolling=!0;soundManager.useHighPerformance=!0;soundManager.autoLoad=!0;soundManager.multiShot=!0;soundManager.volume=100;soundManager.onload=a;soundManager.useHTML5Audio=!1;soundManager.onerror=function(d){return function(){c="html5";d(a)}}(arguments.callee);
break;case "html5":var d=document.createElement("audio");d.canPlayType&&(d.canPlayType("audio/mpeg;")||(c=null));a()}};b.sound.create=function(a,b,h,g){if(!i)switch(h=Boolean(h),b+=".mp3",g===void 0&&(g=100),c){case "sm2":a={id:a,url:b,volume:g};if(h)a.onfinish=function(){this.play()};soundManager.createSound(a).load();break;case "html5":var j=new Audio;j.preload="auto";j.src=b;h?j.addEventListener("ended",function(){this.currentTime=0;this.play()},!1):j.addEventListener("ended",function(){this.pause();
this.currentTime=0},!1);j.load();j.volume=g/100;d[a]=j}};b.sound.isPlaying=function(a){if(!i)switch(c){case "sm2":return(a=soundManager.getSoundById(a))?a.playState===1:!1;case "html5":return d[a].currentTime>0}};b.sound.play=function(b){if(!i){if(a)return!1;switch(c){case "ios":location.href="jsbridge://"+b;break;case "sm2":soundManager.play(b);break;case "html5":try{d[b].pause(),d[b].currentTime=0,d[b].play()}catch(f){}}}};b.sound.stop=function(a){if(!i)switch(c){case "sm2":soundManager.stop(a);
break;case "html5":d[a].pause(),d[a].currentTime=0}};b.sound.stopAll=function(){if(!i)switch(c){case "sm2":soundManager.stopAll();break;case "html5":try{for(var a in d)d[a].pause(),d[a].currentTime=0}catch(b){console.log("[ERROR horde.sound.stopAll]",b)}}};b.sound.pauseAll=function(){if(!i)switch(c){case "sm2":soundManager.pauseAll();break;case "html5":for(var a in d)d[a].currentTime>0&&d[a].pause()}};b.sound.resumeAll=function(){if(!i)switch(c){case "sm2":soundManager.resumeAll();break;case "html5":for(var a in d)d[a].currentTime>
0&&d[a].play()}};b.sound.toggleMuted=function(){b.sound.setMuted(!b.sound.isMuted())};b.sound.isMuted=function(){return a};b.sound.setMuted=function(d){a!==d&&((a=d)?b.sound.pauseAll():b.sound.resumeAll())}})();(function(){b.Size=function(b,a){this.width=Number(b)||0;this.height=Number(a)||0}})();(function(){b.Vector2=function(a,b){this.x=Number(a)||0;this.y=Number(b)||0};var c=b.Vector2,a=c.prototype;c.fromSize=function(a){return new b.Vector2(a.width,a.height)};c.fromHeading=function(a,i){i=Number(i)||
1;return new b.Vector2(Math.sin(a)*i,-Math.cos(a)*i)};a.clone=function(){return new b.Vector2(this.x,this.y)};a.scale=function(a){this.x*=a;this.y*=a;return this};a.add=function(a){this.x+=a.x;this.y+=a.y;return this};a.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};a.zero=function(){this.y=this.x=0;return this};a.invert=function(){this.x*=-1;this.y*=-1;return this};a.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.normalize=function(){var a=this.magnitude();return a===
0?this:this.scale(1/a)};a.toString=function(){return this.x+", "+this.y};a.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};a.abs=function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y);return this};a.angle=function(){return this.heading()*(180/Math.PI)};a.heading=function(){return Math.atan2(this.x,-this.y)}})();(function(){b.Rect=function(a,b,e,c){this.left=Number(a)||0;this.top=Number(b)||0;this.width=Number(e)||0;this.height=Number(c)||0};var c=b.Rect,a=c.prototype;
c.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};a.center=function(){var a=new b.Vector2(this.width,this.height);return(new b.Vector2(this.left,this.top)).add(a.scale(0.5))};a.intersects=function(a){return c.intersects(this,a)};a.reduce=function(a){this.left+=a;this.top+=a;this.width-=a*2;this.height-=a*2;return this}})();(function(){b.Keyboard=function(){this.history=[];this.keyStates={};this.lastKeyStates={};b.on("keydown",
this.handleKeyDown,window,this);b.on("keyup",this.handleKeyUp,window,this)};var c=b.Keyboard,a=c.prototype,d={ESCAPE:27,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,D:68,E:69,F:70,G:71,K:75,L:76,M:77,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,W:87,X:88,Z:90};c.Keys=d;c.konamiCode=[d.UP,d.UP,d.DOWN,d.DOWN,d.LEFT,d.RIGHT,d.LEFT,d.RIGHT,d.B,d.A];c.debugCode=[d.L,d.D,d.D,d.E,d.B,d.U,d.G];c.resetCode=[d.L,d.D,d.R,d.E,d.S,d.E,d.T];c.godModeCode=[d.L,d.D,d.D,d.Q,d.D];c.allWeaponsCode=[d.L,d.D,d.K,
d.F,d.A];c.awesmCode=[d.A,d.W,d.E,d.S,d.M];c.bombCode=[d.L,d.D,d.B,d.O,d.M,d.B];c.cyclopsCode=[67,89,67,d.L,d.O,d.P,d.S];c.html5Code=[72,84,77,76,53];c.meatboyCode=[d.M,d.E,d.A,d.T];a.supressKeys=function(a){switch(a.keyCode){case d.ENTER:case d.LEFT:case d.UP:case d.RIGHT:case d.DOWN:case d.B:case d.A:case d.M:case d.Z:case d.X:case d.P:case d.SPACE:case d.W:case d.S:case d.D:case 191:b.stopEvent(a)}};a.handleKeyDown=function(a){this.history.push(a.keyCode);this.keyStates[a.keyCode]=!0;this.supressKeys(a)};
a.handleKeyUp=function(a){this.keyStates[a.keyCode]=!1;this.supressKeys(a)};a.isKeyDown=function(a){return this.keyStates[a]===!0};a.isKeyPressed=function(a){return this.isKeyDown(a)&&this.lastKeyStates[a]!==!0};a.isAnyKeyPressed=function(a){for(a in this.keyStates)if(this.isKeyDown(a)&&this.lastKeyStates[a]!==!0)return!0;return!1};a.clearKey=function(a){this.keyStates[a]=!1};a.clearKeys=function(){this.keyStates={}};a.clearHistory=function(){this.history=[]};a.historyMatch=function(a){var d=a.length,
b=this.history.slice(-d);if(b.length!==d)return!1;for(var c=0;c<d;c++)if(a[c]!==b[c])return!1;return!0};a.storeKeyStates=function(){for(var a in this.keyStates)this.lastKeyStates[a]=this.keyStates[a]}})();(function(){b.Mouse=function(a){this.buttonStates={};this.mouseY=this.mouseX=0;this.canvas=a;this.lastButtonStates={};b.on("mousemove",this.handleMouseMove,window,this);b.on("mousedown",this.handleMouseDown,window,this);b.on("mouseup",this.handleMouseUp,window,this)};var c=b.Mouse,a=c.prototype;
c.Buttons={LEFT:0,RIGHT:2};a.handleMouseMove=function(a){var i=b.getOffset(this.canvas);this.mouseX=(a.clientX-i.x)*640/this.canvas.offsetWidth;this.mouseY=(a.clientY-i.y)*480/this.canvas.offsetHeight;this.hasMoved=!0};a.handleMouseDown=function(a){this.buttonStates[a.button]=!0;b.stopEvent(a);window.focus&&window.focus()};a.handleMouseUp=function(a){this.buttonStates[a.button]=!1};a.isButtonDown=function(a){return this.buttonStates[a]};a.isAnyButtonDown=function(){for(var a in this.buttonStates)if(this.buttonStates[a])return!0;
return!1};a.clearButtons=function(){this.buttonStates={}};a.wasButtonClicked=function(a){return this.buttonStates[a]&&!this.lastButtonStates[a]};a.storeButtonStates=function(){for(var a in this.buttonStates)this.lastButtonStates[a]=this.buttonStates[a]}})();b.isDemo=function(){return!1};b.populateWaves=function(c){var a=new b.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"bat",1);a.addObjects(1,"bat",1);a.addObjects(2,"bat",1);c.waves.push(a);a=new b.SpawnWave;
a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"goblin",2);a.addObjects(1,"goblin",2);a.addObjects(2,"goblin",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"cyclops",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"demoblin",2);a.addObjects(1,"demoblin",3);a.addObjects(2,"demoblin",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,750);
a.addSpawnPoint(2,500);a.addObjects(0,"bat",5);a.addObjects(0,"goblin",2);a.addObjects(1,"goblin",2);a.addObjects(1,"cyclops",1);a.addObjects(1,"goblin",3);a.addObjects(2,"bat",5);a.addObjects(2,"goblin",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,200);a.addSpawnPoint(1,200);a.addSpawnPoint(2,200);a.addObjects(0,"bat",10);a.addObjects(1,"bat",10);a.addObjects(2,"bat",10);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,
"demoblin",3);a.addObjects(1,"cyclops",1);a.addObjects(1,"goblin",5);a.addObjects(2,"demoblin",3);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,5E3);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,5E3);a.addObjects(0,"imp",5);a.addObjects(1,"imp",10);a.addObjects(2,"imp",5);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,750);a.addSpawnPoint(1,750);a.addSpawnPoint(2,750);a.addObjects(0,"cyclops",1);a.addObjects(2,"cyclops",1);a.addObjects(0,"bat",10);a.addObjects(1,"bat",10);a.addObjects(2,"bat",
10);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"cube",1);a.bossWave=!0;a.bossName="Gelatinous Cube";c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,2E4);a.addSpawnPoint(1,2E4);a.addSpawnPoint(2,2E4);a.addObjects(0,"sandworm",2);a.addObjects(1,"sandworm",2);a.addObjects(2,"sandworm",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1E4);a.addSpawnPoint(1,1E4);a.addSpawnPoint(2,1E4);a.addObjects(0,"wizard",2);a.addObjects(1,"wizard",2);a.addObjects(2,"wizard",2);
c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,7500);a.addSpawnPoint(1,7500);a.addSpawnPoint(2,7500);a.addObjects(0,"flaming_skull",2);a.addObjects(1,"flaming_skull",2);a.addObjects(2,"flaming_skull",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,15E3);a.addObjects(0,"owlbear",1);a.addObjects(2,"owlbear",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"huge_skull",
1);a.addObjects(1,"huge_skull",1);a.addObjects(2,"huge_skull",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,4E3);a.addSpawnPoint(2,500);a.addObjects(0,"dire_bat",5);a.addObjects(0,"hunter_goblin",2);a.addObjects(0,"dire_bat",5);a.addObjects(0,"hunter_goblin",2);a.addObjects(1,"sandworm",2);a.addObjects(2,"dire_bat",5);a.addObjects(2,"hunter_goblin",2);a.addObjects(2,"dire_bat",5);a.addObjects(2,"hunter_goblin",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,
3E3);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,3E3);a.addObjects(0,"flaming_skull",2);a.addObjects(1,"imp",5);a.addObjects(1,"wizard",3);a.addObjects(2,"flaming_skull",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1500);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,1500);a.addObjects(0,"cyclops",1);a.addObjects(0,"goblin",5);a.addObjects(1,"demoblin",3);a.addObjects(1,"owlbear",1);a.addObjects(1,"demoblin",5);a.addObjects(2,"goblin",5);a.addObjects(2,"cyclops",1);c.waves.push(a);a=new b.SpawnWave;
a.addSpawnPoint(0,3500);a.addSpawnPoint(1,4E3);a.addSpawnPoint(2,5E3);a.addObjects(0,"wizard",5);a.addObjects(1,"imp",5);a.addObjects(1,"owlbear",1);a.addObjects(2,"sandworm",3);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"superclops",1);a.bossWave=!0;a.bossName="Minotaur";c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,100);a.addSpawnPoint(1,100);a.addSpawnPoint(2,100);a.addObjects(0,"bat",15);a.addObjects(1,"dire_bat",15);a.addObjects(2,"bat",15);c.waves.push(a);
a=new b.SpawnWave;a.addSpawnPoint(0,1500);a.addSpawnPoint(1,1500);a.addSpawnPoint(2,1500);a.addObjects(0,"goblin",15);a.addObjects(1,"hunter_goblin",15);a.addObjects(2,"goblin",15);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,2E3);a.addSpawnPoint(1,2E3);a.addSpawnPoint(2,2E3);a.addObjects(0,"demoblin",12);a.addObjects(1,"demoblin",12);a.addObjects(2,"demoblin",12);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,25E3);a.addSpawnPoint(1,25E3);a.addSpawnPoint(2,25E3);a.addObjects(0,"cyclops",
2);a.addObjects(1,"cyclops",2);a.addObjects(2,"cyclops",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,3E3);a.addSpawnPoint(1,3E3);a.addSpawnPoint(2,3E3);a.addObjects(0,"imp",10);a.addObjects(1,"imp",10);a.addObjects(2,"imp",10);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,25E3);a.addSpawnPoint(1,25E3);a.addSpawnPoint(2,25E3);a.addObjects(0,"owlbear",2);a.addObjects(1,"owlbear",2);a.addObjects(2,"owlbear",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,12E3);a.addSpawnPoint(1,
12E3);a.addSpawnPoint(2,12E3);a.addObjects(0,"wizard",4);a.addObjects(1,"wizard",4);a.addObjects(2,"wizard",4);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,2E4);a.addSpawnPoint(2,15E3);a.addObjects(0,"flaming_skull",5);a.addObjects(1,"huge_skull",3);a.addObjects(2,"flaming_skull",5);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,15E3);a.addSpawnPoint(2,15E3);a.addObjects(0,"sandworm",5);a.addObjects(1,"sandworm",5);a.addObjects(2,"sandworm",
5);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"dragon",1);a.bossWave=!0;a.bossName="Green Dragon";c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,3500);a.addSpawnPoint(1,3500);a.addSpawnPoint(2,3500);a.addObjects(0,"goblin",25);a.addObjects(1,"demoblin",25);a.addObjects(2,"hunter_goblin",25);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,7500);a.addSpawnPoint(1,5E3);a.addSpawnPoint(2,7500);a.addObjects(0,"sandworm",2);a.addObjects(0,"wizard",3);a.addObjects(1,
"imp",10);a.addObjects(2,"sandworm",2);a.addObjects(2,"wizard",3);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,7500);a.addSpawnPoint(2,15E3);a.addObjects(0,"owlbear",3);a.addObjects(1,"flaming_skull",6);a.addObjects(2,"owlbear",3);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,2500);a.addSpawnPoint(1,15E3);a.addSpawnPoint(2,2500);a.addObjects(0,"demoblin",10);a.addObjects(0,"goblin",10);a.addObjects(1,"cyclops",1);a.addObjects(1,"owlbear",1);a.addObjects(1,"cyclops",
1);a.addObjects(1,"owlbear",1);a.addObjects(2,"demoblin",10);a.addObjects(2,"goblin",10);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,12500);a.addSpawnPoint(1,2E4);a.addSpawnPoint(2,12500);a.addObjects(0,"sandworm",5);a.addObjects(1,"huge_skull",1);a.addObjects(1,"owlbear",1);a.addObjects(1,"cyclops",1);a.addObjects(1,"huge_skull",1);a.addObjects(2,"sandworm",5);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,2E4);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,2E4);a.addObjects(0,"cyclops",1);
a.addObjects(0,"flaming_skull",1);a.addObjects(1,"wizard",8);a.addObjects(2,"cyclops",1);a.addObjects(2,"flaming_skull",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,4E3);a.addSpawnPoint(1,1E4);a.addSpawnPoint(2,4E3);a.addObjects(0,"demoblin",8);a.addObjects(1,"owlbear",2);a.addObjects(2,"demoblin",8);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,5E3);a.addSpawnPoint(1,7500);a.addSpawnPoint(2,5E3);a.addObjects(0,"sandworm",1);a.addObjects(0,"wizard",3);a.addObjects(1,"flaming_skull",
4);a.addObjects(1,"huge_skull",1);a.addObjects(2,"sandworm",1);a.addObjects(2,"wizard",3);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,2E3);a.addSpawnPoint(1,2500);a.addSpawnPoint(2,2E3);a.addObjects(0,"goblin",30);a.addObjects(1,"demoblin",25);a.addObjects(2,"hunter_goblin",30);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"beholder",1);a.bossWave=!0;a.bossName="Beholder";c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,3E3);a.addSpawnPoint(1,3E3);a.addSpawnPoint(2,
3E3);a.addObjects(0,"cyclops",2);a.addObjects(1,"owlbear",2);a.addObjects(2,"cyclops",2);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"wizard",3);a.addObjects(0,"flaming_skull",1);a.addObjects(1,"wizard",3);a.addObjects(1,"huge_skull",1);a.addObjects(2,"wizard",3);a.addObjects(2,"flaming_skull",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,3E3);a.addSpawnPoint(1,3E3);a.addSpawnPoint(2,3E3);a.addObjects(0,"sandworm",
3);a.addObjects(0,"owlbear",1);a.addObjects(1,"sandworm",3);a.addObjects(1,"huge_skull",1);a.addObjects(2,"sandworm",3);a.addObjects(2,"cyclops",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,200);a.addSpawnPoint(1,200);a.addSpawnPoint(2,200);a.addObjects(0,"dire_bat",20);a.addObjects(0,"wizard",2);a.addObjects(0,"cyclops",1);a.addObjects(1,"dire_bat",20);a.addObjects(1,"sandworm",2);a.addObjects(1,"owlbear",1);a.addObjects(2,"dire_bat",20);a.addObjects(2,"wizard",2);a.addObjects(2,"cyclops",
1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,3E3);a.addSpawnPoint(1,3E3);a.addSpawnPoint(2,3E3);a.addObjects(0,"goblin",10);a.addObjects(0,"cyclops",1);a.addObjects(0,"wizard",3);a.addObjects(1,"demoblin",10);a.addObjects(1,"huge_skull",1);a.addObjects(1,"sandworm",3);a.addObjects(2,"hunter_goblin",10);a.addObjects(2,"owlbear",1);a.addObjects(2,"flaming_skull",3);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,2500);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,2500);a.addObjects(0,"wizard",
4);a.addObjects(1,"cube",1);a.addObjects(2,"wizard",4);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"demoblin",5);a.addObjects(1,"superclops",1);a.addObjects(1,"demoblin",4);a.addObjects(2,"demoblin",5);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,3E4);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,3E4);a.addObjects(0,"sandworm",1);a.addObjects(0,"owlbear",1);a.addObjects(1,"dragon",1);a.addObjects(2,"sandworm",1);a.addObjects(2,
"owlbear",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(0,15E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,15E3);a.addObjects(0,"wizard",1);a.addObjects(0,"cyclops",1);a.addObjects(1,"beholder",1);a.addObjects(2,"wizard",1);a.addObjects(2,"cyclops",1);c.waves.push(a);a=new b.SpawnWave;a.addSpawnPoint(1,1E3);a.addObjects(1,"doppelganger",1);a.bossWave=!0;a.bossName="Doppelganger";c.waves.push(a)};(function(){b.Engine=function(){this.lastUpdate=0;this.canvases={};this.map=null;this.spawnPoints=
[];this.objects={};this.objectIdSeed=0;this.playerObjectId=null;this.keyboard=new b.Keyboard;this.view=new b.Size(640,480);this.images=null;this.running=this.konamiEntered=this.debug=!1;this.gateDirection="";this.gateState="down";this.pointerOptionsStart=this.maxPointerY=this.pointerYStart=this.pointerY=this.gatesY=this.gatesX=0;this.targetReticle={position:new b.Vector2,angle:0,moving:!1};this.enableClouds=this.enableFullscreen=!1;this.cloudTimer=null;this.woundsToSpeed=10;this.introTimer=new b.Timer;
this.introPhase=0;this.wonGame=this.introPhaseInit=!1;this.wonGamePhase=0;this.weaponPickup={type:null,state:"off",alpha:1,scale:1,position:new b.Vector2};this.coinPickup={amount:0,state:"off",alpha:1,position:new b.Vector2};this.touchMove=!1;this.canMute=!0;this.canFullscreen=!1;this.wasdMovesArrowsAttack=!0};var c=b.Engine.prototype;c.cacheBust=function(){return"?cachebust=1.2.27"};c.resize=function(){var a=window.innerWidth,d=window.innerHeight,b=document.getElementById("stage");d-=b.offsetTop;
b.style.height=d+"px";this.enableFullscreen?(height=d-50,height<480&&(height=480),height>768&&(height=768),b=Math.round(height*1.333)):(b=640,height=480);var e=this.canvases.display;e.style.width=b+"px";e.style.height=height+"px";a=Math.max(a/2-b/2,0);d=Math.max(d/2-height/2,30);e.style.left=a+"px";e.style.top=d+"px";if(e=document.getElementById("tip"))e.style.top=d-30+"px",e.style.left=a+"px",e.style.width=b+"px"};c.run=function(){this.init();this.lastUpdate=b.now();this.start()};c.start=function(){if(!this.running)this.interval=
b.setInterval(0,this.update,this),this.running=!0};c.stop=function(){if(this.running)clearInterval(this.interval),this.running=!1};c.togglePause=function(){var a=!1;return function(){if(!this.getPlayerObject().hasState(b.Object.states.DYING))this.paused?(this.paused=!1,b.sound.setMuted(a),b.sound.play("unpause"),b.sound.play(this.currentMusic)):(this.paused=!0,this.initOptions(),a=b.sound.isMuted(),b.sound.play("pause"),b.sound.stop(this.currentMusic))}}();c.addObject=function(a){this.objectIdSeed++;
var d="o"+this.objectIdSeed;a.id=d;this.objects[d]=a;return d};c.getBarColor=function(a,d){var b=d/a*100;return b>50?"rgb(98, 187, 70)":b>25?"rgb(246, 139, 31)":"rgb(238, 28, 36)"};c.spawnObject=function(a,d,i,e){for(var i=i||a.facing,d=b.makeObject(d,!0),c=a;c.ownerId!==null;)if(this.objects[c.ownerId])c=this.objects[c.ownerId];else break;if(e!==!1)d.ownerId=c.id,d.team=a.team;d.centerOn(a.boundingBox().center());d.setDirection(i);d.init();return this.addObject(d)};c.objectExists=function(a){return this.objects[a]};
c.getPlayerObject=function(){return this.objects[this.playerObjectId]};c.getObjectCountByType=function(a){var d=0,b;for(b in this.objects)this.objects[b].type===a&&d++;return d};c.isAlive=function(a){return this.objects[a]?(a=this.objects[a],a.alive&&a.wounds<a.hitPoints):!1};c.preloadComplete=function(){this.state="intro";this.logoAlpha=0;this.logoFade="in";this.logoFadeSpeed=0.5};c.init=function(){this.state="intro";this.canvases.display=b.makeCanvas("display",this.view.width,this.view.height);
this.canvases.buffer=b.makeCanvas("buffer",this.view.width,this.view.height,!0);this.canvases.waveText=b.makeCanvas("waveText",this.view.width,this.view.height,!0);this.resize();b.on("resize",this.resize,window,this);this.mouse=new b.Mouse(this.canvases.display);b.on("contextmenu",function(a){b.stopEvent(a)},document.body,this);b.on("blur",function(){this.stop();if(!(this.state!="running"||this.wonGame))this.keyboard.keyStates={},this.paused||this.togglePause()},window,this);b.on("focus",function(){this.start()},
window,this);this.preloader=new b.ImageLoader;this.preloader.load({ui:"img/sheet_ui.png"+this.cacheBust()},this.preloadComplete,this);this.images=new b.ImageLoader;this.images.load({arena:"img/sheet_arena.png"+this.cacheBust(),characters:"img/sheet_characters.png"+this.cacheBust(),objects:"img/sheet_objects.png"+this.cacheBust(),beholder:"img/sheet_beholder.png"+this.cacheBust()},this.handleImagesLoaded,this);this.getData("high_score")===null&&this.putData("high_score",1E3);this.initSound()};c.initSound=
function(){b.sound.init(function(){var a=b.sound;a.create("normal_battle_music","sound/music/normal_battle",!0,20);a.create("final_battle_music","sound/music/final_battle",!0,20);a.create("victory","sound/music/victory",!0,20);a.create("move_pointer","sound/effects/move_pointer",!1,50);a.create("select_pointer","sound/effects/select_pointer",!1,50);a.create("pause","sound/effects/pause");a.create("unpause","sound/effects/unpause");a.create("code_entered","sound/effects/code_entered");a.create("gate_opens",
"sound/effects/gate_opens");a.create("gate_closes","sound/effects/gate_closes");a.create("spike_attack","sound/effects/spike_attacks");a.create("immunity","sound/effects/immunity",!1,25);a.create("coins","sound/effects/coins",!1,10);a.create("eat_food","sound/effects/eat_food",!1,30);a.create("pickup_weapon","sound/effects/pickup_weapon");a.create("weapon_wall","sound/effects/weapon_wall",!1,25);a.create("fire_attack","sound/effects/char_attacks_fire");a.create("hero_attacks","sound/effects/char_attacks");
a.create("hero_damage","sound/effects/char_damage_3");a.create("hero_dies","sound/effects/char_dies");a.create("bat_damage","sound/effects/bat_damage");a.create("bat_dies","sound/effects/bat_dies");a.create("goblin_attacks","sound/effects/goblin_attacks");a.create("goblin_damage","sound/effects/goblin_damage");a.create("goblin_dies","sound/effects/goblin_dies");a.create("demoblin_attacks","sound/effects/demoblin_attacks",!1,80);a.create("imp_damage","sound/effects/imp_damage",!1,30);a.create("imp_dies",
"sound/effects/imp_dies",!1,30);a.create("gel_damage","sound/effects/gel_damage",!1,20);a.create("gel_dies","sound/effects/gel_dies",!1,20);a.create("skull_damage","sound/effects/skull_damage",!1,25);a.create("skull_dies","sound/effects/skull_dies",!1,5);a.create("wizard_attacks","sound/effects/wizard_attacks",!1,25);a.create("wizard_disappear","sound/effects/wizard_disappear",!1,50);a.create("wizard_reappear","sound/effects/wizard_reappear",!1,50);a.create("sandworm_attacks","sound/effects/sandworm_attacks",
!1,75);a.create("sandworm_dies","sound/effects/sandworm_dies",!1,40);a.create("cyclops_attacks","sound/effects/cyclops_attacks");a.create("cyclops_damage","sound/effects/cyclops_damage");a.create("cyclops_dies","sound/effects/cyclops_dies");a.create("owlbear_alarm","sound/effects/owlbear_alarm",!1,20);a.create("owlbear_attacks","sound/effects/owlbear_attacks",!1,15);a.create("owlbear_damage","sound/effects/owlbear_damage",!1,40);a.create("owlbear_dies","sound/effects/owlbear_dies",!1,50);a.create("cube_attacks",
"sound/effects/cube_attacks");a.create("cube_damage","sound/effects/cube_damage");a.create("cube_dies","sound/effects/cube_dies");a.create("minotaur_attacks","sound/effects/minotaur_attacks");a.create("minotaur_damage","sound/effects/minotaur_damage");a.create("minotaur_dies","sound/effects/minotaur_dies");a.create("dragon_attacks","sound/effects/dragon_attacks");a.create("dragon_damage","sound/effects/dragon_damage");a.create("dragon_dies","sound/effects/dragon_dies");a.create("beholder_damage",
"sound/effects/beholder_damage",!1,50);a.create("beholder_dies","sound/effects/beholder_dies",!1,25);a.create("eyelet_damage","sound/effects/eyelet_damage",!1,25);a.create("eyelet_dies","sound/effects/eyelet_dies",!1,25);a.create("dopp_attacks","sound/effects/dopp_attacks",!1,50);a.create("dopp_damage","sound/effects/dopp_damage",!1,50);a.create("dopp_dies","sound/effects/dopp_dies")})};c.initGame=function(){this.enableClouds=this.konamiEntered=!1;this.closeGates();this.objects={};this.state="title";
this.initOptions();this.initMap();this.initSpawnPoints();this.initWaves();this.initPlayer();this.gameOverBg=null;this.statsIndex=this.statsIncrement=this.statsCount=this.scoreCount=this.gotNewHighScore=this.monstersAlive=0;this.statsTimer=null;this.wonGame=this.highScoreSaved=!1;this.wonGamePhase=0;this.showReticle=!1;this.hideReticleTimer=null;this.showTutorial=!1;this.tutorialIndex=0;this.tutorialY=-70;this.tutorialDirection="down";this.nextTutorialTimer=this.hideTutorialTimer=null;this.heroFiring=
!1;this.heroFiringDirection=null;this.woundsTo=0;this.gameStartTime=b.now()};c.initMap=function(){this.tileSize=new b.Size(32,32);this.map=[[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]};c.initSpawnPoints=function(){this.spawnPoints=[];this.spawnPoints.push(new b.SpawnPoint(3*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2));this.spawnPoints.push(new b.SpawnPoint(9*this.tileSize.width,
-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2));this.spawnPoints.push(new b.SpawnPoint(15*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2))};c.initSpawnWave=function(a){var d=0,b;for(b in a.points){var e=a.points[b],c=this.spawnPoints[e.spawnPointId];c.delay=e.delay;c.lastSpawnElapsed=c.delay;for(var h in e.objects){var g=e.objects[h];c.queueSpawn(g.type,g.count)}e=(c.queue.length-1)*c.delay;e>d&&(d=e)}this.waveTimer.start(d+a.nextWaveTime);
this.openGates()};c.initWaves=function(){this.waves=[];this.waveTimer=new b.Timer;this.waveTimer.start(1);this.currentWaveId=-1;this.waveText={string:"",size:20,state:"off",alpha:0};b.populateWaves(this)};c.initPlayer=function(){var a=b.makeObject("hero");a.weapons=[{type:"h_sword",count:null}];a.centerOn(b.Vector2.fromSize(this.view).scale(0.5));this.playerObjectId=this.addObject(a);if(this.touchMove)this.targetReticle.position=a.boundingBox().center()};b.Engine.prototype.handleImagesLoaded=function(){this.imagesLoaded=
!0};c.logoFadeOut=function(){this.logoFade="out"};c.updateLogo=function(a){var d=this.keyboard;if(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown())d.clearKeys(),this.mouse.clearButtons(),this.initGame();if(this.logoFade==="in"){if(this.logoAlpha+=this.logoFadeSpeed/1E3*a,this.logoAlpha>=1)this.logoAlpha=1,this.logoFade="none",b.setTimeout(1E3,this.logoFadeOut,this)}else if(this.logoFade==="out"&&(this.logoAlpha-=this.logoFadeSpeed/1E3*a,this.logoAlpha<=0))this.logoAlpha=0,this.logoFade=
"none",this.initGame()};c.updateIntroCinematic=function(a){this.introTimer.update(a);switch(this.introPhase){case 0:if(!this.introPhaseInit)this.introFadeAlpha=0,this.introPhaseInit=!0;this.introFadeAlpha+=0.0010*a;if(this.introFadeAlpha>=1)this.introFadeAlpha=1,this.introPhase++,this.introPhaseInit=!1;break;case 1:if(!this.introPhaseInit)this.introFadeAlpha=1,this.introPhaseInit=!0;this.introFadeAlpha-=5.0E-4*a;if(this.introFadeAlpha<=0)this.introFadeAlpha=0,this.introPhase++,this.introPhaseInit=
!1;break;case 2:if(!this.introPhaseInit)this.introTimer.start(1E3),this.introPhaseInit=!0;if(this.introTimer.expired())this.introPhase++,this.introPhaseInit=!1;break;case 3:if(!this.introPhaseInit)this.openGates(),this.introPhaseInit=!0;if(this.gateState==="up")this.introPhase++,this.introPhaseInit=!1;break;case 4:if(!this.introPhaseInit){var d=b.makeObject("hero");d.position.x=304;d.position.y=-64;d.collidable=!1;d.setDirection(new b.Vector2(0,1));this.introHero=d;this.introPhaseInit=!0}this.introHero.update(a);
this.moveObject(this.introHero,a);if(this.introHero.position.y>=222)this.introHero.centerOn(b.Vector2.fromSize(this.view).scale(0.5)),this.introHero.stopMoving(),this.introPhase++,this.introPhaseInit=!1;break;case 5:case 6:case 8:if(!this.introPhaseInit)this.introTimer.start(500),this.introPhaseInit=!0;if(this.introTimer.expired())this.introPhase++,this.introPhaseInit=!1;break;case 7:if(!this.introPhaseInit)this.closeGates(),this.introPhaseInit=!0;if(this.gateState==="down")this.introPhase++,this.introPhaseInit=
!1;break;case 9:if(!this.introPhaseInit)this.introTimer.start(1E3),this.introPhaseInit=!0;this.introHero.update(a);if(this.introTimer.expired())this.currentMusic="normal_battle_music",b.sound.play(this.currentMusic),this.state="running"}};c.update=function(){var a=b.now(),d=a-this.lastUpdate;this.lastUpdate=a;this.lastElapsed=d;if(this.imagesLoaded===!0){switch(this.state){case "intro":this.updateLogo(d);this.render();break;case "title":this.handleInput();this.updateFauxGates(d);this.render();break;
case "credits":this.handleInput();this.render();break;case "intro_cinematic":this.handleInput();this.updateIntroCinematic(d);this.updateFauxGates(d);this.render();break;case "running":this.wonGame?this.updateWonGame(d):this.handleInput();this.paused||(this.updateWaves(d),this.updateSpawnPoints(d),this.updateClouds(d),this.updateObjects(d),this.updateFauxGates(d),this.updateWeaponPickup(d),this.updateCoinPickup(d));this.showTutorial&&this.updateTutorial(d);this.render();break;case "game_over":this.updateGameOver(d);
this.render();break;case "buy_now":this.handleInput(),this.render()}if(!this.hideReticleTimer)this.hideReticleTimer=new b.Timer;if(this.mouse.hasMoved)this.showReticle=!0,this.hideReticleTimer.start(5E3),this.nextTutorial(3);this.hideReticleTimer.update(d);if(this.hideReticleTimer.expired())this.showReticle=!1;this.mouse.hasMoved=!1}};c.updateWeaponPickup=function(a){var d=this.weaponPickup;if(d.state==="on"&&(d.scale+=0.0045*a,d.alpha-=0.0025*a,d.alpha<=0))d.state="off"};c.updateCoinPickup=function(a){var d=
this.coinPickup;if(d.state==="on"&&(d.position.y-=0.05*a,d.alpha-=7.0E-4*a,d.alpha<=0))d.state="off"};c.updateWonGame=function(a){var d=this.getPlayerObject();this.roseTimer&&this.roseTimer.update(a);switch(this.wonGamePhase){case 0:a=new b.Vector2(304,192);d.moveToward(a);d=d.position.clone().subtract(a).abs();d.x<=5&&d.y<=5&&this.wonGamePhase++;break;case 1:d.setDirection(new b.Vector2(0,1));d.stopMoving();d.addState(b.Object.states.VICTORIOUS);this.roseTimer=new b.Timer;this.roseTimer.start(100);
this.rosesThrown=0;this.wonGamePhase++;break;case 2:if(this.roseTimer.expired())++this.rosesThrown,d=b.makeObject("rose"),b.randomRange(1,2)===2?(d.position.x=-32,d.position.y=b.randomRange(100,300),d.setDirection(new b.Vector2(1,0))):(d.position.x=682,d.position.y=b.randomRange(100,300),d.setDirection(new b.Vector2(-1,0))),this.addObject(d),this.roseTimer.reset();this.rosesThrown>100&&this.endGame()}};c.updateClouds=function(a){if(this.enableClouds===!0){if(this.cloudTimer===null)this.cloudTimer=
new b.Timer,this.cloudTimer.start(2E3);this.cloudTimer.update(a);var a=0,d;for(d in this.objects){var i=this.objects[d];i.type==="cloud"&&(a++,i.position.x<-i.size.width&&i.die())}if(a<10&&this.cloudTimer.expired()){if(b.randomRange(1,10)>=1){d=b.randomRange(1,3);for(a=0;a<d;a++)i=b.makeObject("cloud"),i.position.x=640+b.randomRange(1,32),i.position.y=b.randomRange(-(i.size.height/2),480+i.size.height/2),i.setDirection(new b.Vector2(-1,0)),this.addObject(i)}this.cloudTimer.reset()}}};c.updateSpawnPoints=
function(a){if(this.gateState==="up"){var d=!0,b;for(b in this.spawnPoints){this.spawnPoints[b].queue.length>=1&&(d=!1);var c=this.spawnPoints[b].update(a,this.monstersAlive===0);c!==!1&&this.addObject(c)}d&&!this.monstersAboveGates&&this.closeGates()}};c.spawnWaveExtras=function(a){switch(a){case 1:var d=this.getPlayerObject(),a=b.makeObject("item_weapon_knife");a.position=d.position.clone();a.position.x-=96;a.position.y+=64;this.addObject(a);a=b.makeObject("item_weapon_spear");a.position=d.position.clone();
a.position.x-=32;a.position.y+=64;this.addObject(a);a=b.makeObject("item_weapon_axe");a.position=d.position.clone();a.position.x+=32;a.position.y+=64;this.addObject(a);a=b.makeObject("item_weapon_fireball");a.position=d.position.clone();a.position.x+=96;a.position.y+=64;this.addObject(a);break;case 11:for(var i=[{x:192,y:224},{x:416,y:224}],d=i.length,a=0;a<d;++a){var c=i[a],f=b.makeObject("spikes");f.position=new b.Vector2(c.x,c.y);this.addObject(f)}break;case 21:i=[{x:32,y:64},{x:32,y:352},{x:576,
y:64},{x:576,y:352}];d=i.length;for(a=0;a<d;a++)c=i[a],f=b.makeObject("spike_sentry"),f.position=new b.Vector2(c.x,c.y),this.addObject(f);break;case 31:i=[{x:304,y:114},{x:304,y:304}];d=i.length;for(a=0;a<d;++a)c=i[a],f=b.makeObject("spikes"),f.position=new b.Vector2(c.x,c.y),this.addObject(f);break;case 41:this.enableClouds=!0;break;case 50:for(d in this.objects)a=this.objects[d],a.role==="trap"&&a.die()}};c.updateWaves=function(a){if(!this.wonGame){this.waveTimer.update(a);var d=!0,i;for(i in this.spawnPoints)this.spawnPoints[i].queue.length>
0&&(d=!1);if(d===!0&&this.monstersAlive===0){if(this.currentWaveId===this.waves.length-1){this.wonGame=!0;b.sound.stop("normal_battle_music");b.sound.stop("final_battle_music");b.sound.play("victory");return}this.currentWaveId++;d=this.currentWaveId+1;if(this.continuing||this.waveHack){for(i=this.waveHack?1:2;i<=d;++i)this.spawnWaveExtras(i);this.waveHack=!1}else this.spawnWaveExtras(d);i="Wave "+d;d>1&&(this.putData("checkpoint_wave",this.currentWaveId),this.putData("checkpoint_hero",JSON.stringify(this.getPlayerObject())));
if(this.waves[this.currentWaveId].bossWave)i="Boss: "+this.waves[this.currentWaveId].bossName+"!",b.sound.isPlaying("normal_battle_music")&&b.sound.stop("normal_battle_music"),this.currentMusic="final_battle_music",b.sound.play(this.currentMusic);else if(b.sound.isPlaying("final_battle_music")&&b.sound.stop("final_battle_music"),!b.sound.isPlaying("normal_battle_music"))this.currentMusic="normal_battle_music",b.sound.play(this.currentMusic);this.initSpawnWave(this.waves[this.currentWaveId]);this.waveText.string=
i;this.waveText.alpha=0;this.waveText.size=1;this.waveText.state="init";d=this.canvases.waveText.getContext("2d");i=this.waveText.string;d.clearRect(0,0,640,480);d.save();d.font="Bold 40px MedievalSharp";d.lineWidth=3;d.textBaseline="top";d.strokeStyle="rgb(0, 0, 0)";d.fillStyle="rgb(230, 103, 8)";d.strokeText(i,0,0);d.fillText(i,0,0);this.waveText.width=d.measureText(i).width;d.restore();this.continuing=!1}switch(this.waveText.state){case "init":this.waveText.alpha+=0.0020*a;if(this.waveText.alpha>=
1)this.waveText.alpha=1,this.waveText.timer=new b.Timer,this.waveText.timer.start(250),this.waveText.state="display";break;case "display":this.waveText.timer.update(a);if(this.waveText.timer.expired())this.waveText.state="hide";break;case "hide":if(this.waveText.alpha-=0.0015*a,this.waveText.size+=0.02*a,this.waveText.alpha<=0)this.waveText.alpha=0,this.waveText.state="off"}}};c.updateGameOver=function(a){if(!this.gameOverAlpha)this.gameOverReady=!1,this.gameOverAlpha=0;this.gameOverAlpha+=Number(2.0E-4*
a)||0;if(this.gameOverAlpha>=0.75)this.gameOverReady=!0,this.gameOverAlpha=0.75;if(this.gameOverReady){if(!this.statsTimer)this.statsTimer=new b.Timer,this.statsIndex=this.statsCount=0,this.statsTimer.start(50),this.statsIncrement=1;this.statsTimer.update(a);this.statsTimer.expired()&&(this.statsTimer.reset(),this.statsCount+=this.statsIncrement)}if(this.statsIndex>=4&&!this.highScoreSaved){this.highScoreSaved=!0;var a=Number(this.getData("high_score")),d=this.getTotalScore();if(d>a)this.putData("high_score",
d),b.sound.play("victory"),this.gotNewHighScore=!0}};c.openGates=function(){if(this.gateState!=="up")this.gateDirection="up",b.sound.play("gate_opens")};c.closeGates=function(){if(this.gateState!=="down")this.gateDirection="down",b.sound.play("gate_closes")};c.updateFauxGates=function(a){if(this.gateDirection==="down"&&(this.gatesX=0,this.gatesY+=0.2*a,this.gatesY>=0))this.gatesY=this.gatesX=0,this.gateDirection="",this.gateState="down";if(this.gateDirection==="up"&&(this.gatesX=b.randomRange(-1,
1),this.gatesY-=0.05*a,this.gatesY<=-54))this.gatesX=0,this.gatesY=-54,this.gateDirection="",this.gateState="up"};c.updateTutorial=function(a){if(this.tutorialDirection==="down"&&(this.tutorialY+=0.1*a,this.tutorialY>=0))this.tutorialY=0,this.tutorialDirection=null,this.tutorialIndex>=4&&this.hideTutorialTimer.start(5E3);if(this.tutorialDirection==="up"&&(this.tutorialY-=0.1*a,this.tutorialY<-70&&(this.tutorialY=-70,this.tutorialDirection="down",this.tutorialIndex+=1,this.tutorialIndex>4)))this.showTutorial=
!1;if(!this.hideTutorialTimer)this.hideTutorialTimer=new b.Timer;if(!this.nextTutorialTimer)this.nextTutorialTimer=new b.Timer,this.nextTutorialTimer.start(1E4);this.hideTutorialTimer.update(a);this.nextTutorialTimer.update(a);if(this.hideTutorialTimer.expired())this.tutorialDirection="up";this.nextTutorialTimer.expired()&&(this.nextTutorial(this.tutorialIndex+1),this.nextTutorialTimer.reset())};c.nextTutorial=function(a){if(this.showTutorial&&this.tutorialDirection===null&&this.tutorialIndex===a-
1)this.tutorialDirection="up"};c.getTilesByRect=function(a){for(var d=[],i=new b.Vector2(a.left,a.top),c=new b.Vector2(a.width,a.height),a=i.clone().scale(1/this.tileSize.width).floor(),i=i.clone().add(c).scale(1/this.tileSize.width).floor(),c=a.x;c<=i.x;c++)for(var f=a.y;f<=i.y;f++)d.push({x:c,y:f});return d};c.checkTileCollision=function(a){for(var a=this.getTilesByRect(a.boundingBox()),d=0,b=a.length;d<b;d++){var c=a[d];if(this.map[c.y]&&this.map[c.y][c.x]===0)return c}return!1};c.moveObject=function(a,
d){if(!a.badass&&a.hasState(b.Object.states.HURTING))return!1;var i=a.speed;a.hasState(b.Object.states.SLOWED)&&(i*=0.2);var c=i/1E3*d,i=[];if(a.direction.x!==0&&(a.position.x+=a.direction.x*c,a.collidable)){if(a.position.x<16)a.position.x=16;if(a.position.x+a.size.width>624)a.position.x=624-a.size.width;var f=this.checkTileCollision(a);if(f!==!1)i.push("x"),a.position.x=a.position.x+a.size.width/2<f.x*this.tileSize.width+this.tileSize.width/2?f.x*this.tileSize.width-a.size.width:f.x*this.tileSize.width+
this.tileSize.width}if(a.direction.y!==0&&(a.position.y+=a.direction.y*c,a.collidable)){if(a.position.y+a.size.height>400)a.position.y=400-a.size.height;f=this.checkTileCollision(a);if(f!==!1)i.push("y"),a.position.y=a.position.y+a.size.height/2<f.y*this.tileSize.height+this.tileSize.height/2?f.y*this.tileSize.height-a.size.height:f.y*this.tileSize.height+this.tileSize.height}if(a.collidable){c=0;if(this.gateState==="down"||a.role==="monster"||a.role==="hero")c=64;if(a.direction.y<0&&a.position.y<
c)a.position.y=c,i.push("y");i.length>0&&a.wallCollide(i)}};c.dropObject=function(a,d){var i=b.makeObject(d);i.position=a.position.clone();i.position.y-=1;if(this.isSpecialLoot(d))i.position=new b.Vector2(304,226);this.addObject(i);if(this.isSpecialLoot(d)){var c=b.makeObject("pickup_arrow");c.position=i.position.clone();c.position.x=320-c.size.width/2;c.position.y-=c.size.height+10;this.addObject(c)}};c.isSpecialLoot=function(a){return a==="item_weapon_fire_sword"||a==="item_gold_chest"};c.spawnLoot=
function(a){if(!(a.position.y<44)){for(var d=a.lootTable,c=d.length,e=[],f=0;f<c;f++)for(var h=d[f],g=0;g<h.weight;g++)e.push(h.type);d=b.randomRange(0,e.length-1);e=e[d];if(e!==null){d=this.getPlayerObject();e==="item_food"&&d.wounds===0&&(e="item_chest");if(e==="WEAPON_DROP")switch(b.randomRange(1,4)){case 1:e="item_weapon_knife";break;case 2:e="item_weapon_spear";break;case 3:e="item_weapon_fireball";break;case 4:e="item_weapon_axe"}e.indexOf("item_weapon")>=0&&d.hasWeapon("h_fire_sword")&&(e=
"item_chest");this.dropObject(a,e)}}};b.Engine.prototype.updateObjects=function(a){var d=0,c=0,e;for(e in this.objects){var f=this.objects[e];if(f.isDead()){if(f.role==="hero"){this.endGame();return}f.execute("onDelete",[this]);delete this.objects[f.id]}else{if(f.role==="monster"||f.type==="pickup_arrow")d++,f.position.y<=64&&c++;switch(f.update(a,this)){case "shoot":this.objectAttack(f)}f.isMoving()&&!f.hasState(b.Object.states.STUNNED)&&this.moveObject(f,a);if(!(f.role==="fluff"||f.role==="powerup_food"||
f.hasState(b.Object.states.DYING)||f.hasState(b.Object.states.INVISIBLE))){for(var h in this.objects){var g=this.objects[h];if(!g.isDead()&&!(g.team===f.team||g.role==="fluff"||g.hasState(b.Object.states.DYING)||g.hasState(b.Object.states.INVISIBLE))&&f.boundingBox().reduce(5).intersects(g.boundingBox().reduce(5))){if(f.role=="hero")if(g.role=="powerup_food"){g.die();f.wounds-=g.healAmount;if(f.wounds<0)f.wounds=0;f.meatEaten++;b.sound.play("eat_food");for(var j=0;j<5;++j){var k=b.makeObject("mini_heart");
k.position.x=f.position.x+j*(f.size.width/5);k.position.y=f.position.y+f.size.height-b.randomRange(0,f.size.height);this.addObject(k)}}else if(g.role=="powerup_coin"){if(g.die(),f.gold+=g.coinAmount,b.sound.play("coins"),k=this.coinPickup,k.amount=g.coinAmount,k.y=0,k.alpha=1,k.position=g.position.clone(),k.state="on",this.isSpecialLoot(g.type))for(j in this.objects)this.objects[j].type==="pickup_arrow"&&this.objects[j].die()}else if(g.role=="powerup_weapon"&&(g.die(),f.addWeapon(g.wepType,g.wepCount),
b.sound.play("pickup_weapon"),k=this.weaponPickup,k.type=g.type,k.scale=1,k.alpha=0.9,k.position=g.position.clone(),k.state="on",this.isSpecialLoot(g.type)))for(j in this.objects)this.objects[j].type==="pickup_arrow"&&this.objects[j].die();f.team!==null&&g.team!==null&&f.team!==g.team&&(this.dealDamage(g,f),this.dealDamage(f,g))}}if(this.isBadassWeapon(f)){if(f.glow===void 0)f.glow={alpha:0,increment:0.2,timer:new b.Timer},f.glow.timer.start(50);f.glow.timer.update(a);if(f.glow.timer.expired()){f.glow.timer.reset();
f.glow.alpha+=f.glow.increment;if(f.glow.alpha>=0.8)f.glow.alpha=0.8,f.glow.increment=-0.2;if(f.glow.alpha<=0.2)f.glow.alpha=0.2,f.glow.increment=0.2}}}}}this.monstersAlive=d;this.monstersAboveGates=c>0;d=this.getPlayerObject();this.woundsTo<d.wounds?this.woundsTo+=this.woundsToSpeed/1E3*a:this.woundsTo>d.wounds?this.woundsTo-=this.woundsToSpeed/1E3*a:this.woundsTo=d.wounds;c=this.getTotalScore();e=b.clamp(Math.abs(this.scoreCount-c),1E3,1E4);a=Math.floor(e/1E3*a);if(this.scoreCount<c){if(this.scoreCount+=
a,this.scoreCount>c)this.scoreCount=c}else if(this.scoreCount>c&&(this.scoreCount-=a,this.scoreCount<c))this.scoreCount=c;if(Math.abs(d.wounds-this.woundsTo)<=1)this.woundsTo=d.wounds};b.Engine.prototype.dealDamage=function(a,d){if(a.role==="monster"&&d.role==="projectile")return!1;a.execute("onObjectCollide",[d,this]);if(a.role=="projectile"&&d.role=="trap"||a.role=="trap"&&d.role=="projectile")return!1;var c=d.execute("onThreat",[a,this]);if(d.hasState(b.Object.states.INVINCIBLE)||d.hitPoints===
Infinity||c===!0)return a.role==="projectile"&&a.hitPoints!==Infinity&&((d.damageType==="magic"||d.damageType==="physical")&&a.damageType==="physical"?(a.reverseDirection(),a.deflect(),b.sound.play("immunity")):a.die()),!1;if(a.hitPoints!==Infinity&&a.role==="projectile"&&d.role==="projectile"&&a.damageType==="physical"&&d.damageType==="physical")return a.piercing===!1&&(a.reverseDirection(),a.deflect()),d.piercing===!1&&(d.reverseDirection(),d.deflect()),!1;a.execute("onDamage",[d,this]);c=a;if(c.ownerId!==
null){var e=this.objects[c.ownerId];e&&(c=e)}a.role==="projectile"&&c.shotsLanded++;d.wound(a.damage)?(c.gold+=d.worth,c.kills++,d.execute("onKilled",[a,this]),d.lootTable.length>0&&this.spawnLoot(d),a.role==="projectile"&&a.piercing===!1&&a.hitPoints!==Infinity&&a.die()):(a.damage>0&&d.role==="hero"&&d.addState(b.Object.states.INVINCIBLE,2500),a.role==="projectile"&&a.hitPoints!==Infinity&&a.die())};c.updateTargetReticle=function(){this.targetReticle.moving=!1;var a=new b.Vector2(this.mouse.mouseX,
this.mouse.mouseY),d=new b.Rect(32,64,576,320),c=this.targetReticle.position;if(c.x!==a.x&&c.y!==a.y){this.targetReticle.moving=!0;var e=c.clone().subtract(a.clone()).abs();this.targetReticle.angle+=b.clamp((e.x+e.y)*2,1,100)/1E3*this.lastElapsed;if(this.targetReticle.angle>Math.PI*2)this.targetReticle.angle=0}c.x=a.x<d.left?d.left:a.x>d.left+d.width?d.left+d.width:a.x;c.y=a.y<d.top?d.top:a.y>d.top+d.height?d.top+d.height:a.y};c.handleInput=function(){var a=this.keyboard,d=b.Keyboard.Keys,c=b.Mouse.Buttons,
e=new b.Vector2(this.mouse.mouseX,this.mouse.mouseY),f,h=!1;if(this.state=="running"){if(this.keyboard.isKeyPressed(d.ESCAPE)&&this.showTutorial){this.tutorialIndex=4;this.nextTutorial(5);return}if(this.keyboard.isKeyPressed(d.P)||this.keyboard.isKeyPressed(d.ESCAPE)){this.togglePause();this.keyboard.clearKeys();return}this.paused&&(h=!0);this.canMute&&this.keyboard.isKeyPressed(77)&&b.sound.toggleMuted();this.canFullscreen&&this.keyboard.isKeyPressed(70)&&this.toggleFullscreen();if(this.keyboard.isKeyPressed(75))this.wasdMovesArrowsAttack=
!this.wasdMovesArrowsAttack;if(!b.isDemo()){if(this.keyboard.historyMatch(b.Keyboard.meatboyCode)){var g=this.getPlayerObject();g.isMeatboy=!0;g.initMeatBoy()}if(this.keyboard.historyMatch(b.Keyboard.godModeCode))this.keyboard.clearHistory(),g=this.getPlayerObject(),g.cheater=!0,g.hasState(b.Object.states.INVINCIBLE)?g.removeState(b.Object.states.INVINCIBLE):g.addState(b.Object.states.INVINCIBLE),b.sound.play("code_entered");if(this.keyboard.historyMatch(b.Keyboard.allWeaponsCode))this.keyboard.clearHistory(),
g=this.getPlayerObject(),g.cheater=!0,g.weapons=[{type:"h_fire_sword",count:null}],b.sound.play("code_entered");if(this.keyboard.historyMatch(b.Keyboard.awesmCode))this.keyboard.clearHistory(),g=this.getPlayerObject(),g.cheater=!0,g.weapons=[{type:"h_fire_knife",count:null}],b.sound.play("code_entered");if(this.keyboard.historyMatch(b.Keyboard.bombCode))this.keyboard.clearHistory(),g=this.getPlayerObject(),g.cheater=!0,g.weapons=[{type:"h_firebomb",count:null}],b.sound.play("code_entered");if(this.keyboard.historyMatch(b.Keyboard.debugCode))this.keyboard.clearHistory(),
this.debug=!this.debug,b.sound.play("code_entered");this.keyboard.historyMatch(b.Keyboard.resetCode)&&(this.keyboard.clearHistory(),this.clearData("checkpoint_wave"),this.clearData("checkpoint_hero"),this.putData("high_score",1E3),b.sound.play("code_entered"));if(this.keyboard.historyMatch(b.Keyboard.cyclopsCode)&&(g=this.getPlayerObject(),!g.cheater))b.sound.play("code_entered"),this.keyboard.clearHistory(),g.cheater=!0,g.hitPoints*=2,g.size=new b.Size(64,64),g.spriteY=224,g.weapons=[{type:"e_boulder",
count:null}],g.wounds*=2}if(this.paused&&(g=this.pointerYStart-22,this.verifyQuit?(e.x>=270&&e.x<=462&&e.y>g&&e.y<g+23&&(this.mouse.hasMoved&&this.pointerY!==0&&(f=0),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0)),e.x>=270&&e.x<=462&&e.y>g+24&&e.y<g+24+36&&(this.mouse.hasMoved&&this.pointerY!==1&&(f=1),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0))):(e.x>=270&&e.x<=376&&e.y>g&&e.y<g+23&&(this.mouse.hasMoved&&this.pointerY!==0&&(f=0),this.mouse.isButtonDown(c.LEFT)&&
(this.keyboard.keyStates[d.SPACE]=!0)),e.x>=270&&e.x<=376&&e.y>g+24&&e.y<g+24+36&&(this.mouse.hasMoved&&this.pointerY!==1&&(f=1),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0))),a.isKeyPressed(d.ENTER)||a.isKeyPressed(d.SPACE)))switch(a.clearKey(d.ENTER),a.clearKey(d.SPACE),this.mouse.clearButtons(),this.pointerY){case 0:this.togglePause();break;case 1:b.sound.play("select_pointer"),this.verifyQuit?(this.verifyQuit=!1,this.togglePause(),g=this.getPlayerObject(),g.wound(100)):
(this.pointerY=0,this.verifyQuit=!0)}}if(this.state==="title"){h=!0;if(!this.konamiEntered&&this.keyboard.historyMatch(b.Keyboard.konamiCode))b.sound.play("code_entered"),this.konamiEntered=!0,g=this.getPlayerObject(),g.cheater=!0,g.hitPoints*=3;g=this.pointerYStart-22;if((b.isDemo()||this.canContinue())&&e.x>=230&&e.x<=400&&e.y>=g&&e.y<g+20)this.mouse.hasMoved&&this.pointerY!==0&&(f=0),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0);g+=24;e.x>=230&&e.x<=400&&e.y>=g&&e.y<g+
20&&(this.mouse.hasMoved&&this.pointerY!==1&&(f=1),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0));g+=24;e.x>=230&&e.x<=400&&e.y>=g&&e.y<g+20&&(this.mouse.hasMoved&&this.pointerY!==2&&(f=2),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0));if(a.isKeyPressed(d.ENTER)||a.isKeyPressed(d.SPACE))switch(b.sound.play("select_pointer"),a.clearKey(d.ENTER),a.clearKey(d.SPACE),this.mouse.clearButtons(),this.pointerY){case 0:if(b.isDemo())location.href="https://chrome.google.com/extensions/detail/khodnfbkbanejphecblcofbghjdgfaih";
else if(g=this.getData("checkpoint_wave"),g!==null){this.currentWaveId=g-1;var j=this.getData("checkpoint_hero");if(j!==null)g=this.getPlayerObject(),g.load(j),g.totalDamageTaken+=g.wounds,g.wounds=0;this.continuing=!0;this.showTutorial=!1;this.state="intro_cinematic"}break;case 1:this.continuing=!1;this.showTutorial=!this.touchMove;this.state="intro_cinematic";break;case 2:this.state="credits"}}if(this.state=="buy_now"&&(h=!0,g=this.pointerYStart-22,e.x>=270&&e.x<=376&&e.y>g&&e.y<g+23&&(this.mouse.hasMoved&&
this.pointerY!==0&&(f=0),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0)),e.x>=270&&e.x<=376&&e.y>g+24&&e.y<g+24+36&&(this.mouse.hasMoved&&this.pointerY!==1&&(f=1),this.mouse.isButtonDown(c.LEFT)&&(this.keyboard.keyStates[d.SPACE]=!0)),a.isKeyPressed(d.ENTER)||a.isKeyPressed(d.SPACE)))switch(a.clearKey(d.ENTER),a.clearKey(d.SPACE),this.mouse.clearButtons(),b.sound.play("select_pointer"),this.pointerY){case 0:location.href="https://chrome.google.com/extensions/detail/khodnfbkbanejphecblcofbghjdgfaih";
break;case 1:b.sound.stop("victory"),this.initGame()}if(this.state==="credits"&&(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown()))a.clearKeys(),this.mouse.clearButtons(),this.state="title";if(this.state==="intro_cinematic"&&(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown()))a.clearKeys(),this.mouse.clearButtons(),this.state="running",g=this.getPlayerObject(),this.woundsTo=g.wounds,this.currentMusic="normal_battle_music",b.sound.play(this.currentMusic);if(h){if(this.keyboard.isKeyPressed(d.W)||
this.keyboard.isKeyPressed(d.UP)){this.keyboard.keyStates[d.W]=!1;this.keyboard.keyStates[d.UP]=!1;this.pointerY--;if(this.pointerY<this.pointerOptionsStart)this.pointerY=this.maxPointerY;b.sound.play("move_pointer")}if(this.keyboard.isKeyPressed(d.S)||this.keyboard.isKeyPressed(d.DOWN)){this.keyboard.keyStates[d.S]=!1;this.keyboard.keyStates[d.DOWN]=!1;this.pointerY++;if(this.pointerY>this.maxPointerY)this.pointerY=this.pointerOptionsStart;b.sound.play("move_pointer")}this.keyboard.storeKeyStates();
if(f!==void 0)b.sound.play("move_pointer"),this.pointerY=f}if(this.state==="running")if(g=this.getPlayerObject(),this.paused||g.hasState(b.Object.states.DYING))this.keyboard.storeKeyStates();else{if(this.touchMove){this.targetReticle.angle+=Math.PI*2/5E3*this.lastElapsed;if(this.targetReticle.angle>Math.PI*2)this.targetReticle.angle=0;if(this.mouse.wasButtonClicked(c.LEFT)||this.mouse.isButtonDown(c.LEFT))f=new b.Rect(48,80,544,288),h=this.targetReticle.position,h.x=e.x<f.left?f.left:e.x>f.left+f.width?
f.left+f.width:e.x,h.y=e.y<f.top?f.top:e.y>f.top+f.height?f.top+f.height:e.y}else this.updateTargetReticle();h=new b.Vector2;f=new b.Vector2;if(this.touchMove)a=this.getNearestHostile(g),a!==null&&(f=a.boundingBox().center().subtract(g.boundingBox().center()).normalize()),h=this.targetReticle.position.clone().subtract(g.boundingBox().center()).normalize(),this.targetReticle.position.clone().subtract(g.boundingBox().center()).magnitude()<3&&h.zero();else{d=this.wasdMovesArrowsAttack?{moveUp:d.W,moveLeft:d.A,
moveDown:d.S,moveRight:d.D,attackUp:d.UP,attackDown:d.DOWN,attackLeft:d.LEFT,attackRight:d.RIGHT}:{moveUp:d.UP,moveDown:d.DOWN,moveLeft:d.LEFT,moveRight:d.RIGHT,attackUp:d.W,attackLeft:d.A,attackDown:d.S,attackRight:d.D};if(a.isKeyDown(d.moveUp))h.y=-1,this.nextTutorial(1);if(a.isKeyDown(d.moveLeft))h.x=-1,this.nextTutorial(1);if(a.isKeyDown(d.moveDown))h.y=1,this.nextTutorial(1);if(a.isKeyDown(d.moveRight))h.x=1,this.nextTutorial(1);if(a.isKeyDown(d.attackUp))f.y=-1,this.nextTutorial(2);if(a.isKeyDown(d.attackDown))f.y=
1,this.nextTutorial(2);if(a.isKeyDown(d.attackLeft))f.x=-1,this.nextTutorial(2);if(a.isKeyDown(d.attackRight))f.x=1,this.nextTutorial(2)}g.stopMoving();(h.x!==0||h.y!==0)&&g.setDirection(h);if(this.mouse.wasButtonClicked(c.LEFT))this.showTutorial&&e.y<=70+this.tutorialY?(this.tutorialIndex=4,this.nextTutorial(5),this.mouse.clearButtons()):e.x>=604&&e.x<=636&&e.y>=442&&e.y<=475?this.canFullscreen?(this.toggleFullscreen(),this.mouse.clearButtons()):this.togglePause():this.canMute&&e.x>=570&&e.x<=602&&
e.y>=442&&e.y<=484&&(b.sound.toggleMuted(),this.mouse.clearButtons());this.mouse.isButtonDown(c.LEFT)&&!this.touchMove?(c=this.targetReticle.position.clone().subtract(g.boundingBox().center()).normalize(),this.objectAttack(g,c),this.heroFiring=!0,this.heroFiringDirection=c,this.nextTutorial(4),this.showReticle=!0):f.x!==0||f.y!==0?(this.objectAttack(g,f),this.heroFiring=!0,this.heroFiringDirection=f):(this.heroFiring=!1,this.heroFiringDirection=null);this.keyboard.storeKeyStates();this.mouse.storeButtonStates()}};
c.getNearestHostile=function(a){var d={obj:null,distance:Infinity},c;for(c in this.objects){var e=this.objects[c];if(e.team!=a.team&&(e.role=="monster"||e.role=="projectile")&&e.hitPoints!==Infinity&&this.isAlive(e.id)&&!e.hasState(b.Object.states.INVINCIBLE)&&!e.hasState(b.Object.states.INVISIBLE)){var f=a.boundingBox().center().subtract(e.boundingBox().center()).magnitude();if(f<d.distance)d.obj=e,d.distance=f}}return d.obj===null?null:d.obj};c.objectAttack=function(a,d){if(!d)d=a.facing;var c=
a.fireWeapon();if(c!==!1){var e=b.objectTypes[c];switch(c){case "e_minotaur_trident":for(var f=d.heading(),h=-0.5;h<=0.5;h+=0.5)this.spawnObject(a,c,b.Vector2.fromHeading(f+h));a.shotsFired+=3;break;case "h_knife":case "h_fire_knife":f=d.heading();this.spawnObject(a,c,b.Vector2.fromHeading(f-0.1));this.spawnObject(a,c,b.Vector2.fromHeading(f+0.1));a.shotsFired+=2;break;case "e_fireball_green":for(h=-0.25;h<=0.25;h+=0.25)f=d.heading(),f+=h+b.randomRange(-1,1)/10,this.spawnObject(a,c,b.Vector2.fromHeading(f));
a.shotsFired+=3;break;case "h_fireball":var f=d.heading(),g=b.Vector2.fromHeading(f),h=this.spawnObject(a,c,g.clone()),h=this.objects[h];h.position.add(b.Vector2.fromHeading(f-Math.PI/2).scale(16));h.position.add(g.clone().scale(16));h=this.spawnObject(a,c,g.clone());h=this.objects[h];h.position.add(g.clone().scale(32));h=this.spawnObject(a,c,g.clone());h=this.objects[h];h.position.add(b.Vector2.fromHeading(f+Math.PI/2).scale(16));h.position.add(g.clone().scale(16));a.shotsFired+=3;break;case "h_firebomb":for(var j=
this.targetReticle.position.clone(),g=Math.PI*2,k=g/20,f=0;f<g;f+=k)h=b.makeObject("h_fireball"),h.position.x=j.x-16,h.position.y=j.y-16,h.setDirection(b.Vector2.fromHeading(f)),h.ownerId=a.id,h.team=a.team,this.addObject(h),a.shotsFired+=1;break;case "e_ring_fire":g=Math.PI*2;k=g/10;for(f=h=k/2;f<g+h;f+=k)this.spawnObject(a,c,b.Vector2.fromHeading(f));break;case "e_ring_fire_dopp":g=Math.PI*2;k=g/10;for(f=0;f<g;f+=k)this.spawnObject(a,c,b.Vector2.fromHeading(f));break;case "e_bouncing_boulder":g=
Math.PI*2;k=g/8;for(f=0;f<g;f+=k)this.spawnObject(a,c,b.Vector2.fromHeading(f));break;default:this.spawnObject(a,c,d),a.shotsFired++}a.shotsPerWeapon[c]||(a.shotsPerWeapon[c]=0);a.shotsPerWeapon[c]++;c=null;if(e.soundAttacks)c=e.soundAttacks;else if(a.soundAttacks)c=a.soundAttacks;c!==null&&b.sound.play(c)}};c.render=function(){var a=this.canvases.display.getContext("2d");switch(this.state){case "intro":this.drawLogo(a);break;case "title":this.drawTitle(a);this.drawPointer(a);this.drawTitlePointerOptions(a);
break;case "credits":this.drawTitle(a);this.drawCredits(a);break;case "intro_cinematic":this.drawIntroCinematic(a);break;case "running":this.drawFloor(a);this.wonGame||this.drawTargetReticle(a);this.drawObjects(a);this.drawFauxGates(a);this.drawWalls(a);this.drawWeaponPickup(a);this.drawCoinPickup(a);this.drawWaveText(a);this.drawUI(a);this.paused&&(this.drawPaused(a),this.drawPointer(a),this.drawPausedPointerOptions(a));this.showTutorial&&this.drawTutorial(a);break;case "game_over":this.drawGameOver(a);
break;case "buy_now":this.drawBuyNow(a),this.drawPointer(a)}this.debug===!0&&this.drawDebugInfo(a)};c.drawWeaponPickup=function(a){var d=this.weaponPickup;if(d.state==="on"){var c=b.makeObject(d.type);a.save();a.translate(d.position.x+c.size.width/2,d.position.y+c.size.height/2);a.globalAlpha=d.alpha;a.drawImage(this.images.getImage("objects"),128,192,48,48,-22*d.scale,-20*d.scale,48*d.scale,48*d.scale);a.drawImage(this.images.getImage(c.spriteSheet),c.spriteX,c.spriteY+1,c.size.width-1,c.size.height-
1,-(c.size.width/2*d.scale),-(c.size.height/2*d.scale),c.size.width*d.scale,c.size.height*d.scale);a.restore()}};c.drawCoinPickup=function(a){var d=this.coinPickup;if(d.state==="on"){var b=this.getCoinFontData(d.amount),c="+"+d.amount;a.save();a.fillStyle=b.fillStyle;a.font="Bold "+b.size+"px MedievalSharp";a.lineWidth=2;a.strokeStyle="rgb(0, 0, 0)";a.textAlign="center";a.textBaseline="top";a.translate(d.position.x,d.position.y);a.globalAlpha=d.alpha;a.strokeText(c,0,0);a.fillText(c,0,0);a.restore()}};
c.getCoinFontData=function(a){return a==100?{fillStyle:"rgb(255, 203, 5)",size:24}:a==500?{fillStyle:"rgb(255, 244, 96)",size:36}:{fillStyle:"rgb(255, 248, 160)",size:50}};c.drawWaveText=function(a){if(this.waveText.state!="off"){var d=parseInt(this.waveText.size),b=this.waveText.width*d;d*=40;var c=320-b/2,f=240-d/2;a.save();a.globalAlpha=this.waveText.alpha;a.drawImage(this.canvases.waveText,0,0,this.waveText.width,40,c,f,b,d);a.restore()}};c.drawGameOver=function(a){if(this.goAlphaStep){this.goAlpha+=
this.goAlphaStep;if(this.goAlpha<=0)this.goAlpha=0,this.goAlphaStep=0.025;if(this.goAlpha>=1)this.goAlpha=1,this.goAlphaStep=-0.025}else this.goAlphaStep=-0.025,this.goAlpha=1;if(!this.gameOverBg)this.drawUI(a),this.gameOverBg=a.getImageData(0,0,this.view.width,this.view.height);a.putImageData(this.gameOverBg,0,0);a.save();a.globalAlpha=this.gameOverAlpha;a.fillStyle=this.wonGame?"rgb(0, 0, 0)":"rgb(215, 25, 32)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();if(this.gameOverReady===
!0){if(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown())if(this.keyboard.clearKeys(),this.mouse.clearButtons(),this.statsIndex+=1,this.statsIndex>=5){b.isDemo()?(this.state="buy_now",this.initOptions()):(b.sound.stop("victory"),this.initGame());return}a.drawImage(this.preloader.getImage("ui"),0,2322,564,404,38,38,564,404);this.wonGame?a.drawImage(this.preloader.getImage("ui"),564,2444,256,50,192,70,256,50):this.gotNewHighScore?a.drawImage(this.preloader.getImage("ui"),564,2374,404,50,
119,70,404,50):a.drawImage(this.preloader.getImage("ui"),564,2324,218,50,211,70,218,50);this.drawObjectStats(this.getPlayerObject(),a);this.statsIndex>=4&&a.drawImage(this.preloader.getImage("ui"),564,2424,334,20,153,404,334,20)}};c.drawBuyNow=function(a){a.save();a.globalAlpha=0.7;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),370,0,564,404,38,38,564,404);a.restore();var d=this.pointerYStart-22,b;b=this.pointerY==0?260:0;a.drawImage(this.preloader.getImage("ui"),
b,2122,200,40,270,d,200,40);b=this.pointerY==1?260:0;d+=24;a.drawImage(this.preloader.getImage("ui"),b,2182,200,40,270,d,200,40)};c.drawObjectStats=function(a,d){d.save();d.font="Bold 40px MedievalSharp";var b,c=0,f=0,h=this.currentWaveId;this.wonGame&&(h+=1);var g=0;this.statsIndex===0?(g=this.statsCount,c=h,b=199,f=10):g=h;d.fillStyle="rgb(199, 234, 251)";d.fillText(g+" x 1000",350,182);h=0;if(this.statsIndex===1)h=this.statsCount,c=a.gold,f=b=10;else if(this.statsIndex>1)h=a.gold;d.fillStyle="rgb(255, 245, 121)";
d.fillText(h,350,235);h=0;if(this.statsIndex===2)h=this.statsCount,c=a.totalDamageTaken,b=299,f=5;else if(this.statsIndex>2)h=a.totalDamageTaken;d.fillStyle="rgb(237, 28, 36)";d.fillText("-"+h+" x 100",350,290);h="";g=this.getTotalScore();this.statsIndex===3?(h=this.statsCount,c=g):this.statsIndex>3&&(h=g);d.fillStyle="rgb(250, 166, 26)";d.fillText(h,350,349);if(this.statsCount>=c)this.statsCount=0,this.statsIncrement=b,this.statsIndex+=1,this.statsTimer.start(f);d.restore()};c.getTotalScore=function(){var a=
this.getPlayerObject(),d=this.currentWaveId;this.wonGame&&(d+=1);d*=1E3;d+=a.gold;d-=a.totalDamageTaken*100;a.cheater===!0&&(d/=2);d<0&&(d=0);return d};c.drawLogo=function(a){a.save();a.fillStyle="rgb(0, 0, 0)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();if(this.logoAlpha>0)a.save(),a.globalAlpha=this.logoAlpha,a.drawImage(this.preloader.getImage("ui"),0,0,370,430,160,0,370,430),a.restore()};c.drawFloor=function(a){var d=this.getArenaOffset();a.drawImage(this.images.getImage("arena"),
d+32,480,576,386,32,0,576,386)};c.drawWalls=function(a){var d=this.getArenaOffset();a.drawImage(this.images.getImage("arena"),d,0,640,480,0,0,this.view.width,this.view.height)};c.getArenaOffset=function(){return 640*Math.floor((this.currentWaveId>=0?this.currentWaveId:0)/10)};c.drawPaused=function(a){a.save();a.globalAlpha=0.7;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),0,1718,564,404,38,38,564,404);var d=this.getPlayerObject();a.font=
"Bold 36px MedievalSharp";a.textAlign="left";a.fillStyle="rgb(237, 28, 36)";a.fillText(d.kills,390,164);a.fillStyle="rgb(145, 102, 0)";a.fillText(d.meatEaten,390,216);a.fillStyle="rgb(199, 234, 251)";a.fillText(d.shotsFired,390,270);a.fillStyle="rgb(250, 166, 26)";a.fillText(this.getAccuracy(d)+"%",390,324);a.restore()};c.getAccuracy=function(a){return a.shotsFired===0?0:Math.round(a.shotsLanded/a.shotsFired*100)};c.drawTutorial=function(a){if(!this.paused){a.save();a.globalAlpha=0.7;a.fillRect(0,
this.tutorialY,this.view.width,70);a.globalAlpha=1;a.font="Bold 22px MedievalSharp";a.textAlign="center";var d=["MOVE with the WASD keys.","ATTACK with the ARROW keys.","Or use the MOUSE to AIM with the target reticle.","ATTACK by HOLDING DOWN the LEFT MOUSE BUTTON.","KILL MONSTERS and COLLECT GOLD to raise your score!"];a.fillStyle="rgb(0, 0, 0)";a.fillText(d[this.tutorialIndex],322,this.tutorialY+36);a.fillStyle="rgb(230, 230, 230)";a.fillText(d[this.tutorialIndex],320,this.tutorialY+34);a.font=
"20px MedievalSharp";a.fillStyle="rgb(0, 0, 0)";a.fillText("Press here or ESC to skip",322,this.tutorialY+62);a.fillStyle="rgb(118, 151, 183)";a.fillText("Press here or ESC to skip",320,this.tutorialY+60);a.restore()}};c.getObjectDrawOrder=function(){var a=[],d;for(d in this.objects){var b=this.objects[d];a.push({id:b.id,drawIndex:b.drawIndex,y:b.position.y+b.size.height})}a.sort(function(a,d){return a.drawIndex===d.drawIndex?a.y-d.y:a.drawIndex-d.drawIndex});return a};c.drawObject=function(a,d){var c=
d.role==="hero"&&this.heroFiring?d.getSpriteXY(this.heroFiringDirection):d.getSpriteXY();if(!(d.alpha<=0||d.hasState(b.Object.states.INVISIBLE))){a.save();a.translate(d.position.x+d.size.width/2,d.position.y+d.size.height/2);d.angle!==0&&a.rotate(d.angle*Math.PI/180);if(d.alpha!==1)a.globalAlpha=d.alpha;d.role==="powerup_weapon"&&a.drawImage(this.images.getImage("objects"),128,192,48,48,-22,-20,48,48);a.drawImage(this.images.getImage(d.spriteSheet),c.x,c.y+1,d.size.width-1,d.size.height-1,-(d.size.width/
2),-(d.size.height/2),d.size.width,d.size.height);if(d.spriteYOverlay)a.save(),a.globalAlpha=1-d.wounds/d.hitPoints+0.3,a.drawImage(this.images.getImage(d.spriteSheet),c.x,d.spriteYOverlay+1,d.size.width-1,d.size.height-1,-(d.size.width/2),-(d.size.height/2),d.size.width,d.size.height),a.restore();d.role==="monster"&&d.badass&&d.hasState(b.Object.states.HURTING)&&this.drawImageOverlay(a,this.images.getImage(d.spriteSheet),c.x,c.y+1,d.size.width-1,d.size.height-1,-(d.size.width/2),-(d.size.height/
2),d.size.width,d.size.height,"rgba(186, 51, 35, 0.6)");this.isBadassWeapon(d)&&d.glow&&this.drawImageOverlay(a,this.images.getImage(d.spriteSheet),c.x,c.y+1,d.size.width-1,d.size.height-1,-(d.size.width/2),-(d.size.height/2),d.size.width,d.size.height,"rgba(255, 247, 143, "+d.glow.alpha+")");if(this.debug&&d.role==="monster"||d.badass&&!d.hasState(b.Object.states.DYING))c=d.size.width-2,c-=Math.round(c*d.wounds/d.hitPoints),a.fillStyle="rgb(241, 241, 242)",a.fillRect(-(d.size.width/2),d.size.height/
2,d.size.width,8),a.fillStyle="rgb(0, 0, 0)",a.fillRect(-(d.size.width/2)+1,d.size.height/2+1,d.size.width-2,6),a.fillStyle=this.getBarColor(d.hitPoints,d.hitPoints-d.wounds),a.fillRect(-(d.size.width/2)+1,d.size.height/2+1,c,6);a.restore()}};c.isBadassWeapon=function(a){return a.role==="projectile"&&a.hitPoints===Infinity&&a.team===1&&a.type!="e_fireball"&&a.type!="e_static_blue_fire"&&a.type!="e_static_green_fire"};b.Engine.prototype.drawObjects=function(a){var d=this.getObjectDrawOrder(),b;for(b in d)this.drawObject(a,
this.objects[d[b].id])};c.drawTargetReticle=function(a){if(this.showReticle)a.save(),a.globalAlpha=0.75,a.translate(this.targetReticle.position.x,this.targetReticle.position.y),a.rotate(this.targetReticle.angle),a.drawImage(this.images.getImage("objects"),256,192,64,64,-32,-32,64,64),a.restore()};c.drawImageOverlay=function(a,d,b,c,f,h,g,j,k,m,n){var l=this.canvases.buffer.getContext("2d");l.save();l.clearRect(0,0,640,480);l.drawImage(d,b,c,f,h,0,0,k,m);l.globalCompositeOperation="source-in";l.fillStyle=
n;l.fillRect(0,0,k,m);l.restore();a.drawImage(this.canvases.buffer,0,0,k,m,g,j,k,m)};c.drawUI=function(a){var d=this.getPlayerObject(),c=d.getWeaponInfo(),e=b.objectTypes[c.type],c=c.count?c.count:"";a.drawImage(this.images.getImage("objects"),e.spriteX,e.spriteY,32,32,4,412,32,32);a.drawImage(this.images.getImage("objects"),32,32,32,32,4,442,32,32);a.save();a.textAlign="left";a.font="Bold 32px MedievalSharp";a.globalAlpha=0.75;a.fillStyle="rgb(0, 0, 0)";a.fillText(c,48,444);a.fillText(this.scoreCount,
48,474);a.globalAlpha=1;a.fillStyle="rgb(241, 241, 242)";a.fillText(c,46,440);a.fillText(this.scoreCount,46,472);a.restore();if(d.hitPoints>1){var e={width:280,height:24,x:212,y:432},f=e.width-Math.round(e.width*d.wounds/d.hitPoints),h=e.width-Math.round(e.width*this.woundsTo/d.hitPoints);this.woundsTo<d.wounds?(c=f,f=h):c=h;a.save();a.fillStyle="rgb(241, 241, 242)";a.fillRect(e.x-2,e.y-2,e.width+2,e.height+4);a.fillRect(e.x+e.width,e.y,2,e.height);a.fillStyle="rgb(0, 0, 0)";a.fillRect(e.x,e.y,e.width,
e.height);a.fillStyle=this.getBarColor(d.hitPoints,d.hitPoints-d.wounds);a.globalAlpha=0.4;a.fillRect(e.x,e.y,f,e.height);a.fillRect(e.x,e.y,c,e.height);a.fillRect(e.x,e.y+5,c,e.height-10);a.fillRect(e.x,e.y+10,c,e.height-20);a.restore();d=(d.hitPoints-d.wounds)/d.hitPoints*100;c=352;d>50?c=224:d>25&&(c=288);a.drawImage(this.images.getImage("objects"),c,64,42,42,e.x-32,424,42,42)}this.canMute&&a.drawImage(this.preloader.getImage("ui"),b.sound.isMuted()?692:660,910,32,32,570,442,32,32);this.canFullscreen?
(c=this.enableFullscreen?596:564,a.drawImage(this.preloader.getImage("ui"),c,910,32,32,604,442,32,32)):a.drawImage(this.preloader.getImage("ui"),628,910,32,32,604,442,32,32)};c.drawTitle=function(a){a.drawImage(this.preloader.getImage("ui"),0,430,640,480,0,0,640,480);var d="High Score: "+this.getData("high_score");a.save();a.font="Bold 36px MedievalSharp";a.textAlign="center";a.fillStyle="rgb(0, 0, 0)";a.fillText(d,322,456);a.fillStyle="rgb(230, 230, 230)";a.fillText(d,320,454);a.restore();d="v1.2.27";
b.isDemo()&&(d+=" demo");a.save();a.font="Bold 14px Monospace";a.textAlign="right";a.fillStyle="rgb(0, 0, 0)";a.fillText(d,638,478);a.fillStyle="rgb(230, 230, 230)";a.fillText(d,636,476);a.restore();a.save();a.font="Bold 14px Monospace";a.fillStyle="rgb(0, 0, 0)";a.fillText("Lost Decade Games \u00a9 2010",6,478);a.fillStyle="rgb(230, 230, 230)";a.fillText("Lost Decade Games \u00a9 2010",4,476);a.restore()};c.drawPointer=function(a){var b=this.pointerYStart+this.pointerY*24-24;a.save();a.drawImage(this.images.getImage("objects"),
320,192,36,26,228,b,36,26);a.restore()};c.canContinue=function(){var a=this.getData("checkpoint_wave");return Boolean(a)};c.drawTitlePointerOptions=function(a){var d=this.pointerYStart-22,c;b.isDemo()?(c=this.pointerY==0?638:430,a.drawImage(this.preloader.getImage("ui"),800,c,128,26,270,d,128,26)):(c=this.canContinue()?this.pointerY==0?638:430:534,a.drawImage(this.preloader.getImage("ui"),640,c,116,20,270,d,116,20));c=this.pointerY==1?664:456;a.drawImage(this.preloader.getImage("ui"),640,c,132,26,
270,d+24,132,26);c=this.pointerY==2?690:482;a.drawImage(this.preloader.getImage("ui"),640,c,90,22,270,d+48,90,22)};c.drawPausedPointerOptions=function(a){var b=this.pointerYStart-22,c;this.verifyQuit?(c=this.pointerY==0?1932:1860,a.drawImage(this.preloader.getImage("ui"),564,c,158,26,270,b,158,26)):(c=this.pointerY==0?1788:1718,a.drawImage(this.preloader.getImage("ui"),564,c,106,26,270,b,106,26));this.verifyQuit?(c=this.pointerY==1?1966:1894,a.drawImage(this.preloader.getImage("ui"),564,c,192,32,
270,b+24,196,32)):(c=this.pointerY==1?1822:1752,a.drawImage(this.preloader.getImage("ui"),564,c,70,36,270,b+24,70,36))};c.initOptions=function(){switch(this.state){case "title":this.pointerYStart=314;this.pointerOptionsStart=b.isDemo()||this.canContinue()?this.pointerY=0:this.pointerY=1;this.maxPointerY=2;break;case "running":this.pointerYStart=378;this.pointerY=0;this.maxPointerY=1;this.pointerOptionsStart=0;this.verifyQuit=!1;break;case "buy_now":this.pointerYStart=378,this.pointerY=0,this.maxPointerY=
1,this.pointerOptionsStart=0}};c.drawCredits=function(a){a.save();a.globalAlpha=0.7;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),0,1314,564,404,38,38,564,404);a.restore()};c.drawIntroCinematic=function(a){switch(this.introPhase){case 0:if(!this.introFadeOutBg)this.introFadeOutBg=a.getImageData(0,0,this.view.width,this.view.height),this.introFadeAlpha=0;a.fillStyle="rgb(0, 0, 0)";a.fillRect(0,0,640,480);a.save();a.putImageData(this.introFadeOutBg,
0,0);a.restore();if(this.introFadeAlpha>0)a.save(),a.globalAlpha=this.introFadeAlpha,a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,640,480),a.restore();break;case 1:this.drawFloor(a);this.drawFauxGates(a);this.drawWalls(a);if(this.introFadeAlpha>0)a.save(),a.globalAlpha=this.introFadeAlpha,a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,640,480),a.restore();break;case 2:case 3:this.drawFloor(a);this.drawFauxGates(a);this.drawWalls(a);break;case 4:case 5:case 9:this.drawFloor(a);this.introHero&&this.drawObject(a,
this.introHero);this.drawFauxGates(a);this.drawWalls(a);break;case 6:case 7:case 8:this.drawFloor(a),a.drawImage(this.images.getImage("characters"),640,0,32,32,304,224,32,32),this.drawFauxGates(a),this.drawWalls(a)}};c.drawFauxGates=function(a){for(var b=0;b<3;b++){var c=0,e=192;b>0&&(c=320,e=b==1?288:352);a.drawImage(this.images.getImage("objects"),c,e,64,64,this.gatesX+96+b*192,this.gatesY,64,64)}};c.drawDebugInfo=function(a){a.save();a.fillStyle="rgba(0, 0, 0, 0.3)";a.fillRect(0,0,this.view.width,
30);a.restore();a.save();a.fillStyle="rgb(241, 241, 242)";a.font="Bold 20px Monospace";a.fillText("Elapsed: "+this.lastElapsed,10,20);a.textAlign="right";a.fillText(Math.round(1E3/this.lastElapsed)+" FPS",630,20);a.restore()};c.getData=function(a){if(window.localStorage&&window.localStorage.getItem)return window.localStorage.getItem(a)};c.putData=function(a,b){window.localStorage&&window.localStorage.setItem&&window.localStorage.setItem(a,b)};c.clearData=function(a){window.localStorage&&window.localStorage.removeItem&&
window.localStorage.removeItem(a)};c.endGame=function(){this.gameOverReady=!1;this.gameOverAlpha=0;this.updateGameOver();this.state="game_over";this.timePlayed=b.now()-this.gameStartTime};c.toggleFullscreen=function(){b.sound.play("select_pointer");this.enableFullscreen=!this.enableFullscreen;this.putData("fullscreen",this.enableFullscreen?1:0);this.resize()}})();(function(){b.Object=function(){this.id="";this.ownerId=null;this.position=new b.Vector2;this.size=new b.Size(32,32);this.direction=new b.Vector2;
this.facing=new b.Vector2(0,1);this.speed=100;this.team=null;this.damage=this.hitPoints=1;this.spriteSheet="";this.spriteY=this.spriteX=0;this.animated=this.spriteAlign=!1;this.animFrameIndex=0;this.animNumFrames=2;this.animDelay=200;this.spawnFrameIndex=this.animElapsed=0;this.spawnFrameCount=2;this.angle=this.spawnFramesY=this.spawnFramesX=0;this.rotateSpeed=400;this.rotate=!1;this.ttlElapsed=this.ttl=this.worth=0;this.alphaMod=this.alpha=1;this.gibletSize="small";this.cooldown=!1;this.cooldownElapsed=
0;this.autoFire=!1;this.soundDies=this.soundDamage=this.soundAttacks=null;this.alive=!0;this.states=[];this.addState(b.Object.states.IDLE);this.currentWeaponIndex=0;this.bounce=this.collidable=!0;this.piercing=!1;this.soundDies=this.soundDamage=null;this.damageType="physical";this.drawIndex=1;this.moveChangeElapsed=0;this.moveChangeDelay=500;this.wounds=0;this.weapons=[];this.shotsLanded=this.shotsFired=this.totalDamageTaken=this.timesWounded=this.kills=this.gold=0;this.shotsPerWeapon={};this.meatEaten=
0;this.cheater=!1;this.phase=0;this.phaseInit=!1;this.lootTable=[];this.killSwitch=!1};b.Object.states={IDLE:0,MOVING:1,ATTACKING:2,HURTING:3,DYING:4,INVINCIBLE:5,INVISIBLE:6,SPAWNING:7,DESPAWNING:8,STUNNED:9,VICTORIOUS:10};var c=b.Object.prototype;c.load=function(a){a=JSON.parse(a);this.wounds=a.wounds;this.weapons=a.weapons;this.currentWeaponIndex=a.currentWeaponIndex;this.gold=a.gold;this.kills=a.kills;this.timesWounded=a.timesWounded;this.totalDamageTaken=a.totalDamageTaken;this.shotsFired=a.shotsFired;
this.shotsLanded=a.shotsLanded;this.shotsPerWeapon=a.shotsPerWeapon;this.meatEaten=a.meatEaten;this.cheater=a.cheater};c.setPhase=function(a){this.phase=a;this.phaseInit=!1};c.nextPhase=function(){this.setPhase(this.phase+1)};c.updateStates=function(a){for(var b in this.states){var c=this.states[b];c.timer.update(a);c.timer.expired()&&this.removeStateById(b)}};c.hasState=function(a){for(var b in this.states)if(this.states[b].type===a)return!0;return!1};c.addState=function(a,d){if(this.hasState(a))return!1;
var c=new b.Timer;c.start(d);this.states.push({type:a,timer:c});switch(a){case b.Object.states.SLOWED:this.oldAnimDelay=this.animDelay,this.animDelay*=2}};c.removeStateById=function(a){switch(this.states[a].type){case b.Object.states.INVINCIBLE:this.alpha=1;this.alphaMod=-1;break;case b.Object.states.SLOWED:this.animDelay=this.oldAnimDelay}delete this.states[a]};c.removeState=function(a){for(var b in this.states)this.states[b].type===a&&this.removeStateById(b)};c.init=function(){this.execute("onInit");
if(this.rotate)this.angle=b.randomRange(0,359);if(this.animated)this.animElapsed=b.randomRange(0,this.animDelay)};c.die=function(){this.alive=!1};c.isDead=function(){return!this.alive};c.update=function(a,d){if(this.killSwitch===!1&&this.ownerId!==null&&!d.isAlive(this.ownerId)){switch(this.role){case "projectile":case "trap":this.ttl=1E3;this.ttlElapsed=0;break;case "monster":this.wound(this.hitPoints)}this.killSwitch=!0}this.updateStates(a);this.deathTimer&&this.deathTimer.update(a);if(this.hasState(b.Object.states.DYING)&&
this.deathTimer.expired()&&(this.deathFrameIndex++,this.deathTimer.reset(),this.deathFrameIndex>2))this.deathFrameIndex=2,this.ttl=750;if(this.hasState(b.Object.states.INVINCIBLE)){this.alpha+=0.01*a*this.alphaMod;if(this.alpha>=1)this.alpha=1,this.alphaMod=-1;if(this.alpha<=0)this.alpha=0,this.alphaMod=1}if(!this.hasState(b.Object.states.STUNNED)){if(this.animated&&(this.animElapsed+=a,this.animElapsed>=this.animDelay)){this.animElapsed=0;this.animFrameIndex++;if(this.animFrameIndex>this.animNumFrames-
1)this.animFrameIndex=0;this.hasState(b.Object.states.SPAWNING)&&(this.spawnFrameIndex++,this.spawnFrameIndex>this.spawnFrameCount&&this.removeState(b.Object.states.SPAWNING));this.hasState(b.Object.states.DESPAWNING)&&(this.spawnFrameIndex--,this.spawnFrameIndex<0&&this.removeState(b.Object.states.DESPAWNING))}if(this.spriteAlign)this.angle=this.facing.angle();this.rotate&&(this.angle+=this.rotateSpeed/1E3*a);this.ttl>0&&(this.ttlElapsed+=a,this.ttl-this.ttlElapsed<=1E3&&(this.alpha-=0.0010*a),this.ttlElapsed>=
this.ttl&&this.die());if(this.cooldown===!0){this.cooldownElapsed+=a;var c=this.getWeaponInfo();if(this.cooldownElapsed>=b.objectTypes[c.type].cooldown)this.cooldown=!1,this.cooldownElapsed=0}this.phaseTimer&&this.phaseTimer.update(a);return this.hasState(b.Object.states.DYING)?void 0:this.execute("onUpdate",arguments)}};c.getSpriteXY=function(a){if(this.animated)switch(this.role){case "hero":case "monster":if(this.hasState(b.Object.states.DYING))return new b.Vector2((17+this.deathFrameIndex)*this.size.width,
this.spriteY);if(this.hasState(b.Object.states.SPAWNING)||this.hasState(b.Object.states.DESPAWNING))return new b.Vector2(this.spawnFramesX+this.spawnFrameIndex*this.size.width,this.spawnFramesY);if(this.hasState(b.Object.states.HURTING)&&this.size.width<=32)return new b.Vector2(16*this.size.width,this.spriteY);if(this.hasState(b.Object.states.VICTORIOUS))return new b.Vector2(20*this.size.width,this.spriteY);a=a?a:this.facing.clone();a=b.directions.fromVector(a);return new b.Vector2((a*2+this.animFrameIndex)*
this.size.width,this.spriteY);default:return this.hasState(b.Object.states.SPAWNING)||this.hasState(b.Object.states.DESPAWNING)?new b.Vector2(this.spawnFramesX+this.spawnFrameIndex*this.size.width,this.spawnFramesY):new b.Vector2(this.spriteX+this.animFrameIndex*this.size.width,this.spriteY)}else return new b.Vector2(this.spriteX,this.spriteY)};c.boundingBox=function(){var a=new b.Rect(this.position.x,this.position.y,this.size.width-1,this.size.height-1);this.role==="projectile"&&a.reduce(1);this.type===
"e_spit_pool"&&(a.y+=this.size.height/4,a.x+=5,a.height-=this.size.height/2,a.width-=10);this.type==="gas_cloud"&&(a.y+=32,a.x+=32,a.height-=32,a.width-=32);return a};c.centerOn=function(a){this.position=a.subtract(b.Vector2.fromSize(this.size).scale(0.5))};c.wound=function(a){if(a<1||this.hasState(b.Object.states.DYING)||this.isDead())return!1;this.removeState(b.Object.states.STUNNED);this.wounds+=a;this.totalDamageTaken+=a;this.timesWounded++;(this.role==="monster"||this.role==="hero")&&this.addState(b.Object.states.HURTING,
300);if(this.wounds>=this.hitPoints)return this.wounds=this.hitPoints,this.role==="monster"||this.role==="hero"?(this.addState(b.Object.states.DYING),this.deathFrameIndex=0,this.deathTimer=new b.Timer,this.deathTimer.start(200)):this.die(),this.role==="hero"&&b.sound.stopAll(),this.soundDies&&b.sound.play(this.soundDies),!0;this.soundDamage&&b.sound.play(this.soundDamage);return!1};c.wallCollide=function(a){if(this.role!=="hero"){if(this.bounce){var d=this.direction.clone(),c;for(c in a)d[a[c]]*=
-1;this.setDirection(d);this.role==="projectile"&&b.sound.play("weapon_wall")}else this.damageType==="physical"?this.deflect():this.die();this.execute("onWallCollide",[a])}};c.deflect=function(){this.role="fluff";this.rotateSpeed=this.speed*5;this.speed*=0.5;this.spriteAlign=!1;this.rotate=!0;this.ttl=100;this.alpha=0.5;this.bounce=!0};c.setDirection=function(a){a.x===0&&a.y===0?this.stopMoving():(this.direction=a,this.facing=this.direction.clone())};c.reverseDirection=function(){var a=this.direction.clone();
a.scale(-1);this.setDirection(a)};c.chase=function(a){this.moveToward(a.position.clone())};c.moveToward=function(a){this.setDirection(a.clone().subtract(this.position).normalize())};c.isMoving=function(){return this.hasState(b.Object.states.DYING)?!1:this.direction.x!==0||this.direction.y!==0};c.stopMoving=function(){this.direction.zero()};c.execute=function(a,b){if(this[a])return this[a].apply(this,b)};c.getWeaponInfo=function(){var a=this.weapons.length;if(a>=1){if(this.currentWeaponIndex<0)this.currentWeaponIndex=
0;if(this.currentWeaponIndex>a-1)this.currentWeaponIndex=a-1;return this.weapons[this.currentWeaponIndex]}return!1};c.addWeapon=function(a,b){var c=[],e;for(e in this.weapons){var f=this.weapons[e];typeof f!=="undefined"&&f.type===a&&(f.count!==null?b+=f.count:b=null);f.count!==null&&c.push(e)}for(var h in c)this.weapons=this.weapons.splice(h,1);this.currentWeaponIndex=this.weapons.push({type:a,count:b})-1};c.cycleWeapon=function(a){var b=this.weapons.length;if(a===!0){if(this.currentWeaponIndex--,
this.currentWeaponIndex<0)this.currentWeaponIndex=b-1}else if(this.currentWeaponIndex++,this.currentWeaponIndex>b-1)this.currentWeaponIndex=0};c.fireWeapon=function(){var a=this.weapons.length;if(this.cooldown===!0||a<1)return!1;a=this.getWeaponInfo();a.count!==null&&(a.count-=1,a.count<1&&this.weapons.splice(this.currentWeaponIndex,1));this.cooldown=!0;return a.type};c.hasWeapon=function(a){for(var b=this.weapons.length,c=0;c<b;++c)if(this.weapons[c].type===a)return!0;return!1}})();(function(){b.objectTypes=
{};var c=b.objectTypes;c.hero={role:"hero",team:0,speed:150,hitPoints:100,damage:0,damageType:null,spriteSheet:"characters",spriteY:992,animated:!0,soundAttacks:"hero_attacks",soundDamage:"hero_damage",soundDies:"hero_dies",weapons:[{type:"h_sword",count:null}],isMeatboy:!1,bloodTimer:null,onInit:function(){this.isMeatboy&&this.initMeatBoy()},initMeatBoy:function(){this.hitPoints=1;this.spriteY=1024;this.bloodTimer=new b.Timer;this.bloodTimer.start(100)},onUpdate:function(a,c){if(this.isMeatboy&&
(this.bloodTimer.update(a),this.bloodTimer.expired()&&this.isMoving())){var e=c.spawnObject(this,"blood_pool"),e=c.objects[e];e.position.x+=b.randomRange(-8,8);e.position.y+=b.randomRange(-8,8);e.angle=b.randomRange(0,Math.PI*1.5);this.bloodTimer.start(b.randomRange(75,150))}},onKilled:function(a,c){for(var e=0;e<10;++e){var f=b.makeObject("mini_skull");f.position.x=this.position.x+e*(this.size.width/10);f.position.y=this.position.y+this.size.height-b.randomRange(0,this.size.height);c.addObject(f)}}};
c.blood_pool={role:"fluff",size:new b.Size(32,32),speed:0,ttl:1250,collidable:!1,spriteSheet:"objects",spriteX:128,spriteY:32,drawIndex:0};c.h_sword={role:"projectile",cooldown:300,speed:250,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:64,spriteY:0,spriteAlign:!0,priority:0,bounce:!1};c.h_knife={role:"projectile",size:new b.Size(32,30),cooldown:200,speed:350,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:32,spriteY:0,spriteAlign:!0,priority:1,bounce:!1};c.h_spear={role:"projectile",cooldown:350,
speed:500,hitPoints:1,damage:15,spriteSheet:"objects",spriteX:96,spriteY:0,spriteAlign:!0,priority:2,bounce:!1,piercing:!0};c.h_fireball={role:"projectile",cooldown:300,speed:400,rotateSpeed:500,hitPoints:1,damage:3,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,ttl:450,soundAttacks:"fire_attack",priority:3,bounce:!1,damageType:"magic",onInit:function(){this.trailTimer=new b.Timer;this.trailTimer.start(75)},onUpdate:function(a,b){this.trailTimer.update(a);this.trailTimer.expired()&&(b.spawnObject(this,
"h_fireball_trail"),this.trailTimer.reset())}};c.h_fireball_trail={role:"projectile",speed:0,rotateSpeed:150,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,ttl:500,alpha:0.5,priority:3,bounce:!1,damageType:"magic",drawIndex:0};c.h_axe={role:"projectile",cooldown:500,speed:225,hitPoints:1,damage:20,spriteSheet:"objects",spriteX:192,spriteY:32,rotate:!0,rotateSpeed:700,priority:5,ttl:4E3,piercing:!0};c.h_fire_sword={role:"projectile",cooldown:450,speed:350,hitPoints:1,damage:25,
spriteSheet:"objects",spriteX:384,spriteY:0,priority:6,bounce:!1,spriteAlign:!0,piercing:!0,soundAttacks:"fire_attack",damageType:"magic",onInit:function(){this.spawnTimer=new b.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"fire_sword_trail"),this.spawnTimer.reset())}};c.fire_sword_trail={role:"projectile",speed:0,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,soundAttacks:"fire_attack",
ttl:500,bounce:!1,drawIndex:0,damageType:"magic"};c.h_fire_knife={role:"projectile",size:new b.Size(32,30),cooldown:200,speed:350,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:128,spriteY:0,priority:6,bounce:!1,spriteAlign:!0,piercing:!0,soundAttacks:"fire_attack",damageType:"magic",onInit:function(){this.spawnTimer=new b.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"fire_sword_trail"),this.spawnTimer.reset())}};
c.h_firebomb={role:"projectile",cooldown:500,speed:150,rotateSpeed:300,hitPoints:1,damage:2,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,ttl:550,soundAttacks:"fire_attack",priority:3,bounce:!1,damageType:"magic"};var a={chase:function(a,b){if(this.moveChangeDelay>0){this.moveChangeElapsed+=a;if(this.moveChangeElapsed<this.moveChangeDelay)return;this.moveChangeElapsed=0}this.chase(b.getPlayerObject());return"shoot"},getNear:function(b,c){this.speed=this.defaultSpeed;var e=c.getPlayerObject(),
f=e.position.clone().subtract(this.position).magnitude();if(f<100)this.chase(e),this.setDirection(this.direction.invert());else if(f>150)this.chase(e);else if(this.cooldown)a.wander.apply(this,arguments);else return this.chase(e),this.speed=0,"shoot"},wander:function(a){this.moveChangeElapsed+=a;if(this.moveChangeElapsed>=this.moveChangeDelay)this.moveChangeElapsed=0,a=b.randomDirection(),a.x===0&&a.y===0||this.setDirection(a)},wanderShoot:function(b,c){var e=c.getPlayerObject(),f=e.position.clone().subtract(this.position).abs();
if(!this.cooldown&&(f.x<e.size.width/2||f.y<e.size.height/2))return this.chase(e),"shoot";else a.wander.apply(this,arguments)},wanderThenChase:function(d,c){var e=c.getPlayerObject(),e={x:e.position.x,y:e.position.y},f=this.position.x,h=this.position.y;if(this.seenHero)a.chase.apply(this,arguments);else if(a.wander.apply(this,arguments),h=Math.abs(h-e.y),Math.abs(f-e.x)<64&&h<64)return b.sound.play(this.soundAttacks),this.seenHero=!0,"shoot"}};c.bat={role:"monster",team:1,speed:100,hitPoints:5,damage:2,
worth:0,spriteSheet:"characters",spriteY:96,animated:!0,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",lootTable:[{type:null,weight:9},{type:"item_coin",weight:1}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wander}};c.dire_bat={role:"monster",team:1,speed:150,hitPoints:10,damage:5,worth:0,spriteSheet:"characters",spriteY:128,animated:!0,animDelay:150,moveChangeElapsed:0,
moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",lootTable:[{type:null,weight:7},{type:"item_coin",weight:3}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wander}};c.goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:0,spriteSheet:"characters",spriteY:160,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",count:null}],soundAttacks:"goblin_attacks",
soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:6},{type:"item_coin",weight:1},{type:"WEAPON_DROP",weight:2},{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=a.wanderShoot}};c.hunter_goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:0,spriteSheet:"characters",spriteY:160,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",
count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:2},{type:"item_coin",weight:4},{type:"WEAPON_DROP",weight:2},{type:"item_food",weight:2}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3)},onUpdate:function(b,c){if(this.position.y>=50){if(!this.cooldown)return this.chase(c.getPlayerObject()),"shoot";a.wander.apply(this,arguments)}}};c.demoblin={role:"monster",team:1,speed:75,defaultSpeed:75,hitPoints:30,damage:15,
worth:0,spriteSheet:"characters",spriteY:192,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_trident",count:null}],lootTable:[{type:null,weight:6},{type:"WEAPON_DROP",weight:2},{type:"item_chest",weight:1},{type:"item_food",weight:1}],soundAttacks:"demoblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3);this.cooldown=!0;this.cooldownElapsed=b.randomRange(0,5E3)},onUpdate:function(){if(this.position.y>=
50)this.onUpdate=a.getNear}};c.flaming_skull={role:"monster",team:1,speed:200,hitPoints:50,damage:10,worth:0,spriteSheet:"characters",spriteY:32,animated:!0,setDir:!1,soundDamage:"skull_damage",soundDies:"skull_dies",weapons:[{type:"e_static_blue_fire",count:null}],lootTable:[{type:null,weight:6},{type:"WEAPON_DROP",weight:2},{type:"item_chest",weight:2}],onInit:function(){switch(b.randomRange(1,2)){case 1:this.speed*=0.5;this.animDelay*=0.5;break;case 2:this.speed*=0.75,this.animDelay*=0.75}},onUpdate:function(){if(!this.setDir&&
this.position.y>=50){var a=this.direction.clone();a.x=Math.random();Math.random()>=0.5&&(a.x*=-1);this.setDirection(a);this.setDir=!0}return"shoot"}};c.huge_skull={role:"monster",team:1,badass:!0,speed:150,hitPoints:200,damage:20,worth:0,spriteSheet:"characters",spriteY:864,animated:!0,size:new b.Size(64,64),setDir:!1,soundDamage:"skull_damage",soundDies:"skull_dies",weapons:[{type:"e_static_green_fire",count:null}],lootTable:[{type:null,weight:4},{type:"WEAPON_DROP",weight:3},{type:"item_chest",
weight:3}],onInit:function(){this.phaseTimer=new b.Timer;switch(b.randomRange(1,2)){case 1:this.speed*=0.5;this.animDelay*=0.5;break;case 2:this.speed*=0.75,this.animDelay*=0.75}},onUpdate:function(a,c){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=!0;this.position.y>=50&&this.nextPhase();break;case 1:if(!this.phaseInit){var e=this.direction.clone();e.x=Math.random();Math.random()>=0.5&&(e.x*=-1);this.setDirection(e);this.phaseTimer.start(b.randomRange(2E3,4E3));this.phaseInit=!0}this.phaseTimer.expired()&&
this.nextPhase();break;case 2:if(!this.phaseInit)this.speed*=2,this.animDelay*=2,this.phaseTimer.start(b.randomRange(250,500)),this.phaseInit=!0;this.phaseTimer.expired()&&(this.speed/=2,this.animDelay/=2,this.setPhase(1));this.chase(c.getPlayerObject())}return"shoot"}};c.spike_wall={role:"trap",team:1,speed:150,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:32,spriteY:256,drawIndex:0,animated:!0,animNumFrames:1,spawnFramesX:96,spawnFramesY:576,spawnFrameCount:2,rotate:!0,rotateSpeed:0,
onInit:function(){this.phaseTimer=new b.Timer;this.spinUpTime=7500;this.wallDirection=new b.Vector2(0,1);this.addState(b.Object.states.SPAWNING)},onDamage:function(){this.spriteX=128},onUpdate:function(a){switch(this.phase){case 0:if(!this.phaseInit)this.phaseTimer.start(this.spinUpTime),this.phaseInit=!0;this.rotateSpeed+=this.spinUpTime/200/1E3*a;this.phaseTimer.expired()&&this.nextPhase();break;case 1:if(!this.phaseInit)b.sound.play("spike_attack"),this.setDirection(this.wallDirection),this.phaseInit=
!0}},onWallCollide:function(){this.stopMoving();this.ttl=1500}};c.spike_sentry={role:"trap",team:1,speed:100,hitPoints:Infinity,damage:10,worth:0,spriteSheet:"objects",spriteX:64,spriteY:256,animated:!0,animNumFrames:1,spawnFramesX:0,spawnFramesY:576,spawnFrameCount:2,rotate:!0,rotateSpeed:100,phase:0,phaseInit:!1,onInit:function(){this.addState(b.Object.states.SPAWNING)},onDamage:function(a){if(a.role==="hero")this.spriteX=160},onUpdate:function(a,c){if(!this.hasState(b.Object.states.SPAWNING))switch(this.phase){case 0:if(!this.phaseInit)this.stopMoving(),
this.phaseInit=!0;var e=c.getPlayerObject().position.clone().subtract(this.position);if(Math.abs(e.y)<32){this.originalPos=this.position.clone();var f=new b.Vector2;f.x=e.x<0?-1:1;this.setDirection(f);this.phase++;this.phaseInit=!1;b.sound.play("spike_attack")}else if(Math.abs(e.x)<32)this.originalPos=this.position.clone(),f=new b.Vector2,f.y=e.y<0?-1:1,this.setDirection(f),this.phase++,this.phaseInit=!1,b.sound.play("spike_attack");break;case 1:if(!this.phaseInit)this.rotateSpeed=this.speed=300,
this.phaseInit=!0;e=this.position.clone().subtract(this.originalPos).abs();if(e.x>256)f=this.direction.clone(),f.x*=-1,this.setDirection(f),this.phase++,this.phaseInit=!1;else if(e.y>128)f=this.direction.clone(),f.y*=-1,this.setDirection(f),this.phase++,this.phaseInit=!1;break;case 2:if(!this.phaseInit)this.speed=50,this.rotateSpeed=100,this.phaseInit=!0;e=this.position.clone().subtract(this.originalPos).abs();if(e.x<5&&e.y<5)this.stopMoving(),this.position=this.originalPos.clone(),this.phase=0,this.phaseInit=
!1}}};c.spikes={role:"trap",team:1,speed:0,hitPoints:Infinity,damage:10,worth:0,spriteSheet:"objects",spriteX:0,spriteY:256,animated:!0,animNumFrames:1,spawnFramesX:224,spawnFramesY:256,spawnFrameCount:3,collidable:!1,onInit:function(){this.addState(b.Object.states.SPAWNING)},onDamage:function(a){if(a.role==="hero")this.spriteX=96}};c.owlbear={role:"monster",team:1,badass:!0,animated:!0,size:new b.Size(64,64),spriteSheet:"characters",spriteY:800,damage:15,hitPoints:250,speed:75,soundAlarm:"owlbear_alarm",
soundAttacks:"owlbear_attacks",soundDamage:"owlbear_damage",soundDies:"owlbear_dies",lootTable:[{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3);this.phaseTimer=new b.Timer},onUpdate:function(d,c){switch(this.phase){case 0:if(!this.phaseInit)this.animDelay=this.speed=150,this.phaseInit=!0;this.position.y>=60&&this.nextPhase();break;case 1:if(!this.phaseInit)this.speed=75,this.animDelay=300,this.phaseInit=!0;a.wander.apply(this,arguments);var e=c.getPlayerObject(),
f=e.position.clone().subtract(this.position).abs();if(f.x<this.size.width/2||f.y<this.size.height/2)this.chase(e),this.nextPhase();break;case 2:if(!this.phaseInit)b.sound.play(this.soundAlarm),this.speed=0,this.animDelay=150,this.phaseTimer.start(500),this.phaseInit=!0;this.position.x+=b.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();break;case 3:if(!this.phaseInit)b.sound.play(this.soundAttacks),this.speed=350,this.animDelay=75,this.phaseTimer.start(2E3),this.phaseInit=!0;this.phaseTimer.expired()&&
this.nextPhase();break;case 4:if(!this.phaseInit)this.stopMoving(),this.animDelay=400,this.phaseTimer.start(1250),this.phaseInit=!0;this.phaseTimer.expired()&&this.setPhase(1)}}};c.cyclops={role:"monster",team:1,badass:!0,animated:!0,gibletSize:"large",size:new b.Size(64,64),spriteSheet:"characters",spriteY:224,moveChangeElapsed:0,moveChangeDelay:1E3,damage:20,hitPoints:200,speed:100,animDelay:100,worth:0,soundAttacks:"cyclops_attacks",soundDamage:"cyclops_damage",soundDies:"cyclops_dies",weapons:[{type:"e_boulder",
count:null}],lootTable:[{type:"item_food",weight:7},{type:"WEAPON_DROP",weight:3}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3);this.setDirection(b.directions.toVector(b.directions.DOWN))},onUpdate:function(){if(this.position.y>=50)this.speed=25,this.animDelay=200,this.onUpdate=a.chase}};c.eyelet={role:"monster",team:1,animated:!0,spriteSheet:"characters",spriteY:512,damage:10,hitPoints:40,speed:100,soundDamage:"eyelet_damage",soundDies:"eyelet_dies",collidable:!1,lootTable:[{type:null,
weight:9},{type:"item_food",weight:1},{type:"WEAPON_DROP",weight:8},{type:"item_weapon_fireball",weight:2}],makeBadass:function(){this.spriteY=960;this.hitPoints=50;this.speed=150;this.damage=20},onInit:function(){b.randomRange(1,10)>5&&(this.spriteY+=32);this.ownerAngle=0;this.phaseTimer=new b.Timer;this.addState(b.Object.states.INVINCIBLE,1E3)},onUpdate:function(d,c){if(c.objects[this.ownerId])switch(this.phase){case 0:if(!this.phaseInit)this.phaseTimer.start(1E4),this.phaseInit=!0;var e=c.objects[this.ownerId],
f=e.position.clone().add(b.Vector2.fromSize(e.size).scale(0.5)).subtract(new b.Vector2(10,10)),h=b.Vector2.fromHeading(this.ownerAngle);this.position=f.add(h.scale(e.eyeletOffset));this.ownerAngle+=1.05/1E3*d;if(this.ownerAngle>Math.PI*2)this.ownerAngle=0;this.phaseTimer.expired()&&c.checkTileCollision(this)===!1&&this.nextPhase();break;case 1:if(!this.phaseInit)this.collidable=!0,this.speed=175,this.phaseInit=!0;a.wander.apply(this,arguments)}else this.wound(this.hitPoints)}};c.cube={role:"monster",
team:1,badass:!0,animated:!0,animDelay:400,gibletSize:"large",size:new b.Size(64,64),spriteSheet:"characters",spriteY:576,moveChangeElapsed:0,moveChangeDelay:1E3,damage:35,hitPoints:750,speed:15,worth:0,soundAttacks:"cube_attacks",soundDamage:"cube_damage",soundDies:"cube_dies",lootTable:[{type:"item_gold_chest",weight:1}],onInit:function(){this.moveChangeDelay=b.randomRange(500,1E3);this.setDirection(b.directions.toVector(b.directions.DOWN));this.phaseTimer=new b.Timer;this.gelTimer=new b.Timer},
onThreat:function(a){if(a.damageType!=="magic")return!0},onUpdate:function(d,c){this.gelTimer.update(d);switch(this.phase){case 0:if(!this.phaseInit)this.speed=100,this.animDelay=200,this.phaseInit=!0;this.position.y>=150&&this.nextPhase();break;case 1:if(!this.phaseInit)this.stopMoving(),this.speed=15,this.animDelay=400,this.phaseTimer.start(6E3),this.gelTimer.start(300),this.phaseInit=!0;if(this.phaseTimer.expired()){this.nextPhase();break}a.wander.apply(this,arguments);this.position.x+=b.randomRange(-1,
1);this.gelTimer.expired()&&(c.spawnObject(this,"gel"),b.sound.play(this.soundAttacks),this.gelTimer.reset());break;case 2:if(!this.phaseInit)this.speed=30,this.animDelay=150,this.phaseTimer.start(7500),this.phaseInit=!0;if(this.phaseTimer.expired()){this.setPhase(1);break}a.chase.apply(this,arguments)}}};c.gel={role:"monster",team:1,animated:!0,animDelay:400,spriteSheet:"characters",spriteY:640,moveChangeElapsed:0,moveChangeDelay:1E3,damage:5,hitPoints:10,speed:150,worth:0,soundDamage:"gel_damage",
soundDies:"gel_dies",onInit:function(){this.setDirection(b.randomDirection());this.moveChangeDelay=b.randomRange(500,1E3);switch(b.randomRange(1,4)){case 1:this.spriteY=640;break;case 2:this.spriteY=672;break;case 3:this.spriteY=704;break;case 4:this.spriteY=736}},onUpdate:function(b,c){a.wander.apply(this,arguments)},onKilled:function(a,b){var c=b.getPlayerObject();!c.hasWeapon("h_fireball")&&!c.hasWeapon("h_fire_sword")&&b.getObjectCountByType("item_weapon_fireball")===0&&b.dropObject(this,"item_weapon_fireball")}};
c.superclops={role:"monster",team:1,badass:!0,animated:!0,gibletSize:"large",size:new b.Size(64,64),spriteSheet:"characters",spriteY:288,moveChangeElapsed:0,moveChangeDelay:1E3,damage:20,hitPoints:750,speed:25,worth:0,soundAttacks:"minotaur_attacks",soundDamage:"minotaur_damage",soundDies:"minotaur_dies",weapons:[{type:"e_minotaur_trident",count:null}],lootTable:[{type:"item_gold_chest",weight:1}],onInit:function(){this.phaseTimer=new b.Timer;this.moveChangeDelay=b.randomRange(500,1E3);this.setDirection(b.directions.toVector(b.directions.DOWN))},
onUpdate:function(d,c){switch(this.phase){case 0:if(!this.phaseInit)this.speed=200,this.animDelay=100,this.phaseInit=!0;this.position.y>=80&&this.nextPhase();break;case 1:if(!this.phaseInit){this.animDelay=250;this.chase(c.getPlayerObject());this.stopMoving();var e=this.facing.heading();c.spawnObject(this,"e_bouncing_boulder",b.Vector2.fromHeading(e-0.3));c.spawnObject(this,"e_bouncing_boulder",b.Vector2.fromHeading(e+0.3));this.phaseTimer.start(1500);this.phaseInit=!0}this.phaseTimer.expired()&&
this.nextPhase();break;case 2:if(!this.phaseInit)this.speed=300,this.animDelay=100,this.setDirection(this.facing),this.phaseTimer.start(2E3),this.phaseInit=!0;this.phaseTimer.expired()&&this.nextPhase();break;case 3:if(!this.phaseInit)this.speed=15,this.animDelay=400,this.phaseTimer.start(2E3),this.phaseInit=!0;a.wander.apply(this,arguments);this.phaseTimer.expired()&&(this.wounds>this.hitPoints/2?this.nextPhase():this.setPhase(1));break;case 4:if(!this.phaseInit)this.stopMoving(),this.animDelay=
300,this.phaseTimer.start(1500),this.phaseInit=!0;if(this.phaseTimer.expired()){this.nextPhase();break}this.position.x+=b.randomRange(-1,1);break;case 5:if(!this.phaseInit)this.cooldown=!1,this.weapons=[{type:"e_bouncing_boulder",count:null}],this.phaseInit=!0;c.objectAttack(this);this.position.x+=b.randomRange(-1,1);this.nextPhase();break;case 6:if(!this.phaseInit)this.speed=50,this.weapons=[{type:"e_minotaur_trident",count:null}],this.cooldown=!0,this.phaseTimer.start(6E3),this.phaseInit=!0;this.phaseTimer.expired()&&
this.setPhase(4);c.objectAttack(this);a.chase.apply(this,arguments)}},onWallCollide:function(){this.phase===2&&this.nextPhase()}};c.imp={role:"monster",team:1,speed:100,hitPoints:20,damage:15,worth:0,spriteSheet:"characters",spriteY:64,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,soundDamage:"imp_damage",soundDies:"imp_dies",phase:0,phaseInit:!1,lootTable:[{type:null,weight:7},{type:"item_food",weight:1},{type:"WEAPON_DROP",weight:2}],onInit:function(){this.phaseTimer=new b.Timer;
this.moveChangeDelay=b.randomRange(500,1E3)},onKilled:function(a,c){a.role==="projectile"&&a.die();for(var e=0;e<2;++e)c.spawnObject(this,"dire_bat",b.randomDirection(),!1)},onUpdate:function(b,c){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=!0;if(this.position.y>=50)this.phase++,this.phaseInit=!1;break;case 1:if(!this.phaseInit)this.speed=50,this.animDelay=400,this.phaseTimer.start(2500,7500),this.phaseInit=!0;a.wander.apply(this,arguments);if(this.phaseTimer.expired())this.phase++,
this.phaseInit=!1;break;case 2:if(!this.phaseInit)this.animDelay=this.speed=150,this.phaseTimer.start(2500,7500),this.phaseInit=!0;a.wander.apply(this.arguments);if(this.phaseTimer.expired())this.phase=1,this.phaseInit=!1}}};c.wizard={role:"monster",team:1,speed:100,hitPoints:20,damage:10,worth:0,spriteSheet:"characters",spriteY:416,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_shock_wave",count:null}],soundAttacks:"wizard_attacks",soundDisappear:"wizard_disappear",
soundReappear:"wizard_reappear",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:6},{type:"item_chest",weight:2},{type:"WEAPON_DROP",weight:2}],phase:0,phaseInit:!1,onInit:function(){this.phaseTimer=new b.Timer;this.moveChangeDelay=b.randomRange(500,1E3);this.moveToY=b.randomRange(50,75)},onUpdate:function(d,c){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=!0;if(this.position.y>=this.moveToY)this.phase++,this.phaseInit=!1;break;case 1:if(!this.phaseInit)this.animated=
!1,this.stopMoving(),this.addState(b.Object.states.INVINCIBLE),this.phaseTimer.start(1E3),this.phaseInit=!0,b.sound.play(this.soundDisappear);if(this.phaseTimer.expired())this.phase++,this.phaseInit=!1;break;case 2:if(!this.phaseInit)this.speed=500,this.addState(b.Object.states.INVISIBLE),this.phaseTimer.start(b.randomRange(1E3,2E3)),this.phaseInit=!0;var e=this.boundingBox().center(),e=c.getPlayerObject().boundingBox().center().clone().subtract(e).abs();a.wander.apply(this,arguments);if(this.phaseTimer.expired()&&
e.magnitude()>90)this.phase++,this.phaseInit=!1;break;case 3:if(!this.phaseInit)this.stopMoving(),this.removeState(b.Object.states.INVISIBLE),this.phaseTimer.start(1E3),this.phaseInit=!0,b.sound.play(this.soundReappear);if(this.phaseTimer.expired())this.phase++,this.phaseInit=!1;break;case 4:if(!this.phaseInit)this.speed=0,this.animated=!0,this.removeState(b.Object.states.INVINCIBLE),this.phaseTimer.start(b.randomRange(2E3,3E3)),this.phaseInit=!0,this.shotOnce=!1;this.chase(c.getPlayerObject());if(this.phaseTimer.expired())this.phase=
1,this.phaseInit=!1;if(!this.shotOnce)return this.shotOnce=!0,"shoot"}}};c.sandworm={role:"monster",team:1,animated:!0,animDelay:200,spriteSheet:"characters",spriteY:480,spawnFramesX:544,spawnFramesY:448,spawnFrameCount:2,damage:25,hitPoints:50,speed:50,worth:0,phase:0,phaseInit:!1,moveChangeElapsed:0,moveChangeDelay:2E3,soundAttacks:"sandworm_attacks",soundDamage:"goblin_damage",soundDies:"sandworm_dies",lootTable:[{type:null,weight:4},{type:"item_chest",weight:2},{type:"WEAPON_DROP",weight:2},{type:"item_food",
weight:2}],onInit:function(){this.phaseTimer=new b.Timer;this.dirtTimer=new b.Timer;this.attackTimer=new b.Timer},onUpdate:function(d,c){switch(this.phase){case 0:if(!this.phaseInit)this.speed=50,this.addState(b.Object.states.INVISIBLE),this.phaseTimer.start(b.randomRange(5E3,1E4)),this.dirtTimer.start(150),this.phaseInit=!0;this.dirtTimer.update(d);this.position.y<=50?this.setDirection(b.directions.toVector(b.directions.DOWN)):a.wander.apply(this,arguments);if(this.phaseTimer.expired())this.phase++,
this.phaseInit=!1;this.dirtTimer.expired()&&(c.spawnObject(this,"e_dirt_pile"),this.dirtTimer.reset());break;case 1:if(!this.phaseInit)this.stopMoving(),this.speed=0,this.removeState(b.Object.states.INVISIBLE),this.addState(b.Object.states.SPAWNING),this.spawnFrameIndex=0,this.phaseInit=!0;if(!this.hasState(b.Object.states.SPAWNING))this.phase++,this.phaseInit=!1;break;case 2:if(!this.phaseInit)this.phaseAttacks=0,this.phaseInit=!0,this.attackTimer.start(200);this.attackTimer.update(d);this.phaseAttacks<
1&&this.attackTimer.expired()&&(this.phaseAttacks++,this.setDirection(b.randomDirection()),c.spawnObject(this,"e_worm_spit"),b.sound.play(this.soundAttacks),this.attackTimer.reset(),this.phaseAttacks===1&&this.phaseTimer.start(2E3));if(this.phaseAttacks>=1&&this.phaseTimer.expired())this.phase++,this.phaseInit=!1;break;case 3:if(!this.phaseInit)this.addState(b.Object.states.DESPAWNING),this.spawnFrameIndex=2,this.phaseInit=!0;if(!this.hasState(b.Object.states.DESPAWNING))this.addState(b.Object.states.INVISIBLE),
this.phase=0,this.phaseInit=!1}}};c.doppelganger={role:"monster",team:1,badass:!0,animated:!0,spriteSheet:"characters",spriteY:0,spriteY:768,spriteYOverlay:928,damage:20,hitPoints:5E3,speed:200,soundAttacks:"dopp_attacks",soundDamage:"dopp_damage",soundDies:"dopp_dies",onInit:function(){this.phaseTimer=new b.Timer},onKilled:function(a,b){for(var c in b.objects){var f=b.objects[c];if(f.role==="monster"&&f.id!==this.id)f.wound(f.hitPoints);else if(f.role==="trap")f.ttl=1500}},onUpdate:function(a,c){switch(this.phase){case 0:if(!this.phaseInit)this.speed=
300,this.animDelay=100,this.phaseInit=!0;this.position.y>100&&this.nextPhase();break;case 1:if(!this.phaseInit)this.animDelay=this.speed=200,this.waypoints=this.getPattern(),this.currentWaypoint=this.waypoints.shift(),this.phaseInit=!0;this.moveToward(this.currentWaypoint);var e=this.currentWaypoint.clone().subtract(this.position).abs().magnitude();if(e<10)this.position=this.currentWaypoint.clone(),this.nextPhase();break;case 2:if(!this.phaseInit)this.setDirection(new b.Vector2(0,1)),this.stopMoving(),
this.phaseTimer.start(500),this.phaseInit=!0;this.position.x+=b.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();break;case 3:if(!this.phaseInit)this.currentWaypoint=this.waypoints.shift(),this.speed=400,this.animDelay=100,this.phaseInit=!0,this.spikeTimer=new b.Timer,this.spikeTimer.start(200);this.spikeTimer.update(a);if(this.spikeTimer.expired()){b.sound.play("spike_attack");var f=c.spawnObject(this,"spikes");if(f=c.objects[f])f.ttl=1E4;this.spikeTimer.reset()}this.moveToward(this.currentWaypoint);
e=this.currentWaypoint.clone().subtract(this.position).abs().magnitude();if(e<10)this.position=this.currentWaypoint.clone(),this.waypoints.length>0?this.currentWaypoint=this.waypoints.shift():this.nextPhase();break;case 4:if(!this.phaseInit)this.speed=100,this.animDelay=200,this.phaseTimer.start(7500),this.phaseInit=!0;e=c.getPlayerObject();e.wounds<e.hitPoints&&this.chase(e);this.phaseTimer.expired()&&this.nextPhase();break;case 5:if(!this.phaseInit)this.animDelay=this.speed=200,this.phaseInit=!0,
this.targetPos=new b.Vector2(32,66);this.moveToward(this.targetPos);e=this.targetPos.clone().subtract(this.position).abs().magnitude();if(e<10)this.position=this.targetPos.clone(),this.nextPhase();break;case 6:if(!this.phaseInit)this.setDirection(new b.Vector2(0,1)),this.stopMoving(),this.phaseInit=!0,this.makeSpikeWalls(c),this.weapons=[{type:"e_dopp_sword",count:null}];this.phaseTimer.expired()&&this.nextPhase();this.chase(c.getPlayerObject());this.stopMoving();if(this.wounds>this.hitPoints*0.33)return"shoot";
break;case 7:if(!this.phaseInit)this.stopMoving(),this.phaseTimer.start(4E3),this.phaseInit=!0;if(this.phaseTimer.expired())e=b.makeObject("item_food"),e.position.x=32,e.position.y=64,c.addObject(e),this.nextPhase();break;case 8:if(!this.phaseInit)this.animDelay=this.speed=200,this.weapons=[{type:"e_dopp_axe",count:null}],this.cooldown=!1,this.waypoints=this.getPattern(),this.currentWaypoint=this.waypoints.shift(),this.axeTimer=new b.Timer,this.axeTimer.start(3E3),this.axeTimer.update(3E3),this.phaseInit=
!0;this.axeTimer.update(a);this.axeTimer.expired()&&(this.chase(c.getPlayerObject()),c.spawnObject(this,"e_dopp_axe"),this.axeTimer.reset());this.moveToward(this.currentWaypoint);e=this.currentWaypoint.clone().subtract(this.position).abs().magnitude();if(e<10)this.position=this.currentWaypoint.clone(),this.waypoints.length>0?this.currentWaypoint=this.waypoints.shift():this.nextPhase();break;case 9:if(!this.phaseInit)this.animDelay=this.speed=200,this.phaseInit=!0,this.targetPos=new b.Vector2(304,
224);this.moveToward(this.targetPos);e=this.targetPos.clone().subtract(this.position).abs().magnitude();if(e<10)this.position=this.targetPos.clone(),this.nextPhase();break;case 10:if(!this.phaseInit){b.sound.play("minotaur_dies");this.setDirection(new b.Vector2(0,1));this.stopMoving();this.phaseInit=!0;for(e=0;e<60;++e)f=c.spawnObject(this,"dire_bat"),f=c.objects[f],f.setDirection(b.randomDirection()),f.addState(b.Object.states.INVINCIBLE,250);this.phaseTimer.start(8E3)}this.phaseTimer.expired()&&
this.setPhase(1)}},getPattern:function(){switch(b.randomRange(1,3)){case 1:return[new b.Vector2(64,320),new b.Vector2(64,96),new b.Vector2(544,96),new b.Vector2(544,320),new b.Vector2(128,320),new b.Vector2(128,160),new b.Vector2(480,160),new b.Vector2(480,256),new b.Vector2(192,256)];case 2:return[new b.Vector2(576,352),new b.Vector2(32,352),new b.Vector2(32,288),new b.Vector2(576,288),new b.Vector2(576,224),new b.Vector2(32,224),new b.Vector2(32,160),new b.Vector2(576,160),new b.Vector2(576,96),
new b.Vector2(32,96)];case 3:return[new b.Vector2(576,64),new b.Vector2(32,64),new b.Vector2(288,192),new b.Vector2(32,352),new b.Vector2(576,352),new b.Vector2(352,224),new b.Vector2(576,64)]}},makeSpikeWalls:function(a){b.sound.play("wizard_reappear");var c=3,e=5E3,f=2;this.wounds>this.hitPoints*0.66?(c=1,e=5E3,f=2):this.wounds>this.hitPoints*0.33&&(c=2,e=7500,f=1.5);this.phaseTimer.start(e-1500);for(var h=[],g=0;g<18;++g)h.push(!0);for(g=0;g<c;++g){for(var j=0,k=!1;k===!1;)j=b.randomRange(3,h.length-
1),k=h[j]===!0;h[j]=!1}for(g=0;g<h.length;++g)if(h[g]===!0)j=b.makeObject("spike_wall"),j.position=new b.Vector2(32+g*32,64),j.spinUpTime=e,j.speed*=f,a.addObject(j);h=[];for(g=0;g<10;++g)h.push(!0);for(g=0;g<c;++g){j=0;for(k=!1;k===!1;)j=b.randomRange(3,h.length-1),k=h[j]===!0;h[j]=!1}for(g=0;g<h.length;++g)if(h[g]===!0)j=b.makeObject("spike_wall"),j.position=new b.Vector2(32,64+g*32),j.wallDirection=new b.Vector2(1,0),j.spinUpTime=e,j.speed=275,j.speed*=f,a.addObject(j)}};c.e_dopp_axe={role:"projectile",
cooldown:2500,speed:250,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:160,spriteY:32,rotate:!0,rotateSpeed:700,priority:5,ttl:1E4,soundAttacks:"dopp_attacks",onInit:function(){this.spawnTimer=new b.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){b.objectExists(this.ownerId)||this.die();this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"e_dopp_fire"),this.spawnTimer.reset())}};c.e_dopp_sword={role:"projectile",cooldown:750,speed:350,hitPoints:Infinity,damage:5,
spriteSheet:"objects",spriteX:384,spriteY:544,spriteAlign:!0,priority:2,bounce:!1,piercing:!0,soundAttacks:"dopp_attacks",onInit:function(){this.spawnTimer=new b.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"e_dopp_fire"),this.spawnTimer.reset())}};c.beholder={role:"monster",team:1,badass:!0,size:new b.Size(128,128),spriteSheet:"beholder",animated:!0,animDelay:350,drawIndex:3,damage:30,hitPoints:3E3,speed:50,soundDamage:"beholder_damage",
soundDies:"beholder_dies",collidable:!1,lootTable:[{type:"item_weapon_fire_sword",weight:1}],onInit:function(){this.phaseTimer=new b.Timer;this.attackTimer=new b.Timer;this.eyeletOffset=100;this.eyeletOffsetMod=1;this.enraged=!1},onUpdate:function(d,c){this.attackTimer.update(d);if(this.attackTimer.expired()){b.sound.play("wizard_attacks");var e=c.spawnObject(this,"e_energy_ball"),f=c.objects[e];f.chase(c.getPlayerObject());this.attackTimer.reset()}this.eyeletOffset+=0.02*d*this.eyeletOffsetMod;if(this.eyeletOffset>
120)this.eyeletOffsetMod=-1;if(this.eyeletOffset<100)this.eyeletOffsetMod=1;if(this.wounds>this.hitPoints/2&&!this.enraged)this.enraged=!0,this.speed*=1.5,this.animDelay/=2,this.attackTimer.start(2E3);switch(this.phase){case 0:if(!this.phaseInit)this.speed=200,this.addState(b.Object.states.INVISIBLE),this.phaseInit=!0;this.position.y>=70&&this.nextPhase();break;case 1:if(!this.phaseInit)b.sound.play("wizard_reappear"),this.speed=50,this.removeState(b.Object.states.INVISIBLE),this.addState(b.Object.states.INVINCIBLE),
this.phaseTimer.start(2E3),this.phaseInit=!0;a.wander.apply(this,arguments);this.phaseTimer.expired()&&(this.attackTimer.start(4E3),this.nextPhase());break;case 2:if(!this.phaseInit)this.removeState(b.Object.states.INVINCIBLE),this.collidable=!0,this.eyeletTimer=new b.Timer,this.eyeletTimer.start(500),this.eyeletsSpawned=0,this.phaseInit=!0;this.eyeletTimer.update(d);a.wander.apply(this,arguments);this.eyeletTimer.expired()&&(b.sound.play("wizard_reappear"),this.eyeletTimer.reset(),e=c.spawnObject(this,
"eyelet"),this.wounds>this.hitPoints/2&&(f=c.objects[e],f.makeBadass()),++this.eyeletsSpawned,this.eyeletsSpawned>=12&&this.nextPhase());break;case 3:if(!this.phaseInit)this.phaseTimer.start(2E4),this.phaseInit=!0;f=!1;for(e in c.objects)if(c.objects[e].ownerId===this.id){f=!0;break}(this.phaseTimer.expired()||!f)&&this.nextPhase();a.wander.apply(this,arguments);break;case 4:if(!this.phaseInit)this.stopMoving(),this.phaseTimer.start(2E3),this.phaseInit=!0;this.position.x+=b.randomRange(-2,2);this.phaseTimer.expired()&&
this.nextPhase();break;case 5:for(e=0;e<2;++e)c.spawnObject(this,"gas_cloud");this.nextPhase();break;case 6:if(!this.phaseInit)this.oldSpeed=this.speed,this.speed=250,this.oldAnimDelay=this.animDelay,this.animDelay=100,this.chase(c.getPlayerObject()),this.phaseTimer.start(1E3),this.phaseInit=!0}},onWallCollide:function(){if(this.phase===6&&this.phaseTimer.expired())this.speed=this.oldSpeed,this.animDelay=this.oldAnimDelay,this.setPhase(2)}};c.gas_cloud={role:"trap",team:1,animated:!0,size:new b.Size(128,
128),spriteSheet:"characters",spriteX:640,spriteY:416,drawIndex:2,animDelay:400,damage:20,hitPoints:9999,speed:10,ttl:9E4,damageType:"magic",onInit:function(){this.setDirection(b.randomDirection());this.moveChangeDelay=b.randomRange(5E3,1E4)},onUpdate:function(b,c){if(this.animFrameIndex===2)this.animated=!1,this.spriteX=896;if(this.team===1&&!c.objects[this.ownerId]&&this.ttl-this.ttlElapsed>2E3)this.ttlElapsed=this.ttl-2E3;a.wander.apply(this,arguments)},onObjectCollide:function(a){a.team!==this.team&&
a.role!=="projectile"&&a.addState(b.Object.states.SLOWED,300);if(this.team!==3&&a.damageType=="magic")b.sound.play("fire_attack"),this.ownerId=null,this.team=3,this.damage=5,this.ttl=2E3,this.ttlElapsed=0,this.spriteY+=224,this.animDelay=500,this.animFrameIndex=0,this.animNumFrames=3}};c.dragon={role:"monster",team:1,badass:!0,animated:!0,gibletSize:"large",size:new b.Size(64,64),spriteSheet:"characters",spriteY:352,moveChangeElapsed:0,moveChangeDelay:0,damage:20,hitPoints:1E3,speed:20,worth:0,soundAttacks:"dragon_attacks",
soundDamage:"dragon_damage",soundDies:"dragon_dies",weapons:[{type:"e_fireball",count:null}],lootTable:[{type:"item_gold_chest",weight:1}],phase:0,phaseInit:!1,onInit:function(){this.phaseTimer=new b.Timer;this.moveChangeDelay=b.randomRange(500,1E3);this.setDirection(b.directions.toVector(b.directions.DOWN));this.altTimer=new b.Timer},onUpdate:function(a,c){this.altTimer.update(a);switch(this.phase){case 0:if(!this.phaseInit)this.speed=200,this.animDelay=50,this.phaseInit=!0;if(this.position.y>=200)this.phase++,
this.phaseInit=!1;break;case 1:if(!this.phaseInit)this.stopMoving(),this.animDelay=300,this.phaseTimer.start(1E3),this.phaseInit=!0;this.position.x+=b.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();break;case 2:if(!this.phaseInit)this.cooldown=!1,this.stopMoving(),this.weapons=[{type:"e_ring_fire",count:null}],this.phaseInit=!1;c.objectAttack(this);this.nextPhase();break;case 3:if(!this.phaseInit)this.speed=0,this.animDelay=100,this.phaseTimer.start(2E3),this.phaseInit=!0,this.altTimer.start(350),
this.followUpShot=!1;if(!this.followUpShot&&this.altTimer.expired()&&this.wounds>this.hitPoints/2)this.cooldown=!1,this.weapons=[{type:"e_ring_fire_dopp",count:null}],c.objectAttack(this),this.followUpShot=!0;if(this.phaseTimer.expired())this.phase++,this.phaseInit=!1;this.position.x+=b.randomRange(-1,1);break;case 4:if(!this.phaseInit){this.speed=350;this.animDelay=100;this.phaseTimer.start(500);this.phaseInit=!0;var e=c.getPlayerObject();this.chase(e)}if(this.phaseTimer.expired())this.phase++,this.phaseInit=
!1;break;case 5:if(!this.phaseInit)this.speed=0,this.animDelay=400,this.weapons=[{type:"e_fireball_green",count:null}],this.cooldown=!1,this.cooldownElapsed=0,this.phaseTimer.start(2500),this.phaseInit=!0,this.altTimer.start(750);if(this.phaseTimer.expired())this.phase=2,this.phaseInit=!1;e=c.getPlayerObject();this.chase(e);this.altTimer.expired()&&this.wounds>this.hitPoints/2&&(c.spawnObject(this,"e_fireball"),this.altTimer.reset());return"shoot"}}};c.e_arrow={role:"projectile",cooldown:4E3,speed:200,
hitPoints:1,damage:5,spriteSheet:"objects",spriteX:256,spriteY:0,spriteAlign:!0,bounce:!1};c.e_trident={role:"projectile",cooldown:5E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:160,spriteY:0,spriteAlign:!0,bounce:!1};c.e_boulder={role:"projectile",cooldown:2E3,speed:150,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:224,spriteY:0,rotate:!0,bounce:!1};c.e_bouncing_boulder={role:"projectile",cooldown:1500,speed:150,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:224,
spriteY:0,rotate:!0,bounce:!0,ttl:5E3};c.e_minotaur_trident={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:20,spriteAlign:!0,spriteSheet:"objects",spriteX:160,spriteY:0,bounce:!1};c.e_energy_ball={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:25,spriteSheet:"objects",spriteX:320,spriteY:0,rotate:!0,bounce:!1};c.e_ring_fire={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:!0,bounce:!1,
damageType:"magic"};c.e_ring_fire_dopp={role:"projectile",cooldown:2E3,speed:150,hitPoints:Infinity,damage:25,spriteSheet:"objects",spriteX:352,spriteY:544,rotate:!0,bounce:!1,damageType:"magic"};c.e_fireball={role:"projectile",cooldown:2E3,speed:350,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:352,spriteY:544,rotate:!0,bounce:!1,damageType:"magic"};c.e_fireball_green={role:"projectile",cooldown:75,speed:350,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:!0,
ttl:400,bounce:!1,damageType:"magic"};c.e_static_blue_fire={role:"projectile",cooldown:100,speed:0,hitPoints:Infinity,damage:5,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:!0,rotateSpeed:100,ttl:1E3,bounce:!1,drawIndex:0,damageType:"magic"};c.e_dopp_fire={role:"projectile",cooldown:200,speed:0,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:!0,rotateSpeed:200,ttl:250,bounce:!1,drawIndex:0,damageType:"magic"};c.e_static_green_fire={role:"projectile",cooldown:200,
speed:0,hitPoints:Infinity,damage:10,size:new b.Size(64,64),spriteSheet:"objects",spriteX:64,spriteY:192,rotate:!0,rotateSpeed:150,ttl:2E3,bounce:!1,drawIndex:0,damageType:"magic"};c.e_dirt_pile={role:"trap",cooldown:100,speed:0,hitPoints:Infinity,damage:0,spriteSheet:"characters",spriteX:0,spriteY:448,ttl:3E3,bounce:!1,drawIndex:-2,onInit:function(){b.randomRange(1,10)>5&&(this.spriteX+=32)},onObjectCollide:function(a){a.team!==this.team&&a.role!=="projectile"&&a.addState(b.Object.states.SLOWED,
300)}};c.e_spit_pool={role:"trap",cooldown:100,speed:0,hitPoints:9999,damage:5,size:new b.Size(64,64),spriteSheet:"characters",spriteX:896,spriteY:416,animated:!0,ttl:7500,bounce:!1,drawIndex:-1,collidable:!1,onObjectCollide:function(a){a.team!==this.team&&a.role!=="projectile"&&a.addState(b.Object.states.SLOWED,300)}};c.e_shock_wave={role:"projectile",cooldown:1E3,speed:200,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:224,spriteY:32,spriteAlign:!0,bounce:!1,animated:!0,damageType:"magic"};
c.e_worm_spit={role:"projectile",cooldown:1E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:128,spriteY:64,spriteAlign:!0,bounce:!1,animated:!0,damageType:"magic",onInit:function(){this.dieTimer=new b.Timer;this.dieTimer.start(1E3)},onUpdate:function(a){this.dieTimer.update(a);this.dieTimer.expired()&&this.die()},onDelete:function(a){a.spawnObject(this,"e_spit_pool")}};c.mini_heart={role:"fluff",spriteSheet:"objects",spriteX:288,spriteY:128,size:new b.Size(10,10),ttl:600,speed:75,
collidable:!1,drawIndex:5,onInit:function(){this.setDirection(new b.Vector2(0,-1));this.speed=b.randomRange(55,85)}};c.mini_skull={role:"fluff",spriteSheet:"objects",spriteX:320,spriteY:128,size:new b.Size(10,10),ttl:1300,collidable:!1,drawIndex:5,onInit:function(){this.setDirection(new b.Vector2(0,-1));this.speed=b.randomRange(25,60)}};c.rose={role:"fluff",spriteSheet:"objects",collidable:!1,rotate:!0,spriteX:192,spriteY:256,drawIndex:-1,onInit:function(){this.speed=b.randomRange(150,200);this.rotateSpeed=
b.randomRange(75,100);this.phaseTimer=new b.Timer},onUpdate:function(){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=!0,this.direction.y=-(b.randomRange(0,5)/10),this.phaseTimer.start(b.randomRange(500,1750));this.direction.y+=0.01;this.phaseTimer.expired()&&this.nextPhase();break;case 1:if(!this.phaseInit)this.stopMoving(),this.rotate=!1,this.phaseInit=!0}}};c.cloud={role:"fluff",spriteSheet:"objects",collidable:!1,drawIndex:10,onInit:function(){this.alpha=0.25;this.speed=b.randomRange(5,
25);this.size=new b.Size(192,128);switch(b.randomRange(1,4)){case 1:this.spriteX=0;this.spriteY=288;break;case 2:this.size=new b.Size(128,96);this.spriteX=192;this.spriteY=288;break;case 3:this.spriteX=0;this.spriteY=416;break;case 4:this.size=new b.Size(160,128),this.spriteX=192,this.spriteY=416}}};c.gate={role:"fluff",speed:25,spriteSheet:"objects",spriteX:0,spriteY:192,size:new b.Size(64,64)};c.pickup_arrow={role:"fluff",speed:0,spriteSheet:"objects",spriteX:0,spriteY:608,size:new b.Size(118,52),
drawIndex:9,animated:!0};c.item_food={role:"powerup_food",healAmount:10,speed:0,spriteSheet:"objects",spriteX:96,spriteY:32,ttl:8E3};c.item_coin={role:"powerup_coin",coinAmount:100,speed:0,spriteSheet:"objects",spriteX:64,spriteY:32,ttl:5E3};c.item_chest={role:"powerup_coin",coinAmount:500,speed:0,spriteSheet:"objects",spriteX:32,spriteY:32,ttl:5E3};c.item_gold_chest={role:"powerup_coin",coinAmount:5E3,speed:0,spriteSheet:"objects",spriteX:0,spriteY:32};c.item_weapon_knife={role:"powerup_weapon",
speed:0,spriteSheet:"objects",spriteX:32,spriteY:0,ttl:5E3,wepType:"h_knife",wepCount:125};c.item_weapon_spear={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:96,spriteY:0,ttl:5E3,wepType:"h_spear",wepCount:100};c.item_weapon_fireball={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:192,spriteY:0,ttl:5E3,wepType:"h_fireball",wepCount:100};c.item_weapon_axe={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:192,spriteY:32,ttl:5E3,wepType:"h_axe",wepCount:75};c.item_weapon_fire_sword=
{role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:384,spriteY:0,wepType:"h_fire_sword",wepCount:5E3}})();(function(){b.ImageLoader=function(){this.images={};this.numImages=this.numLoaded=0};var c=b.ImageLoader.prototype;c.load=function(a,c,i){this.callback=function(){c.call(i)};for(var e in a)this.numImages++,this.images[e]=new Image,b.on("load",this.handleImageLoad,this.images[e],this),b.on("error",this.handleImageError,this.images[e],this),this.images[e].src=a[e]};c.increment=function(){this.numLoaded++;
this.numLoaded>=this.numImages&&this.callback()};c.handleImageLoad=function(){this.increment()};c.handleImageError=function(){this.increment()};c.getImage=function(a){return this.images[a]?this.images[a]:!1}})();(function(){b.SpawnPoint=function(a,c,i,e){this.delay=500;this.lastSpawnElapsed=0;this.location=new b.Rect(a,c,i,e);this.queue=[]};var c=b.SpawnPoint.prototype;c.update=function(a,c){this.lastSpawnElapsed+=a;if(this.lastSpawnElapsed>=this.delay||c===!0){this.lastSpawnElapsed=0;if(this.queue.length<
1)return!1;var i=this.queue.shift(),e=this.location,i=b.makeObject(i);i.position.x=b.randomRange(e.left,e.left+e.width-i.size.width);i.position.y=b.randomRange(e.top,e.top+e.height-i.size.height);e=i.direction.clone();e.y=1;i.setDirection(e);return i}return!1};c.queueSpawn=function(a,b){for(var b=Number(b)||1,c=0;c<b;c++)this.queue.push(a)}})();(function(){b.SpawnWave=function(){this.points=[];this.nextWaveTime=2E4;this.bossWave=!1};var c=b.SpawnWave.prototype;c.addSpawnPoint=function(a,b){this.points.push({spawnPointId:a,
delay:b,objects:[]})};c.addObjects=function(a,b,c){var e=null,f;for(f in this.points)this.points[f].spawnPointId===a&&(e=this.points[f]);if(e===null)return!1;e.objects.push({type:b,count:Math.floor(c)})}})();(new b.Engine).run()})();

	}());
	</script>

	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-16927444-5']);
	  _gaq.push(['_trackPageview']);
	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>

</body>
</html>
