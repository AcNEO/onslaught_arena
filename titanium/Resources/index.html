<!DOCTYPE html>
<html>
<head>
	<title>Onslaught!</title>
	<link rel="stylesheet" href="css/horde.css">
</head>
<body>
	
	<script>horde={};horde.canvasFallbackContent='<div class="fallback"><p>Your browser does not appear to support <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>.</p><p>Please try one of the following, more standards compliant browsers: <a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.apple.com/safari/">Safari</a>, <a href="http://www.mozilla.com/firefox/">Firefox</a> or <a href="http://www.opera.com/">Opera</a>.</p></div>';
horde.setInterval=function(f,c,a){return window.setInterval(function(){c.call(a)},f)};horde.setTimeout=function(f,c,a){return window.setTimeout(function(){c.call(a)},f)};horde.on=function(f,c,a,b){a.addEventListener(f,function(d){c.call(b,d)},false)};horde.stopEvent=function(f){f.cancelBubble=true;f.stopPropagation();f.preventDefault()};horde.now=function(){return Date.now()};
horde.makeCanvas=function(f,c,a,b){var d=document.createElement("canvas");d.id=f;d.width=Number(c)||0;d.height=Number(a)||0;if(b!==true){d.innerHTML=horde.canvasFallbackContent;document.body.appendChild(d)}return d};horde.randomRange=function(f,c){return Math.round(Math.random()*(c-f))+f};horde.randomDirection=function(){var f=new horde.Vector2(horde.randomRange(-10,10),horde.randomRange(-10,10));f.normalize();return f};
horde.makeObject=function(f,c){var a=new horde.Object;a.type=f;for(var b in horde.objectTypes[f])a[b]=horde.objectTypes[f][b];c!==true&&a.init();return a};
horde.directions={UP:0,UP_RIGHT:1,RIGHT:2,DOWN_RIGHT:3,DOWN:4,DOWN_LEFT:5,LEFT:6,UP_LEFT:7,toVector:function(f){if(f<0)f+=8;if(f>7)f-=8;switch(f){case horde.directions.UP:return new horde.Vector2(0,-1);case horde.directions.UP_RIGHT:return new horde.Vector2(1,-1);case horde.directions.RIGHT:return new horde.Vector2(1,0);case horde.directions.DOWN_RIGHT:return new horde.Vector2(1,1);case horde.directions.DOWN:return new horde.Vector2(0,1);case horde.directions.DOWN_LEFT:return new horde.Vector2(-1,
1);case horde.directions.LEFT:return new horde.Vector2(-1,0);case horde.directions.UP_LEFT:return new horde.Vector2(-1,-1)}},fromVector:function(f){if(f.x>-0.25&&f.x<0.25&&f.y<0)return horde.directions.UP;if(f.x>-0.25&&f.x<0.25&&f.y>0)return horde.directions.DOWN;if(f.x>0&&f.y>-0.25&&f.y<0.25)return horde.directions.RIGHT;if(f.x<0&&f.y>-0.25&&f.y<0.25)return horde.directions.LEFT;if(f.x>0&&f.y<0)return horde.directions.UP_RIGHT;if(f.x>0&&f.y>0)return horde.directions.DOWN_RIGHT;if(f.x<0&&f.y>0)return horde.directions.DOWN_LEFT;
if(f.x<0&&f.y<0)return horde.directions.UP_LEFT}};(function(){horde.Timer=function(){this.startTime=0;this.endTime=null;this.ttl=0};var f=horde.Timer,c=f.prototype;f.now=function(){return Date.now()};c.start=function(a){if(a)this.ttl=Number(a);this.startTime=f.now()};c.reset=function(){this.start()};c.stop=function(){this.endTime=f.now();return this.elapsed()};c.elapsed=function(){return this.endTime!==null?this.endTime-this.startTime:f.now()-this.startTime};c.expired=function(){if(this.ttl>0)return this.elapsed()>this.ttl;return false}})();(function(){horde.sound={};var f="html5",c=".mp3",a=false,b={};horde.sound.init=function(d){if(typeof Titanium=="undefined"){var g=document.createElement("audio");if(g.canPlayType)g.canPlayType("audio/mpeg;")||(c=".ogg")}else f="Titanium";switch(f){case "html5":case "Titanium":d();break}};horde.sound.create=function(d,g,h,j){h=!!h;g+=c;if(j===undefined)j=100;switch(f){case "html5":var i=new Audio;i.preload="auto";i.src=g;h&&i.addEventListener("ended",function(){this.currentTime=0;this.play()},false);
i.load();i.volume=j/100;b[d]=i;break;case "Titanium":b[d]=Titanium.Media.createSound("app://"+g);if(h)b[d].oncomplete=function(){this.play()};b[d].setVolume(0);b[d].play();b[d].stop();b[d].setVolume(j/100);break}};horde.sound.play=function(d){if(a)return false;switch(f){case "html5":try{b[d].pause();b[d].currentTime=0;b[d].play()}catch(g){}break;case "Titanium":b[d].isPlaying()&&b[d].stop();b[d].play();break}};horde.sound.stop=function(d){switch(f){case "html5":b[d].pause();b[d].currentTime=0;break;
case "Titanium":b[d].stop();break}};horde.sound.stopAll=function(){switch(f){case "html5":for(var d in b){b[d].pause();b[d].currentTime=0}break;case "Titanium":for(d in b)b[d].stop();break}};horde.sound.pauseAll=function(){switch(f){case "html5":for(var d in b)b[d].currentTime>0&&b[d].pause();break;case "Titanium":for(d in b)b[d].isPlaying()&&b[d].pause();break}};horde.sound.resumeAll=function(){switch(f){case "html5":for(var d in b)b[d].currentTime>0&&b[d].play();break;case "Titanium":for(d in b)b[d].isPaused()&&
b[d].play();break}};horde.sound.toggleMuted=function(){horde.sound.setMuted(!horde.sound.isMuted())};horde.sound.isMuted=function(){return a};horde.sound.setMuted=function(d){if(a!==d)(a=d)?horde.sound.pauseAll():horde.sound.resumeAll()}})();(function(){horde.Size=function(f,c){this.width=Number(f)||0;this.height=Number(c)||0}})();(function(){horde.Vector2=function(a,b){this.x=Number(a)||0;this.y=Number(b)||0};var f=horde.Vector2,c=f.prototype;f.fromSize=function(a){return new horde.Vector2(a.width,a.height)};f.fromHeading=function(a,b){b=Number(b)||1;return new horde.Vector2(Math.sin(a)*b,-Math.cos(a)*b)};c.clone=function(){return new horde.Vector2(this.x,this.y)};c.scale=function(a){this.x*=a;this.y*=a;return this};c.add=function(a){this.x+=a.x;this.y+=a.y;return this};c.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};
c.zero=function(){this.y=this.x=0;return this};c.invert=function(){this.x*=-1;this.y*=-1;return this};c.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.normalize=function(){return this.scale(1/this.magnitude())};c.toString=function(){return this.x+", "+this.y};c.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};c.abs=function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y);return this};c.angle=function(){return this.heading()*(180/Math.PI)};
c.heading=function(){return Math.atan2(this.x,-this.y)}})();(function(){horde.Rect=function(a,b,d,g){this.left=Number(a)||0;this.top=Number(b)||0;this.width=Number(d)||0;this.height=Number(g)||0};var f=horde.Rect,c=f.prototype;f.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};c.center=function(){var a=new horde.Vector2(this.width,this.height);return(new horde.Vector2(this.left,this.top)).add(a.scale(0.5))};c.intersects=function(a){return f.intersects(this,a)};c.reduce=function(a){this.left+=
a;this.top+=a;this.width-=a*2;this.height-=a*2;return this}})();(function(){horde.Keyboard=function(){this.history=[];this.keyStates={};this.lastKeyStates={};horde.on("keydown",this.handleKeyDown,window,this);horde.on("keyup",this.handleKeyUp,window,this)};var f=horde.Keyboard,c=f.prototype;f.Keys={ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,D:68,M:77,P:80,S:83,W:87,X:88,Z:90};f.konamiCode=[f.Keys.UP,f.Keys.UP,f.Keys.DOWN,f.Keys.DOWN,f.Keys.LEFT,f.Keys.RIGHT,f.Keys.LEFT,f.Keys.RIGHT,f.Keys.B,f.Keys.A];c.supressKeys=function(a){switch(a.keyCode){case f.Keys.ENTER:case f.Keys.LEFT:case f.Keys.UP:case f.Keys.RIGHT:case f.Keys.DOWN:case f.Keys.B:case f.Keys.A:case f.Keys.M:case f.Keys.Z:case f.Keys.X:case f.Keys.P:case f.Keys.SPACE:case f.Keys.W:case f.Keys.S:case f.Keys.D:horde.stopEvent(a);
break}};c.handleKeyDown=function(a){this.history.push(a.keyCode);this.keyStates[a.keyCode]=true;this.supressKeys(a)};c.handleKeyUp=function(a){this.keyStates[a.keyCode]=false;this.supressKeys(a)};c.isKeyDown=function(a){return this.keyStates[a]===true};c.isKeyPressed=function(a){return this.isKeyDown(a)&&this.lastKeyStates[a]!==true};c.clearKey=function(a){this.keyStates[a]=false};c.historyMatch=function(a){var b=a.length,d=this.history.slice(-b);if(d.length!==b)return false;for(var g=0;g<b;g++)if(a[g]!==
d[g])return false;return true};c.storeKeyStates=function(){for(var a in this.keyStates)this.lastKeyStates[a]=this.keyStates[a]}})();(function(){horde.Mouse=function(){this.buttonStates={};this.mouseY=this.mouseX=0;horde.on("mousemove",this.handleMouseMove,window,this);horde.on("mousedown",this.handleMouseDown,window,this);horde.on("mouseup",this.handleMouseUp,window,this)};var f=horde.Mouse,c=f.prototype;f.Buttons={LEFT:0,RIGHT:2};c.handleMouseMove=function(a){this.mouseX=a.clientX;this.mouseY=a.clientY};c.handleMouseDown=function(a){this.buttonStates[a.button]=true;horde.stopEvent(a)};c.handleMouseUp=function(a){this.buttonStates[a.button]=
false};c.isButtonDown=function(a){return this.buttonStates[a]}})();(function(){var f=typeof Titanium!="undefined";horde.Engine=function(){this.lastUpdate=0;this.canvases={};this.map=null;this.spawnPoints=[];this.objects={};this.objectIdSeed=0;this.playerObjectId=null;this.keyboard=new horde.Keyboard;this.mouse=new horde.Mouse;this.view=new horde.Size(640,480);this.images=null;this.konamiEntered=this.debug=false;this.gateDirection="";this.gateState="down";this.titlePointerY=this.gatesY=this.gatesX=0;this.numTitleOptions=4;this.targetReticle={angle:0,rotateSpeed:1,
position:new horde.Vector2};this.enableClouds=true;this.cloudTimer=null};var c=horde.Engine.prototype;c.run=function(){this.init();this.lastUpdate=horde.now();this.interval=horde.setInterval(0,this.update,this)};c.stop=function(){window.clearInterval(this.interval)};c.togglePause=function(){var a=false;return function(){if(this.paused){this.paused=false;horde.sound.setMuted(a)}else{this.paused=true;a=horde.sound.isMuted();horde.sound.setMuted(true)}}}();c.addObject=function(a){this.objectIdSeed++;
var b="o"+this.objectIdSeed;a.id=b;this.objects[b]=a;return b};c.getBarColor=function(a,b){var d=b/a*100;return d>50?"rgb(98, 187, 70)":d>25?"rgb(246, 139, 31)":"rgb(238, 28, 36)"};c.spawnObject=function(a,b,d){d=d||a.facing;b=horde.makeObject(b,true);b.ownerId=a.id;b.team=a.team;b.centerOn(a.boundingBox().center());b.setDirection(d);b.init();this.addObject(b)};c.getPlayerObject=function(){return this.objects[this.playerObjectId]};c.preloadComplete=function(){this.state="intro";this.logoAlpha=0;this.logoFade=
"in";this.logoFadeSpeed=0.5};c.init=function(){this.state="intro";this.canvases.display=horde.makeCanvas("display",this.view.width,this.view.height);this.canvases.buffer=horde.makeCanvas("buffer",this.view.width,this.view.height,true);horde.on("blur",function(){if(this.state=="running"){this.keyboard.keyStates={};this.paused||this.togglePause()}},window,this);this.preloader=new horde.ImageLoader;this.preloader.load({logo:"img/ldg.png"},this.preloadComplete,this);this.images=new horde.ImageLoader;
this.images.load({title_screen:"img/title_screen.png",how_to_play:"img/how_to_play.png",credits:"img/credits.png",arena_floor:"img/arena_floor.png",arena_walls:"img/arena_walls.png",shadow:"img/arena_shadow.png",characters:"img/sheet_characters.png",objects:"img/sheet_objects.png"},this.handleImagesLoaded,this);this.initSound()};c.initSound=function(){horde.sound.init(function(){var a=horde.sound;a.create("normal_battle_music","sound/music/normal_battle",true,20);a.create("final_battle_music","sound/music/final_battle",
true,20);a.create("move_pointer","sound/effects/chest_damage");a.create("eat_food","sound/effects/chest_food");a.create("coins","sound/effects/chest_gold");a.create("chest_opens","sound/effects/chest_opens");a.create("chest_weapon","sound/effects/chest_weapon");a.create("gate_opens","sound/effects/gate_opens");a.create("gate_closes","sound/effects/gate_closes");a.create("hero_attacks","sound/effects/char_attacks");a.create("hero_damage","sound/effects/char_damage_3");a.create("hero_dies","sound/effects/char_dies");
a.create("fire_attack","sound/effects/char_attacks_fire");a.create("bat_damage","sound/effects/bat_damage");a.create("bat_dies","sound/effects/bat_dies");a.create("goblin_attacks","sound/effects/goblin_attacks");a.create("goblin_damage","sound/effects/goblin_damage");a.create("goblin_dies","sound/effects/goblin_dies");a.create("cyclops_attacks","sound/effects/cyclops_attacks");a.create("cyclops_damage","sound/effects/cyclops_damage");a.create("cyclops_dies","sound/effects/cyclops_dies");a.create("dragon_attacks",
"sound/effects/dragon_attacks");a.create("dragon_damage","sound/effects/dragon_damage");a.create("dragon_dies","sound/effects/dragon_dies")})};c.initTraps=function(){for(var a=[{x:32,y:64},{x:32,y:352},{x:576,y:64},{x:576,y:352}],b=a.length,d=0;d<b;d++){var g=a[d],h=horde.makeObject("spike_sentry");h.position=new horde.Vector2(g.x,g.y);this.addObject(h)}};c.initGame=function(){this.konamiEntered=false;this.closeGates();this.objects={};this.state="title";this.initMap();this.initSpawnPoints();this.initWaves();
this.initPlayer();this.initTraps();var a=this.getPlayerObject(),b=horde.makeObject("item_weapon");b.position=a.position.clone();b.position.x-=128;this.addObject(b);b=horde.makeObject("item_weapon");b.position=a.position.clone();b.position.x+=128;this.addObject(b);this.gameOverBg=null;this.monstersAlive=0};c.initMap=function(){this.tileSize=new horde.Size(32,32);this.map=[[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]};
c.initSpawnPoints=function(){this.spawnPoints=[];this.spawnPoints.push(new horde.SpawnPoint(3*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2));this.spawnPoints.push(new horde.SpawnPoint(9*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2));this.spawnPoints.push(new horde.SpawnPoint(15*this.tileSize.width,-2*this.tileSize.height,this.tileSize.width*2,this.tileSize.height*2))};c.initSpawnWave=function(a){var b=0;for(var d in a.points){var g=
a.points[d],h=this.spawnPoints[g.spawnPointId];h.delay=g.delay;h.lastSpawnElapsed=h.delay;for(var j in g.objects){var i=g.objects[j];h.queueSpawn(i.type,i.count*this.waveModifier)}g=(h.queue.length-1)*h.delay;if(g>b)b=g}this.waveTimer.start((b+a.nextWaveTime)*this.waveModifier);this.openGates()};c.initWaves=function(){this.waves=[];this.waveTimer=new horde.Timer;this.waveTimer.start(1);this.currentWaveId=-1;this.waveModifier=1;var a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);
a.addSpawnPoint(2,1E3);a.addObjects(0,"flaming_skull",1);a.addObjects(1,"wizard",1);a.addObjects(2,"flaming_skull",1);a.nextWaveTime=6E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1E3);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"goblin",2);a.addObjects(1,"bat",3);a.addObjects(2,"goblin",2);this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,500);a.addSpawnPoint(2,500);a.addObjects(0,"bat",5);a.addObjects(1,"dire_bat",5);a.addObjects(2,
"bat",5);this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,6E3);a.addSpawnPoint(2,1E3);a.addObjects(0,"goblin",3);a.addObjects(1,"cyclops",1);a.addObjects(2,"goblin",3);this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,200);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,200);a.addObjects(0,"demoblin",3);a.addObjects(1,"demoblin",3);a.addObjects(2,"demoblin",3);a.nextWaveTime=6E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,500);a.addSpawnPoint(1,6E3);
a.addSpawnPoint(2,500);a.addObjects(0,"goblin",5);a.addObjects(1,"superclops",1);a.addObjects(2,"goblin",5);a.nextWaveTime=12E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,750);a.addSpawnPoint(1,750);a.addSpawnPoint(2,750);a.addObjects(0,"imp",3);a.addObjects(1,"imp",3);a.addObjects(2,"imp",3);a.nextWaveTime=6E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,1500);a.addSpawnPoint(1,1E3);a.addSpawnPoint(2,1500);a.addObjects(0,"wizard",2);a.addObjects(1,"wizard",1);a.addObjects(2,
"wizard",2);a.nextWaveTime=6E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,300);a.addSpawnPoint(1,300);a.addSpawnPoint(2,300);a.addObjects(0,"dire_bat",7);a.addObjects(1,"bat",7);a.addObjects(2,"dire_bat",7);a.nextWaveTime=12E4;this.waves.push(a);a=new horde.SpawnWave;a.addSpawnPoint(0,50);a.addSpawnPoint(1,12E3);a.addSpawnPoint(2,50);a.addObjects(0,"dire_bat",3);a.addObjects(1,"dragon",1);a.addObjects(2,"dire_bat",3);a.nextWaveTime=3E5;this.waves.push(a)};c.initPlayer=function(){var a=
horde.makeObject("hero");a.weapons=[{type:"h_sword",count:null}];a.centerOn(horde.Vector2.fromSize(this.view).scale(0.5));this.playerObjectId=this.addObject(a)};horde.Engine.prototype.handleImagesLoaded=function(){this.imagesLoaded=true};c.logoFadeOut=function(){this.logoFade="out"};c.updateLogo=function(a){var b=this.keyboard,d=horde.Keyboard.Keys;if(b.isKeyDown(d.ENTER)||b.isKeyDown(d.SPACE)){b.clearKey(d.ENTER);b.clearKey(d.SPACE);this.initGame()}if(this.logoFade==="in"){this.logoAlpha+=this.logoFadeSpeed/
1E3*a;if(this.logoAlpha>=1){this.logoAlpha=1;this.logoFade="none";horde.setTimeout(1E3,this.logoFadeOut,this)}}else if(this.logoFade==="out"){this.logoAlpha-=this.logoFadeSpeed/1E3*a;if(this.logoAlpha<=0){this.logoAlpha=0;this.logoFade="none";this.initGame()}}};horde.Engine.prototype.update=function(){var a=horde.now(),b=a-this.lastUpdate;this.lastUpdate=a;this.lastElapsed=b;if(this.imagesLoaded===true)switch(this.state){case "loading":this.render();break;case "intro":this.updateLogo(b);this.render();
break;case "title":this.handleInput();this.updateFauxGates(b);this.render();break;case "how_to_play":this.handleInput();this.render();break;case "credits":this.handleInput();this.render();break;case "running":this.handleInput();if(!this.paused){this.updateWaves(b);this.updateSpawnPoints(b);this.updateClouds(b);this.updateObjects(b);this.updateFauxGates(b)}this.render();break;case "game_over":this.updateGameOver(b);this.render();break}};c.updateClouds=function(){if(this.enableClouds===true){if(this.cloudTimer===
null){this.cloudTimer=new horde.Timer;this.cloudTimer.start(2E3)}var a=0;for(var b in this.objects){var d=this.objects[b];if(d.type==="cloud"){a++;d.position.x<-d.size.width&&d.die()}}if(a<10&&this.cloudTimer.expired()){if(horde.randomRange(1,10)>=1){a=horde.randomRange(1,3);for(b=0;b<a;b++){d=horde.makeObject("cloud");d.position.x=640+horde.randomRange(1,32);d.position.y=horde.randomRange(-(d.size.height/2),480+d.size.height/2);d.setDirection(new horde.Vector2(-1,0));this.addObject(d)}}this.cloudTimer.reset()}}};
c.updateSpawnPoints=function(a){if(this.gateState==="up"){var b=true;for(var d in this.spawnPoints){if(this.spawnPoints[d].queue.length>=1)b=false;var g=this.spawnPoints[d].update(a);g!==false&&this.addObject(g)}b&&!this.monstersAboveGates&&this.closeGates()}};c.updateWaves=function(){var a=true;for(var b in this.spawnPoints)if(this.spawnPoints[b].queue.length>0)a=false;if(this.waveTimer.expired()||a===true&&this.monstersAlive===0){this.currentWaveId++;if(this.currentWaveId>=this.waves.length){this.currentWaveId=
0;this.waveModifier+=0.5;horde.sound.stop("normal_battle_music");horde.sound.stop("final_battle_music");horde.sound.play("normal_battle_music")}if(this.currentWaveId===this.waves.length-1){horde.sound.stop("normal_battle_music");horde.sound.stop("final_battle_music");horde.sound.play("final_battle_music")}this.initSpawnWave(this.waves[this.currentWaveId])}};c.updateGameOver=function(a){if(!this.gameOverAlpha){this.gameOverReady=false;this.gameOverAlpha=0}this.gameOverAlpha+=Number(2.0E-4*a)||0;if(this.gameOverAlpha>=
0.75){this.gameOverReady=true;this.gameOverAlpha=0.75}};c.openGates=function(){if(this.gateState!=="up"){this.gateDirection="up";horde.sound.play("gate_opens")}};c.closeGates=function(){if(this.gateState!=="down"){this.gateDirection="down";horde.sound.play("gate_closes")}};c.updateFauxGates=function(a){if(this.gateDirection==="down"){this.gatesX=0;this.gatesY+=0.2*a;if(this.gatesY>=0){this.gatesY=this.gatesX=0;this.gateDirection="";this.gateState="down"}}if(this.gateDirection==="up"){this.gatesX=
horde.randomRange(-1,1);this.gatesY-=0.05*a;if(this.gatesY<=-54){this.gatesX=0;this.gatesY=-54;this.gateDirection="";this.gateState="up"}}};c.getTilesByRect=function(a){var b=[],d=new horde.Vector2(a.left,a.top),g=new horde.Vector2(a.width,a.height);a=d.clone().scale(1/this.tileSize.width).floor();d=d.clone().add(g).scale(1/this.tileSize.width).floor();for(g=a.x;g<=d.x;g++)for(var h=a.y;h<=d.y;h++)b.push({x:g,y:h});return b};c.checkTileCollision=function(a){a=this.getTilesByRect(a.boundingBox());
for(var b=0,d=a.length;b<d;b++){var g=a[b];if(this.map[g.y]&&this.map[g.y][g.x]===0)return g}return false};c.moveObject=function(a,b){if(a.hasState(horde.Object.states.HURTING))return false;var d=a.speed/1E3*b,g=[];if(a.direction.x!==0){a.position.x+=a.direction.x*d;if(a.collidable){var h=this.checkTileCollision(a);if(h!==false){g.push("x");a.position.x=a.direction.x>0?h.x*this.tileSize.width-a.size.width:h.x*this.tileSize.width+this.tileSize.width}}}if(a.direction.y!==0){a.position.y+=a.direction.y*
d;if(a.collidable){h=this.checkTileCollision(a);if(h!==false){g.push("y");a.position.y=a.direction.y>0?h.y*this.tileSize.height-a.size.height:h.y*this.tileSize.height+this.tileSize.height}}}if(a.collidable){d=this.gateState==="down"||a.role==="monster"?64:0;if(a.direction.y<0&&a.position.y<d){a.position.y=d;g.push("y")}g.length>0&&a.wallCollide(g)}};c.spawnLoot=function(a){if(horde.randomRange(1,10)>6){var b="item_coin";switch(horde.randomRange(1,4)){case 3:if(this.getPlayerObject().wounds)b="item_food";
break;case 4:b="item_weapon";break}b=horde.makeObject(b);b.position=a.clone();b.position.y-=1;this.addObject(b)}};horde.Engine.prototype.updateObjects=function(a){var b=this.targetReticle;b.angle+=b.rotateSpeed/1E3*a;if(b.angle>360)b.angle=0;var d=b=0;for(var g in this.objects){var h=this.objects[g];if(h.isDead()){if(h.role==="hero"){this.gameOverReady=false;this.gameOverAlpha=0;this.updateGameOver();this.state="game_over";return}delete this.objects[h.id]}else{if(h.role==="monster"){b++;h.position.y<=
64&&d++}switch(h.update(a,this)){case "shoot":this.objectAttack(h);break}h.isMoving()&&this.moveObject(h,a);if(!(h.role==="fluff"||h.role==="powerup_food"||h.hasState(horde.Object.states.DYING)||h.hasState(horde.Object.states.INVISIBLE)))for(var j in this.objects){var i=this.objects[j];if(!(i.isDead()||i.team===h.team||i.role==="fluff"||i.hasState(horde.Object.states.DYING)||i.hasState(horde.Object.states.INVISIBLE)))if(h.boundingBox().reduce(5).intersects(i.boundingBox().reduce(5))){if(h.role=="hero")if(i.role==
"powerup_food"){i.die();h.wounds-=i.healAmount;if(h.wounds<0)h.wounds=0;horde.sound.play("eat_food")}else if(i.role=="powerup_coin"){i.die();h.gold+=i.coinAmount;horde.sound.play("coins")}else if(i.role=="powerup_weapon"){i.die();h.addWeapon(i.wepType,i.wepCount);horde.sound.play("chest_weapon")}if(h.team!==null&&i.team!==null&&h.team!==i.team){this.dealDamage(i,h);this.dealDamage(h,i)}}}}}this.monstersAlive=b;this.monstersAboveGates=d>0};horde.Engine.prototype.dealDamage=function(a,b){if(b.hasState(horde.Object.states.INVINCIBLE)||
b.role==="trap")return false;b.role==="hero"&&b.addState(horde.Object.states.INVINCIBLE,2500);a.execute("onDamage",[b,this]);if(b.wound(a.damage)){if(a.ownerId===null)a.gold+=b.worth;else{var d=this.objects[a.ownerId];if(d)d.gold+=b.worth}b.execute("onKilled",[a,this]);b.role==="monster"&&this.spawnLoot(b.position.clone())}};c.updateTargetReticle=function(){var a=new horde.Vector2(this.mouse.mouseX,this.mouse.mouseY),b=new horde.Rect(32,64,576,320),d=this.targetReticle.position;d.x=a.x<b.left?b.left:
a.x>b.left+b.width?b.left+b.width:a.x;d.y=a.y<b.top?b.top:a.y>b.top+b.height?b.top+b.height:a.y};c.handleInput=function(){var a=this.keyboard,b=horde.Keyboard.Keys,d=horde.Mouse.Buttons;new horde.Vector2(this.mouse.mouseX,this.mouse.mouseY);if(this.state=="running"){this.keyboard.isKeyPressed(80)&&this.togglePause();this.keyboard.isKeyPressed(77)&&horde.sound.toggleMuted()}if(this.state==="title"){if(!this.konamiEntered&&this.keyboard.historyMatch(horde.Keyboard.konamiCode)){horde.sound.play("chest_opens");
this.konamiEntered=true;this.getPlayerObject().addWeapon("h_axe",null)}if(a.isKeyPressed(b.ENTER)||a.isKeyPressed(b.SPACE)){a.clearKey(b.ENTER);a.clearKey(b.SPACE);switch(this.titlePointerY){case 0:horde.sound.play("normal_battle_music");this.state="running";break;case 1:this.state="how_to_play";break;case 2:this.state="credits";break;case 3:f&&Titanium.App.exit();break}}if(this.keyboard.isKeyPressed(b.W)||this.keyboard.isKeyPressed(b.UP)){this.keyboard.keyStates[b.W]=false;this.keyboard.keyStates[b.UP]=
false;this.titlePointerY--;if(this.titlePointerY<0)this.titlePointerY=this.numTitleOptions;horde.sound.play("move_pointer")}if(this.keyboard.isKeyPressed(b.S)||this.keyboard.isKeyPressed(b.DOWN)){this.keyboard.keyStates[b.S]=false;this.keyboard.keyStates[b.DOWN]=false;this.titlePointerY++;if(this.titlePointerY>this.numTitleOptions)this.titlePointerY=0;horde.sound.play("move_pointer")}this.keyboard.storeKeyStates()}else{if(this.state==="how_to_play")if(a.isKeyPressed(b.ENTER)||a.isKeyPressed(b.SPACE)){a.clearKey(b.ENTER);
a.clearKey(b.SPACE);this.state="title"}if(this.state==="credits")if(a.isKeyPressed(b.ENTER)||a.isKeyPressed(b.SPACE)){a.clearKey(b.ENTER);a.clearKey(b.SPACE);this.state="title"}if(this.state==="running"){a=this.getPlayerObject();if(!(this.paused||a.hasState(horde.Object.states.DYING))){this.updateTargetReticle();var g=new horde.Vector2;if(this.keyboard.isKeyDown(b.W)||this.keyboard.isKeyDown(b.UP))g.y=-1;if(this.keyboard.isKeyDown(b.A)||this.keyboard.isKeyDown(b.LEFT))g.x=-1;if(this.keyboard.isKeyDown(b.S)||
this.keyboard.isKeyDown(b.DOWN))g.y=1;if(this.keyboard.isKeyDown(b.D)||this.keyboard.isKeyDown(b.RIGHT))g.x=1;a.stopMoving();if(g.x!==0||g.y!==0)a.setDirection(g);if(this.mouse.isButtonDown(d.LEFT)){d=this.targetReticle.position.clone().subtract(a.position).normalize();this.objectAttack(a,d)}this.keyboard.isKeyDown(b.SPACE)&&this.objectAttack(a);this.keyboard.isKeyPressed(90)&&a.cycleWeapon();this.keyboard.isKeyPressed(88)&&a.cycleWeapon(true)}this.keyboard.storeKeyStates()}}};c.objectAttack=function(a,
b){var d=a.fireWeapon();if(d!==false){var g=horde.objectTypes[d];switch(d){case "h_knife":var h=b.heading();this.spawnObject(a,d,horde.Vector2.fromHeading(h-0.1));this.spawnObject(a,d,horde.Vector2.fromHeading(h+0.1));break;default:this.spawnObject(a,d,b);break}d=null;if(g.soundAttacks)d=g.soundAttacks;else if(a.soundAttacks)d=a.soundAttacks;d!==null&&horde.sound.play(d)}};c.render=function(){var a=this.canvases.display.getContext("2d");switch(this.state){case "loading":a.save();a.fillStyle="rgb(255, 0, 0)";
a.fillRect(0,0,this.view.width,this.view.height);a.restore();break;case "intro":this.drawLogo(a);break;case "title":this.drawTitle(a);break;case "how_to_play":this.drawTitle(a);this.drawHowToPlay(a);break;case "credits":this.drawTitle(a);this.drawCredits(a);break;case "running":this.drawFloor(a);this.drawTargetReticle(a);this.drawWalls(a);this.drawObjects(a);this.drawFauxGates(a);this.drawShadow(a);this.drawUI(a);this.paused&&this.drawPaused(a);break;case "game_over":this.drawGameOver(a);break}this.debug===
true&&this.drawDebugInfo(a)};c.drawGameOver=function(a){if(this.goAlphaStep){this.goAlpha+=this.goAlphaStep;if(this.goAlpha<=0){this.goAlpha=0;this.goAlphaStep=0.025}if(this.goAlpha>=1){this.goAlpha=1;this.goAlphaStep=-0.025}}else{this.goAlphaStep=-0.025;this.goAlpha=1}if(!this.gameOverBg){this.drawUI(a);this.gameOverBg=a.getImageData(0,0,this.view.width,this.view.height)}a.save();a.fillStyle="rgb(0, 0, 255)";a.fillRect(0,0,this.view.width,this.view.height);a.putImageData(this.gameOverBg,0,0);a.restore();
a.save();a.globalAlpha=this.gameOverAlpha;a.fillStyle="rgb(200, 0, 0)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();if(this.gameOverReady===true)if(this.keyboard.isKeyDown(horde.Keyboard.Keys.SPACE)){this.keyboard.clearKey(horde.Keyboard.Keys.SPACE);this.initGame()}else{var b=this.getPlayerObject();a.save();a.fillStyle="rgb(255, 255, 255)";a.font="Bold 35px Monospace";a.globalAlpha=1;a.textAlign="center";a.fillText("Game Over",320,200);a.drawImage(this.images.getImage("objects"),64,
32,32,32,260,224,32,32);a.textAlign="left";a.fillText(b.gold,300,250);a.textAlign="center";a.globalAlpha=this.goAlpha;a.fillText("Press space to continue",320,300);a.restore()}};c.drawLogo=function(a){a.save();a.fillStyle="rgb(0, 0, 0)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();a.save();a.globalAlpha=this.logoAlpha;a.drawImage(this.preloader.getImage("logo"),0,0);a.restore()};c.drawFloor=function(a){a.drawImage(this.images.getImage("arena_floor"),0,0,576,386,32,0,576,386)};c.drawWalls=
function(a){a.drawImage(this.images.getImage("arena_walls"),0,0,640,480,0,0,this.view.width,this.view.height)};c.drawArena=function(a){this.drawFloor(a);this.drawWalls(a)};c.drawShadow=function(a){a.drawImage(this.images.getImage("shadow"),0,0,576,386,32,0,576,386)};c.drawPaused=function(a){a.save();a.fillStyle="rgb(0, 0, 0)";a.globalAlpha=0.75;a.fillRect(50,50,540,380);a.restore();a.save();a.textAlign="left";a.fillStyle="rgb(255, 255, 255)";a.font="Bold 32px Monospace";this.centerText(a,"Paused",
210);a.font="20px Monospace";this.centerText(a,'Press "P" to resume.',240);a.restore()};c.centerText=function(a,b,d){var g=a.measureText(b).width;a.fillText(b,320-g/2,d)};c.getObjectDrawOrder=function(){var a=[];for(var b in this.objects){var d=this.objects[b];a.push({id:d.id,y:d.position.y+d.size.height})}a.sort(function(g,h){return g.y-h.y});return a};horde.Engine.prototype.drawObjects=function(a){var b=this.getObjectDrawOrder();for(var d in b){var g=this.objects[b[d].id],h=g.getSpriteXY();if(!(g.alpha<=
0||g.hasState(horde.Object.states.INVISIBLE))){a.save();a.translate(g.position.x+g.size.width/2,g.position.y+g.size.height/2);g.angle!==0&&a.rotate(g.angle*Math.PI/180);if(g.alpha!==1)a.globalAlpha=g.alpha;if(g.role==="powerup_weapon"){a.fillStyle="rgb(255, 0, 255)";a.drawImage(this.images.getImage("objects"),128,192,48,48,-22,-20,48,48)}a.drawImage(this.images.getImage(g.spriteSheet),h.x,h.y+1,g.size.width-1,g.size.height-1,-(g.size.width/2),-(g.size.height/2),g.size.width,g.size.height);if(this.debug&&
g.role==="monster"||g.badass&&!g.hasState(horde.Object.states.DYING)){h=g.size.width-2;h=h-Math.round(h*g.wounds/g.hitPoints);a.fillStyle="rgb(255, 255, 255)";a.fillRect(-(g.size.width/2),g.size.height/2,g.size.width,8);a.fillStyle="rgb(0, 0, 0)";a.fillRect(-(g.size.width/2)+1,g.size.height/2+1,g.size.width-2,6);a.fillStyle=this.getBarColor(g.hitPoints,g.hitPoints-g.wounds);a.fillRect(-(g.size.width/2)+1,g.size.height/2+1,h,6)}a.restore()}}};c.drawTargetReticle=function(a){a.save();a.globalAlpha=
0.5;a.translate(this.targetReticle.position.x,this.targetReticle.position.y);a.rotate(this.targetReticle.angle);a.drawImage(this.images.getImage("objects"),256,192,64,64,-32,-32,64,64);a.restore()};c.drawUI=function(a){var b={width:320,height:24,x:50,y:432},d=this.getPlayerObject(),g=d.getWeaponInfo(),h=horde.objectTypes[g.type];g=g.count===null?"\u221e":g.count;var j=b.width-Math.round(b.width*d.wounds/d.hitPoints);a.save();a.fillStyle="rgb(255, 255, 255)";a.fillRect(b.x-2,b.y-2,b.width+2,b.height+
4);a.fillRect(b.x+b.width,b.y,2,b.height);a.fillStyle="rgb(0, 0, 0)";a.fillRect(b.x,b.y,b.width,b.height);a.fillStyle=this.getBarColor(d.hitPoints,d.hitPoints-d.wounds);a.globalAlpha=0.6;a.fillRect(b.x,b.y,j,b.height);a.fillRect(b.x,b.y+5,j,b.height-10);a.fillRect(b.x,b.y+10,j,b.height-20);a.restore();b=(d.hitPoints-d.wounds)/d.hitPoints*100;j=352;if(b>50)j=224;else if(b>25)j=288;a.drawImage(this.images.getImage("objects"),j,64,42,42,18,424,42,42);a.drawImage(this.images.getImage("objects"),64,32,
32,32,603,443,32,32);a.drawImage(this.images.getImage("objects"),h.spriteX,h.spriteY,32,32,603,412,32,32);a.save();a.textAlign="right";a.fillStyle="rgb(255, 255, 255)";a.font="Bold 32px Monospace";a.fillText(d.gold,603,469);a.fillText(g,603,439);a.restore()};c.drawText=function(a,b,d,g,h){var j=this.canvases.buffer.getContext("2d");j.save();j.clearRect(0,0,640,480);for(var i in h)j[i]=h[i];j.fillText(b,0,20);j.restore();a.drawImage(this.canvases.buffer,0,0,640,480,d,g-20,1280,960)};c.drawTitle=function(a){a.drawImage(this.images.getImage("title_screen"),
0,0);if(this.titleAlphaStep){this.titleAlpha+=this.titleAlphaStep;if(this.titleAlpha<=0.5){this.titleAlpha=0.5;this.titleAlphaStep=0.025}if(this.titleAlpha>=1){this.titleAlpha=1;this.titleAlphaStep=-0.025}}else{this.titleAlphaStep=-0.025;this.titleAlpha=1}this.drawText(a,"v0.3 \u00a9 Lost Decade Games",172,438,{fillStyle:"rgb(0, 0, 0)",font:"Bold 10px Monospace"});this.drawText(a,"v0.3 \u00a9 Lost Decade Games",174,440,{fillStyle:"rgb(255, 255, 255)",font:"Bold 10px Monospace"});var b={fillStyle:"rgb(0, 0, 0)",
font:"Bold 10px Monospace",textAlign:"left"};a.save();this.drawText(a,"Play!",270,220,b);this.drawText(a,"Controls",270,244,b);this.drawText(a,"How to play",270,268,b);this.drawText(a,"Credits",270,292,b);f?this.drawText(a,"Buy full version",270,316,b):this.drawText(a,"Exit",270,316,b);a.restore();a.save();a.globalAlpha=this.titleAlpha;a.drawImage(this.images.getImage("objects"),320,192,36,26,222,240+this.titlePointerY*24-20,36,26);a.restore()};c.drawHowToPlay=function(a){a.save();a.globalAlpha=0.5;
a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.images.getImage("how_to_play"),38,38,564,404);a.restore()};c.drawCredits=function(a){a.save();a.globalAlpha=0.5;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.images.getImage("credits"),38,38,564,404);a.restore()};c.drawFauxGates=function(a){for(var b=0;b<3;b++)a.drawImage(this.images.getImage("objects"),0,192,64,64,this.gatesX+96+b*192,this.gatesY,64,64)};c.drawDebugInfo=function(a){a.save();
a.fillStyle="rgba(0, 0, 0, 0.3)";a.fillRect(0,0,this.view.width,30);a.restore();a.save();a.fillStyle="rgb(255, 255, 255)";a.font="bold 20px Monospace";a.fillText("Elapsed: "+this.lastElapsed,10,20);a.restore()}})();(function(){horde.Object=function(){this.id="";this.ownerId=null;this.position=new horde.Vector2;this.size=new horde.Size(32,32);this.direction=new horde.Vector2;this.facing=new horde.Vector2(0,1);this.speed=100;this.team=null;this.hitPoints=1;this.wounds=0;this.damage=1;this.spriteSheet="";this.spriteY=this.spriteX=0;this.animated=this.spriteAlign=false;this.animFrameIndex=0;this.animDelay=200;this.angle=this.animElapsed=0;this.rotateSpeed=400;this.rotate=false;this.ttlElapsed=this.ttl=this.gold=
this.worth=0;this.alphaMod=this.alpha=1;this.gibletSize="small";this.cooldown=false;this.cooldownElapsed=0;this.autoFire=false;this.soundDies=this.soundDamage=this.soundAttacks=null;this.alive=true;this.states=[];this.addState(horde.Object.states.IDLE);this.currentWeaponIndex=0;this.collidable=true};horde.Object.states={IDLE:0,MOVING:1,ATTACKING:2,HURTING:3,DYING:4,INVINCIBLE:5,INVISIBLE:6};var f=horde.Object.prototype;f.updateStates=function(){for(var c in this.states)this.states[c].timer.expired()&&
this.removeStateById(c)};f.hasState=function(c){for(var a in this.states)if(this.states[a].type===c)return true;return false};f.addState=function(c,a){if(this.hasState(c))return false;var b=new horde.Timer;b.start(a);this.states.push({type:c,timer:b})};f.removeStateById=function(c){if(this.states[c].type===horde.Object.states.INVINCIBLE){this.alpha=1;this.alphaMod=-1}delete this.states[c]};f.removeState=function(c){for(var a in this.states)this.states[a].type===c&&this.removeStateById(a)};f.init=
function(){this.execute("onInit");if(this.spriteAlign)this.angle=this.facing.angle();if(this.rotate)this.angle=horde.randomRange(0,359);if(this.animated)this.animElapsed=horde.randomRange(0,this.animDelay)};f.die=function(){this.alive=false};f.isDead=function(){return!this.alive};f.update=function(c){this.updateStates();if(this.hasState(horde.Object.states.DYING))if(this.deathTimer.expired()){this.deathFrameIndex++;this.deathTimer.reset();if(this.deathFrameIndex>2){this.deathFrameIndex=2;this.ttl=
1500}}if(this.animated){this.animElapsed+=c;if(this.animElapsed>=this.animDelay){this.animElapsed=0;this.animFrameIndex++;if(this.animFrameIndex>1)this.animFrameIndex=0}}if(this.hasState(horde.Object.states.INVINCIBLE)){this.alpha+=0.01*c*this.alphaMod;if(this.alpha>=1){this.alpha=1;this.alphaMod=-1}if(this.alpha<=0){this.alpha=0;this.alphaMod=1}}if(this.rotate)this.angle+=this.rotateSpeed/1E3*c;if(this.ttl>0){this.ttlElapsed+=c;if(this.ttl-this.ttlElapsed<=1E3)this.alpha-=0.0010*c;this.ttlElapsed>=
this.ttl&&this.die()}if(this.cooldown===true){this.cooldownElapsed+=c;var a=this.getWeaponInfo();if(this.cooldownElapsed>=horde.objectTypes[a.type].cooldown){this.cooldown=false;this.cooldownElapsed=0}}if(!this.hasState(horde.Object.states.DYING))return this.execute("onUpdate",arguments)};f.getSpriteXY=function(){if(this.animated){if(this.hasState(horde.Object.states.DYING))return new horde.Vector2((17+this.deathFrameIndex)*this.size.width,this.spriteY);if(this.hasState(horde.Object.states.HURTING)&&
this.size.width<=32)return new horde.Vector2(16*this.size.width,this.spriteY);var c=horde.directions.fromVector(this.facing.clone());return new horde.Vector2((c*2+this.animFrameIndex)*this.size.width,this.spriteY)}else return new horde.Vector2(this.spriteX,this.spriteY)};f.boundingBox=function(){var c=new horde.Rect(this.position.x,this.position.y,this.size.width-1,this.size.height-1);this.role==="projectile"&&c.reduce(1);return c};f.centerOn=function(c){this.position=c.subtract(horde.Vector2.fromSize(this.size).scale(0.5))};
f.wound=function(c){this.wounds+=c;if(this.role==="monster"||this.role==="hero")this.addState(horde.Object.states.HURTING,300);if(this.wounds>=this.hitPoints){this.wounds=this.hitPoints;if(this.role==="monster"||this.role==="hero"){this.addState(horde.Object.states.DYING);this.deathFrameIndex=0;this.deathTimer=new horde.Timer;this.deathTimer.start(200)}else this.die();this.role==="hero"&&horde.sound.stopAll();this.soundDies&&horde.sound.play(this.soundDies);return true}this.soundDamage&&horde.sound.play(this.soundDamage);
return false};f.wallCollide=function(c){switch(this.role){case "projectile":this.die();break;case "monster":var a=this.direction.clone();for(var b in c)a[c[b]]*=-1;this.setDirection(a);break}this.execute("onWallCollide",[c])};f.setDirection=function(c){if(c.x===0&&c.y===0)this.stopMoving();else{this.direction=c;this.facing=this.direction.clone()}};f.chase=function(c){this.setDirection(c.position.clone().subtract(this.position).normalize())};f.isMoving=function(){if(this.hasState(horde.Object.states.DYING))return false;
return this.direction.x!==0||this.direction.y!==0};f.stopMoving=function(){this.direction.zero()};f.execute=function(c,a){if(this[c])return this[c].apply(this,a)};f.getWeaponInfo=function(){var c=this.weapons.length;if(c>=1){if(this.currentWeaponIndex<0)this.currentWeaponIndex=0;if(this.currentWeaponIndex>c-1)this.currentWeaponIndex=c-1;return this.weapons[this.currentWeaponIndex]}return false};f.addWeapon=function(c,a){for(var b in this.weapons){var d=this.weapons[b];if(typeof d!=="undefined"&&d.type===
c){if(d.count!==null)d.count+=a;return true}}this.currentWeaponIndex=this.weapons.push({type:c,count:a})-1};f.cycleWeapon=function(c){var a=this.weapons.length;if(c===true){this.currentWeaponIndex--;if(this.currentWeaponIndex<0)this.currentWeaponIndex=a-1}else{this.currentWeaponIndex++;if(this.currentWeaponIndex>a-1)this.currentWeaponIndex=0}};f.fireWeapon=function(){var c=this.weapons.length;if(this.cooldown===true||c<1)return false;c=this.getWeaponInfo();if(c.count!==null){c.count-=1;c.count<1&&
this.weapons.splice(this.currentWeaponIndex,1)}this.cooldown=true;return c.type}})();(function(){horde.objectTypes={};var f=horde.objectTypes;f.hero={role:"hero",team:0,speed:150,hitPoints:100,damage:0,spriteSheet:"characters",spriteY:0,animated:true,soundAttacks:"hero_attacks",soundDamage:"hero_damage",soundDies:"hero_dies",weapons:[{type:"h_sword",count:null}]};f.h_knife={role:"projectile",cooldown:200,speed:350,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:32,spriteY:0,spriteAlign:true};f.h_sword={role:"projectile",cooldown:300,speed:250,hitPoints:1,damage:15,spriteSheet:"objects",
spriteX:64,spriteY:0,spriteAlign:true};f.h_spear={role:"projectile",cooldown:350,speed:500,hitPoints:1,damage:20,spriteSheet:"objects",spriteX:96,spriteY:0,spriteAlign:true};f.h_fireball={role:"projectile",cooldown:75,speed:400,hitPoints:1,damage:3,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:true,soundAttacks:"fire_attack",ttl:350};f.h_axe={role:"projectile",cooldown:450,speed:350,hitPoints:1,damage:35,spriteSheet:"objects",spriteX:192,spriteY:32,rotate:true};var c={chase:function(a,b){if(this.moveChangeDelay>
0){this.moveChangeElapsed+=a;if(this.moveChangeElapsed<this.moveChangeDelay)return;this.moveChangeElapsed=0}this.chase(b.getPlayerObject());return"shoot"},getNear:function(a,b){this.speed=this.defaultSpeed;var d=b.getPlayerObject(),g=d.position.clone().subtract(this.position).magnitude();if(g<100){this.chase(d);this.setDirection(this.direction.invert())}else if(g>150)this.chase(d);else if(this.cooldown)c.wander.apply(this,arguments);else{this.chase(d);this.speed=0;return"shoot"}},wander:function(a){this.moveChangeElapsed+=
a;if(this.moveChangeElapsed>=this.moveChangeDelay){this.moveChangeElapsed=0;a=horde.randomDirection();a.x===0&&a.y===0||this.setDirection(a)}},wanderShoot:function(a,b){var d=b.getPlayerObject(),g=d.position.clone().subtract(this.position).abs();if(!this.cooldown&&(g.x<d.size.width/2||g.y<d.size.height/2)){this.chase(d);return"shoot"}else c.wander.apply(this,arguments)},wanderThenChase:function(a,b){var d=b.getPlayerObject();d={x:d.position.x,y:d.position.y};var g=this.position.x,h=this.position.y;
if(this.seenHero)c.chase.apply(this,arguments);else{c.wander.apply(this,arguments);g=Math.abs(g-d.x);d=Math.abs(h-d.y);if(g<64&&d<64){horde.sound.play(this.soundAttacks);this.seenHero=true;return"shoot"}}}};f.bat={role:"monster",team:1,speed:100,hitPoints:5,damage:2,worth:10,spriteSheet:"characters",spriteY:96,animated:true,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=
50)this.onUpdate=c.wander}};f.dire_bat={role:"monster",team:1,speed:150,hitPoints:10,damage:5,worth:10,spriteSheet:"characters",spriteY:128,animated:true,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=c.wander}};f.goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:20,spriteSheet:"characters",spriteY:160,animated:true,
gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=c.wanderShoot}};f.demoblin={role:"monster",team:1,speed:100,defaultSpeed:100,hitPoints:20,damage:15,worth:20,spriteSheet:"characters",spriteY:192,animated:true,gibletSize:"medium",moveChangeElapsed:0,
moveChangeDelay:3E3,weapons:[{type:"e_trident",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3);this.cooldown=true;this.cooldownElapsed=horde.randomRange(0,5E3)},onUpdate:function(){if(this.position.y>=50)this.onUpdate=c.getNear}};f.flaming_skull={role:"monster",team:1,speed:200,hitPoints:25,damage:10,worth:100,spriteSheet:"characters",spriteY:32,animated:true,setDir:false,weapons:[{type:"e_static_blue_fire",
count:null}],onUpdate:function(){if(!this.setDir&&this.position.y>=50){var a=this.direction.clone();a.x=Math.random();if(Math.random()>=0.5)a.x*=-1;this.setDirection(a);this.setDir=true}return"shoot"}};f.spike_sentry={role:"trap",team:1,speed:100,hitPoints:9999,damage:10,worth:0,spriteSheet:"objects",spriteX:64,spriteY:256,rotate:true,rotateSpeed:100,phase:0,phaseInit:false,onDamage:function(a){if(a.role==="hero")this.spriteX=160},onUpdate:function(a,b){switch(this.phase){case 0:if(!this.phaseInit){this.stopMoving();
this.phaseInit=true}var d=b.getPlayerObject().position.clone().subtract(this.position);if(Math.abs(d.y)<32){this.originalPos=this.position.clone();var g=new horde.Vector2;g.x=d.x<0?-1:1;this.setDirection(g);this.phase++;this.phaseInit=false}else if(Math.abs(d.x)<32){this.originalPos=this.position.clone();g=new horde.Vector2;g.y=d.y<0?-1:1;this.setDirection(g);this.phase++;this.phaseInit=false}break;case 1:if(!this.phaseInit){this.rotateSpeed=this.speed=300;this.phaseInit=true}d=this.position.clone().subtract(this.originalPos).abs();
if(d.x>256){g=this.direction.clone();g.x*=-1;this.setDirection(g);this.phase++;this.phaseInit=false}else if(d.y>128){g=this.direction.clone();g.y*=-1;this.setDirection(g);this.phase++;this.phaseInit=false}break;case 2:if(!this.phaseInit){this.rotateSpeed=this.speed=100;this.phaseInit=true}d=this.position.clone().subtract(this.originalPos).abs();if(d.x<5&&d.y<5){this.stopMoving();this.position=this.originalPos.clone();this.phase=0;this.phaseInit=false}break}}};f.spikes={role:"trap",team:1,speed:0,
hitPoints:9999,damage:5,worth:0,spriteSheet:"objects",spriteX:0,spriteY:256,gibletSize:"medium",onInit:function(){}};f.cyclops={role:"monster",team:1,badass:true,animated:true,gibletSize:"large",size:new horde.Size(64,64),spriteSheet:"characters",spriteY:224,moveChangeElapsed:0,moveChangeDelay:1E3,damage:25,hitPoints:100,speed:25,worth:100,soundAttacks:"cyclops_attacks",soundDamage:"cyclops_damage",soundDies:"cyclops_dies",weapons:[{type:"e_boulder",count:null}],onInit:function(){this.moveChangeDelay=
horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN))},onUpdate:function(){if(this.position.y>=50)this.onUpdate=c.chase}};f.superclops={role:"monster",team:1,badass:true,animated:true,gibletSize:"large",size:new horde.Size(64,64),spriteSheet:"characters",spriteY:288,moveChangeElapsed:0,moveChangeDelay:1E3,damage:35,hitPoints:200,speed:25,worth:1E3,soundAttacks:"cyclops_attacks",soundDamage:"cyclops_damage",soundDies:"cyclops_dies",weapons:[{type:"e_energy_ball",
count:null}],onInit:function(){this.moveChangeDelay=horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN))},onUpdate:function(){if(this.position.y>=50)this.onUpdate=c.chase}};f.imp={role:"monster",team:1,speed:100,hitPoints:35,damage:15,worth:50,spriteSheet:"characters",spriteY:448,animated:true,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,soundAttacks:"bat_attacks",soundDamage:"bat_damage",soundDies:"bat_dies",phase:0,phaseInit:false,onInit:function(){this.phaseTimer=
new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3)},onKilled:function(a,b){a.role==="projectile"&&a.die();for(var d=0;d<2;d++)b.spawnObject(this,"dire_bat",horde.randomDirection())},onUpdate:function(){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=true;if(this.position.y>=50){this.phase++;this.phaseInit=false}break;case 1:if(!this.phaseInit){this.speed=50;this.animDelay=400;this.phaseTimer.start(2500,7500);this.phaseInit=true}c.wander.apply(this,arguments);if(this.phaseTimer.expired()){this.phase++;
this.phaseInit=false}break;case 2:if(!this.phaseInit){this.animDelay=this.speed=150;this.phaseTimer.start(2500,7500);this.phaseInit=true}c.wander.apply(this.arguments);if(this.phaseTimer.expired()){this.phase=1;this.phaseInit=false}break}}};f.wizard={role:"monster",team:1,speed:100,hitPoints:20,damage:10,worth:50,spriteSheet:"characters",spriteY:416,animated:true,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_shock_wave",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",
soundDies:"goblin_dies",phase:0,phaseInit:false,onInit:function(){this.phaseTimer=new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3);this.moveToY=horde.randomRange(50,75)},onUpdate:function(a,b){switch(this.phase){case 0:if(!this.phaseInit)this.phaseInit=true;if(this.position.y>=this.moveToY){this.phase++;this.phaseInit=false}break;case 1:if(!this.phaseInit){this.animated=false;this.stopMoving();this.addState(horde.Object.states.INVINCIBLE);this.phaseTimer.start(1E3);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;
this.phaseInit=false}break;case 2:if(!this.phaseInit){this.speed=400;this.addState(horde.Object.states.INVISIBLE);this.phaseTimer.start(horde.randomRange(3E3,1E4));this.phaseInit=true}c.wander.apply(this,arguments);if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 3:if(!this.phaseInit){this.stopMoving();this.removeState(horde.Object.states.INVISIBLE);this.phaseTimer.start(1E3);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 4:if(!this.phaseInit){this.speed=
0;this.animated=true;this.removeState(horde.Object.states.INVINCIBLE);this.phaseTimer.start(horde.randomRange(2E3,3E3));this.phaseInit=true;this.shotOnce=false}this.chase(b.getPlayerObject());if(this.phaseTimer.expired()){this.phase=1;this.phaseInit=false}if(!this.shotOnce){this.shotOnce=true;return"shoot"}break}}};f.dragon={role:"monster",team:1,badass:true,animated:true,gibletSize:"large",size:new horde.Size(64,64),spriteSheet:"characters",spriteY:352,moveChangeElapsed:0,moveChangeDelay:0,damage:50,
hitPoints:500,speed:20,worth:9E3,soundAttacks:"dragon_attacks",soundDamage:"dragon_damage",soundDies:"dragon_dies",weapons:[{type:"e_fireball",count:null}],phase:0,phaseInit:false,onInit:function(){this.phaseTimer=new horde.Timer;this.moveChangeDelay=horde.randomRange(500,1E3);this.setDirection(horde.directions.toVector(horde.directions.DOWN))},onUpdate:function(a,b){switch(this.phase){case 0:if(!this.phaseInit){this.speed=200;this.animDelay=50;this.phaseInit=true}if(this.position.y>=50){this.phase++;
this.phaseInit=false}break;case 1:if(!this.phaseInit){this.speed=20;this.animDelay=200;this.weapons=[{type:"e_fireball",count:null}];this.phaseTimer.start(1E4);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}return c.chase.apply(this,arguments);case 2:if(!this.phaseInit){this.speed=0;this.animDelay=100;this.phaseTimer.start(2E3);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}this.position.x+=horde.randomRange(-1,1);break;case 3:if(!this.phaseInit){this.speed=
350;this.animDelay=100;this.phaseTimer.start(500);this.phaseInit=true;var d=b.getPlayerObject();this.chase(d)}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}break;case 4:if(!this.phaseInit){this.speed=0;this.animDelay=400;this.weapons=[{type:"e_fireball_2",count:null}];this.cooldown=false;this.cooldownElapsed=0;this.phaseTimer.start(1E4);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase++;this.phaseInit=false}d=b.getPlayerObject();this.chase(d);return"shoot";case 5:if(!this.phaseInit){this.speed=
10;this.animDelay=400;this.phaseTimer.start(3E3);this.phaseInit=true}if(this.phaseTimer.expired()){this.phase=1;this.phaseInit=false}c.wander.apply(this,arguments);break}}};f.e_arrow={role:"projectile",cooldown:3E3,speed:200,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:256,spriteY:0,spriteAlign:true};f.e_trident={role:"projectile",cooldown:5E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:288,spriteY:0,spriteAlign:true};f.e_boulder={role:"projectile",cooldown:1500,speed:150,
hitPoints:25,damage:20,spriteSheet:"objects",spriteX:224,spriteY:0,rotate:true};f.e_energy_ball={role:"projectile",cooldown:2E3,speed:200,hitPoints:9999,damage:20,spriteSheet:"objects",spriteX:320,spriteY:0,rotate:true};f.e_fireball={role:"projectile",cooldown:2E3,speed:200,hitPoints:9999,damage:20,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:true};f.e_fireball_2={role:"projectile",cooldown:75,speed:350,hitPoints:9999,damage:15,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:true,ttl:750};
f.e_static_blue_fire={role:"projectile",cooldown:100,speed:0,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:true,rotateSpeed:100,ttl:1E3};f.e_shock_wave={role:"projectile",cooldown:1E3,speed:200,hitPoints:9999,damage:10,spriteSheet:"objects",spriteX:224,spriteY:32,spriteAlign:true};f.cloud={role:"fluff",spriteSheet:"objects",collidable:false,onInit:function(){this.alpha=0.25;this.speed=horde.randomRange(5,25);this.size=new horde.Size(192,128);switch(horde.randomRange(1,4)){case 1:this.spriteX=
0;this.spriteY=288;break;case 2:this.spriteX=192;this.spriteY=288;break;case 3:this.spriteX=0;this.spriteY=416;break;case 4:this.spriteX=192;this.spriteY=416;break}}};f.gate={role:"fluff",speed:25,spriteSheet:"objects",spriteX:0,spriteY:192,size:new horde.Size(64,64)};f.small_skull={role:"fluff",speed:25,ttl:1E3,spriteSheet:"objects",spriteX:64,spriteY:64,rotate:true,rotateSpeed:50};f.small_giblet={role:"fluff",speed:50,ttl:1500,spriteSheet:"objects",spriteX:0,spriteY:160,rotate:true,rotateSpeed:50,
onInit:function(){this.spriteX+=horde.randomRange(0,6)*this.size.width}};f.medium_skull={role:"fluff",speed:25,ttl:1E3,spriteSheet:"objects",spriteX:32,spriteY:64,rotate:true,rotateSpeed:50};f.medium_giblet={role:"fluff",speed:50,ttl:1500,spriteSheet:"objects",spriteX:0,spriteY:128,rotate:true,rotateSpeed:50,onInit:function(){this.spriteX+=horde.randomRange(0,6)*this.size.width}};f.large_skull={role:"fluff",speed:25,ttl:1E3,spriteSheet:"objects",spriteX:0,spriteY:64,rotate:true,rotateSpeed:50};f.large_giblet=
{role:"fluff",speed:50,ttl:1500,spriteSheet:"objects",spriteX:0,spriteY:96,rotate:true,rotateSpeed:50,onInit:function(){this.spriteX+=horde.randomRange(0,6)*this.size.width}};f.item_food={role:"powerup_food",healAmount:5,speed:0,spriteSheet:"objects",spriteX:96,spriteY:32,ttl:8E3};f.item_coin={role:"powerup_coin",coinAmount:10,speed:0,spriteSheet:"objects",spriteX:64,spriteY:32,ttl:5E3,onInit:function(){var a=horde.randomRange(1,10);if(a<=5){this.coinAmount=10;this.spriteX=64}else if(a>5&&a<=9){this.coinAmount=
100;this.spriteX=32}else if(a===10){this.coinAmount=1E3;this.spriteX=0}}};f.item_weapon={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:0,spriteY:0,ttl:5E3,onInit:function(){switch(horde.randomRange(1,8)){case 1:case 2:case 3:this.wepType="h_knife";this.spriteX=32;this.wepCount=150;break;case 4:case 5:case 6:this.wepType="h_spear";this.wepCount=30;this.spriteX=96;break;case 7:case 8:this.wepType="h_fireball";this.wepCount=200;this.spriteX=192;break}}}})();(function(){horde.ImageLoader=function(){this.images={};this.numImages=this.numLoaded=0};var f=horde.ImageLoader.prototype;f.load=function(c,a,b){this.callback=function(){a.call(b)};for(var d in c){this.numImages++;this.images[d]=new Image;horde.on("load",this.handleImageLoad,this.images[d],this);horde.on("error",this.handleImageError,this.images[d],this);this.images[d].src=c[d]}};f.increment=function(){this.numLoaded++;this.numLoaded>=this.numImages&&this.callback()};f.handleImageLoad=function(){this.increment()};
f.handleImageError=function(){this.increment()};f.getImage=function(c){if(this.images[c])return this.images[c];return false}})();(function(){horde.SpawnPoint=function(c,a,b,d){this.delay=500;this.lastSpawnElapsed=0;this.location=new horde.Rect(c,a,b,d);this.queue=[]};var f=horde.SpawnPoint.prototype;f.update=function(c){this.lastSpawnElapsed+=c;if(this.lastSpawnElapsed>=this.delay){this.lastSpawnElapsed=0;if(this.queue.length<1)return false;var a=this.queue.shift();c=this.location;a=horde.makeObject(a);a.position.x=horde.randomRange(c.left,c.left+c.width-a.size.width);a.position.y=horde.randomRange(c.top,c.top+c.height-a.size.height);
c=a.direction.clone();c.y=1;a.setDirection(c);return a}return false};f.queueSpawn=function(c,a){a=Number(a)||1;for(var b=0;b<a;b++)this.queue.push(c)}})();(function(){horde.SpawnWave=function(){this.points=[];this.nextWaveTime=2E4};var f=horde.SpawnWave.prototype;f.addSpawnPoint=function(c,a){this.points.push({spawnPointId:c,delay:a,objects:[]})};f.addObjects=function(c,a,b){var d=null;for(var g in this.points)if(this.points[g].spawnPointId===c)d=this.points[g];if(d===null)return false;d.objects.push({type:a,count:Math.floor(b)})}})();var e=new horde.Engine;e.run();
</script>

</body>
</html>
